{"version":3,"sources":["node_modules/browser-pack/_prelude.js","global.ts","src/DTOs/Item.ts","src/DTOs/Translation.ts","src/Language.ts","src/Services/BlogController.ts","src/Services/ItemController.ts","src/Services/ItemPictureController.ts","src/Services/LoginController.ts","src/Services/TranslationController.ts","src/Utils/BaseAutoItem.ts","src/Views/Admin/Home.ts","src/Views/Blog/BlogController.ts","src/Views/Blog/Edit.ts","src/Views/Blog/List.ts","src/Views/ItemTTT/Add.ts","src/Views/ItemTTT/Edit.ts","src/Views/ItemTTT/ItemTTTController.ts","src/Views/ItemTTT/List.ts","src/Views/common.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","ttt","common","admin","home","itemttt","list","add","edit","blog","window","ItemKO","_super","$container","src","fieldNames","_this","active","features","pictures","self","this","price","utils","ensureInteger","observable","canBeZero","canBeNull","mustBePositive","__extends","prototype","toDictObj","dict","BaseAutoItem","TranslationKO","en","fr","nl","ko","TranslationItemKO","inOriginal","inTranslation","enOriginal","frOriginal","nlOriginal","modified","computed","toDTO","setAllLanguagesTo","str","copyEnToBlanks","stringIsNullOrWhitespace","Languages","_a","strEnum","allLanguages","url","postRequestForm","routes","api","rc","sent","posts","result","uploadPicture","file","pictureUpload","formData","FormData","append","postRequestFormData","response","imageTagContent","getUrlCode","originalCode","getRequest","details","items","replace","itemCodeParameter","postRequestJSON","item","save","newCode","delete_","delete","upload","itemCode","imageNumber","number","reorder","newNumber","setMain","isMain","changePassword","TranslationTypes","allTranslationTypes","translations","autoCompleteResolve","autoComplete","fieldTagAttribute","knockoutify","dictKO","$","each","fieldName","fromDictObj","find","attr","indexOf","push","forEach","loginCtrl","trnCtrl","trnDto","init","ChangePassword","$passwordBlockingDiv","Features","$featuresBlockingDiv","$blockingDiv","original","newPassword","newPasswordAgain","change","oldPassword","html","showMessage","block","unblock","success","error","errorMessage","TranslationsBase","type","observableArray","hasChanges","refresh","map","v","TranslationItem","clearLine","index","addLine","toSave","dto","filter","showReset","feature","languageParameter","pageParameters","currentLanguage","ctrl","log","$picUploadControl","on","files","undefined","apiCtrl","htmlCtrl","blogIdAttribute","loadImages","id","parseInt","removeAttr","model","__awaiter","$element","applyBindings","lastPostItem","lastPost","Promise","resolve","waitForScrolledVisible","$endPostElement","postsIncrement","$spinner","show","noLayout","includeImages","skipToID","take","hide","before","loopLoadNextPosts","obj","itemTTT","redirect","$fieldsContainer","$btnSave","click","picCtrl","Translation_1","message_confirmDelete","message_saveSuccess","message_refreshFailed","message_confirmDeletePicture","tasks","all","rcs","newUrl","pushHistory","pathname","newTitle","name","$dropZone","$upload","$btnDelete","confirmed","confirm","$picUploadDropZone","picDropZone","hover","stopPropagation","preventDefault","originalEvent","dataTransfer","autoCompleteFeature","searchTerm","searchString","includeTranslations","deletePicture","picture","toggleMainPicture","isMainImage","reorderPicture","offset","scrambleUrl","newGuid","addNewFeature","ViewModes","allViewModes","_b","SortingFields","allSortingFields","getListContent","currentSortingField","$txtSearch","$cbShowInactive","$divCarsList","$divBlocking","itemCtrl","ItemTTTController_1","Language_1","modelSearchString","reconstructItemsList","$models","$modelElement","parent","JSON","parse","text","remove","itemsList","filterItemsList","visible","getIsVisible","refreshList","sortingField","name_desc","price_desc","prop","$btnViewGrid","viewMode","grid","$btnViewList","$btnSortName","$btnSortPrice","keyup","required","nameof","toggleActive","showInactive","is","val","toLowerCase","trim","searchWords","split","word","searchFields","descriptionEN","descriptionFR","descriptionNL","matchCount","i_1","html_1","debugMessages","bindingHandlers","ttt_autocomplete","element","valueAccessor","searchFunction","autocomplete","minLength","source","request","term","ttt_slideUpDownVisible","unwrap","update","slideDown","slideUp","ttt_slideLeftRightVisible","direction","optionalParams","_i","arguments","isDebug","console","apply","reduce","res","key","Object","create","stringIsNullOrEmpty","htmlEncode","txt","Array","isArray","document","createElement","join","arrayContains","arrayRemoveItem","splice","arraySum","arrayMoveItem","j","tmp","fallbackValue","subscribe","value","newValue","isNaN","S4","Math","random","toString","substring","sleep","ms","setTimeout","msg","$div","modal","$e","blockCounter","data","ensureVisible","top","height","animate","scrollTop","effect","$elem","$window","isScrolledVisible","docViewTop","docViewBottom","elemTop","scrollHandler","unbind","bind","url_1","onChangedEvent","onChangedCallbacks","onChangedCallbacksRegistered","stringifyParameters","parms","pairs","encodeURIComponent","stringify","createUrl","newPath","location","parameters","queryString","href","parseParameters","search","tokens","decodeURIComponent","ex","onChanged","callback","evt","trigger","history","pushState","reject","ajax","contentType","dataType","textStatus","jqXHR","errorThrown","processData","requestStr","downloadFile","body","style","__export"],"mappings":"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","file":"site.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\r\nimport * as common\t\tfrom \"./src/Views/common\";\r\nimport * as adminhome\tfrom \"./src/Views/Admin/Home\";\r\nimport * as itemlist\tfrom \"./src/Views/ItemTTT/List\";\r\nimport * as itemadd\t\tfrom \"./src/Views/ItemTTT/Add\";\r\nimport * as itemedit\tfrom \"./src/Views/ItemTTT/Edit\";\r\nimport * as bloglist\tfrom \"./src/Views/Blog/List\";\r\nimport * as blogedit\tfrom \"./src/Views/Blog/Edit\";\r\n\r\n///////\r\n\r\n// Global assignment of window.itemttt (will be available in each pages e.g. from the console):\r\nvar ttt =\r\n{\r\n\tcommon: common,\r\n\tadmin: {\r\n\t\thome : adminhome,\r\n\t},\r\n\titemttt: {\r\n\t\tlist\t: itemlist,\r\n\t\tadd\t\t: itemadd,\r\n\t\tedit\t: itemedit,\r\n\t},\r\n\tblog: {\r\n\t\tlist\t: bloglist,\r\n\t\tedit\t: blogedit,\r\n\t},\r\n}\r\ndeclare global\r\n{\r\n\tinterface Window { ttt: typeof ttt; }\r\n}\r\nwindow.ttt = ttt;\r\n","\nimport * as common from \"../Views/common\";\nimport { BaseAutoItem, DictObj } from \"../Utils/BaseAutoItem\";\nexport { DictObj, DictKO } from \"../Utils/BaseAutoItem\";\nimport { Translation } from \"./Translation\";\nimport { ItemPicture } from \"./ItemPicture\";\n\nexport interface Item extends DictObj\n{\n\tcode\t\t: string;\n\tactive\t\t: boolean;\n\tfeatures\t: Translation[];\n\tpictures\t: ItemPicture[];\n}\n\nexport class ItemKO extends BaseAutoItem\n{\n\tpublic readonly code\t\t\t: KnockoutObservable<string>;\n\tpublic readonly name\t\t\t: KnockoutObservable<string>;\n\tpublic readonly descriptionEN\t: KnockoutObservable<string>;\n\tpublic readonly descriptionFR\t: KnockoutObservable<string>;\n\tpublic readonly descriptionNL\t: KnockoutObservable<string>;\n\tpublic readonly active\t\t\t: KnockoutObservable<boolean>;\n\tpublic readonly price\t\t\t: KnockoutObservable<number>;\n\n\tconstructor($container:JQuery, src?:Item, fieldNames?:string[])\n\t{\n\t\tif( src == null )\n\t\t\tsrc = { code:null, active:false, features:[], pictures:[] };\n\t\tsuper( $container, src, fieldNames );\n\t\tconst self = this;\n\n\t\tif( self.price != null )\n\t\t\tcommon.utils.ensureInteger({ observable:self.price, canBeZero:false, canBeNull:true, mustBePositive:true });\n\t}\n\n\tpublic /*override*/ toDictObj(dict?:DictObj) : Item\n\t{\n\t\tconst rc = super.toDictObj( dict );\n\t\treturn <Item>rc;\n\t}\n}\n","\nimport * as common from \"../Views/common\";\n\nexport interface Translation\n{\n\ten : string;\n\tfr : string;\n\tnl : string;\n}\nexport interface TranslationItem extends Translation\n{\n\tinOriginal\t\t: boolean;\n\tinTranslation\t: boolean;\n}\n\nexport class TranslationKO\n{\n\tpublic readonly en\t: KnockoutObservable<string>;\n\tpublic readonly fr\t: KnockoutObservable<string>;\n\tpublic readonly nl\t: KnockoutObservable<string>;\n\n\tconstructor(src?:Translation)\n\t{\n\t\tif( src == null )\n\t\t\tsrc = { en:'', fr:'', nl:'' };\n\t\tthis.en = ko.observable( src.en );\n\t\tthis.fr = ko.observable( src.fr );\n\t\tthis.nl = ko.observable( src.nl );\n\t}\n}\nexport class TranslationItemKO extends TranslationKO\n{\n\tpublic readonly inOriginal\t\t: KnockoutObservable<boolean>;\n\tpublic readonly inTranslation\t: KnockoutObservable<boolean>;\n\n\tpublic readonly enOriginal\t: KnockoutObservable<string>;\n\tpublic readonly frOriginal\t: KnockoutObservable<string>;\n\tpublic readonly nlOriginal\t: KnockoutObservable<string>;\n\tpublic readonly modified\t: KnockoutComputed<boolean>;\n\n\tconstructor(src?:TranslationItem)\n\t{\n\t\tif( src == null )\n\t\t\tsrc = { en:'', fr:'', nl:'', inOriginal:false, inTranslation:false };\n\t\tsuper( src );\n\t\tconst self = this;\n\n\t\tthis.inOriginal\t\t= ko.observable( src.inOriginal\t );\n\t\tthis.inTranslation\t= ko.observable( src.inTranslation );\n\n\t\tthis.enOriginal = ko.observable( self.en() );\n\t\tthis.frOriginal = ko.observable( self.fr() );\n\t\tthis.nlOriginal = ko.observable( self.nl() );\n\t\tthis.modified = ko.computed( ()=>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( self.en() != self.enOriginal() )\treturn true;\n\t\t\t\t\t\t\t\tif( self.fr() != self.frOriginal() )\treturn true;\n\t\t\t\t\t\t\t\tif( self.nl() != self.nlOriginal() )\treturn true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t} );\n\t}\n\n\tpublic toDTO() : Translation\n\t{\n\t\treturn {\n\t\t\t\ten : this.en(),\n\t\t\t\tfr : this.fr(),\n\t\t\t\tnl : this.nl(),\n\t\t\t};\n\t}\n\n\tpublic setAllLanguagesTo(str:string) : void\n\t{\n\t\tthis.en( str );\n\t\tthis.fr( str );\n\t\tthis.nl( str );\n\t}\n\n\tpublic copyEnToBlanks() : void\n\t{\n\t\tconst self = this;\n\t\tconst en = self.en();\n\t\tif( common.utils.stringIsNullOrWhitespace(self.fr()) )\n\t\t\tself.fr( en );\n\t\tif( common.utils.stringIsNullOrWhitespace(self.nl()) )\n\t\t\tself.nl( en );\n\t}\n}\n","\nimport * as common from \"./Views/common\";\n\nexport const { e:Languages, a:allLanguages } = common.utils.strEnum([ 'en', 'fr', 'nl' ]);\nexport type Language = keyof typeof Languages;\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\nimport * as dto from \"../DTOs/BlogPost\";\n\nexport async function list(p:ListRequest) : Promise<ListResponse>\n{\n\tconst rc = <ListResponse>await common.url.postRequestForm( common.routes.api.blog.list, p );\n\trc.posts = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface ListRequest\n{\n\tincludeImages?\t\t: boolean;\n\tincludeInactives?\t: boolean;\n\tid?\t\t\t\t\t: number;\n\tskipToID?\t\t\t: number;\n\tskip?\t\t\t\t: number;\n\ttake?\t\t\t\t: number;\n}\nexport interface ListResponse extends Result\n{\n\tposts : dto.BlogPost[];\n}\n\nexport async function uploadPicture(file:File) : Promise<UploadPictureResult>\n{\n\tconst url = common.routes.api.blog.pictureUpload;\n\tconst formData = new FormData();\n\tformData.append( 'file', file );\n\n\tconst response = await common.url.postRequestFormData<UploadPictureResult>( url, formData );\n\tresponse.imageTagContent = response.result;\n\tdelete response.result;\n\n\treturn response;\n}\nexport interface UploadPictureResult extends Result\n{\n\timageTagContent : string;\n}\n","\nimport * as common from \"../Views/common\";\nimport { Item } from \"../DTOs/Item\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function getUrlCode(originalCode:string) : Promise<string>\n{\n\tif( common.utils.stringIsNullOrWhitespace(originalCode) )\n\t\treturn null;\n\treturn await common.url.getRequest( common.routes.api.getUrlCode, { originalCode } );\n}\n\nexport async function details(code:string) : Promise<DetailsResult>\n{\n\tconst url = common.routes.api.items.details.replace( common.routes.itemCodeParameter, code );\n\tconst rc = await common.url.postRequestJSON<DetailsResult>( url, {} );\n\trc.item = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface DetailsResult extends Result\n{\n\titem : Item;\n}\n\nexport async function save(p:SaveRequest) : Promise<SaveResult>\n{\n\tconst rc = await common.url.postRequestJSON<SaveResult>( common.routes.api.items.save, p );\n\trc.newCode = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface SaveRequest\n{\n\toriginalCode?\t: string;\n\titem\t\t\t: Item;\n}\nexport interface SaveResult extends Result\n{\n\tnewCode : string;\n}\n\nexport async function delete_(code:string) : Promise<SaveResult>\n{\n\tconst url = common.routes.api.items.delete.replace( common.routes.itemCodeParameter, code );\n\tconst rc = await common.url.postRequestJSON<SaveResult>( url, {} );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function upload(itemCode:string, file:File) : Promise<UploadResult>\n{\n\tconst url = common.routes.api.items.pictures.upload.replace( common.routes.itemCodeParameter, itemCode );\n\tconst formData = new FormData();\n\tformData.append( 'file', file );\n\n\tconst response = await common.url.postRequestFormData<UploadResult>( url, formData );\n\tresponse.imageNumber = response.result;\n\tdelete response.result;\n\t\n\treturn response;\n}\nexport interface UploadResult extends Result\n{\n\timageNumber : number;\n}\n\nexport async function delete_(p:{ itemCode:string, number:number }) : Promise<Result>\n{\n\tconst url = common.routes.api.items.pictures.delete.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number } );\n\treturn rc;\n}\n\nexport async function reorder(p:{ itemCode:string, number:number, newNumber:number }) : Promise<Result>\n{\n\tconst url = common.routes.api.items.pictures.reorder.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number, newNumber:p.newNumber } );\n\treturn rc;\n}\n\nexport async function setMain(p:{ itemCode:string, number:number, isMain:boolean }) : Promise<Result>\n{\n\tconst url = common.routes.api.items.pictures.setMain.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number, isMain:p.isMain } );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function changePassword(p:{ oldPassword:string, newPassword:string }) : Promise<Result>\n{\n\tconst url = common.routes.api.changePassword;\n\tconst rc = <Result>await common.url.postRequestForm( url, p );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\nimport * as dto from \"../DTOs/Translation\";\n\nexport const { e:TranslationTypes, a:allTranslationTypes } = common.utils.strEnum([ 'feature' ]);\nexport type TranslationType = keyof typeof TranslationTypes;\n\nexport async function list(p:ListRequest) : Promise<ListResponse>\n{\n\tconst rc = <ListResponse>await common.url.postRequestForm( common.routes.api.translations.list, p );\n\trc.translations = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface ListRequest\n{\n\ttype\t\t\t\t\t: TranslationType;\n\tincludeOriginals?\t\t: boolean;\n\tincludeTranslations?\t: boolean;\n}\nexport interface ListResponse extends Result\n{\n\ttranslations : dto.TranslationItem[];\n}\n\nexport async function save(p:SaveRequest) : Promise<Result>\n{\n\treturn await common.url.postRequestJSON<Result>( common.routes.api.translations.save, p );\n}\nexport interface SaveRequest\n{\n\ttype\t\t\t: TranslationType;\n\ttranslations\t: SaveRequestItem[];\n}\nexport interface SaveRequestItem extends dto.Translation\n{\n\tenOriginal?\t: string;\n}\n\nexport async function autoCompleteResolve(p:AutoCompleteResolveRequest) : Promise<AutoCompleteResolveResponse>\n{\n\tconst url = common.routes.api.autoComplete;\n\tconst rc = <AutoCompleteResolveResponse>await common.url.postRequestForm( url, p );\n\trc.list = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface AutoCompleteResolveRequest\n{\n\ttype\t\t\t\t\t: TranslationType;\n\tsearchString?\t\t\t: string;\n\tincludeTranslations?\t: boolean;\n}\nexport interface AutoCompleteResolveResponse extends Result\n{\n\tlist : string[];\n}\n","\nconst fieldTagAttribute = 'ttt-name';\n\nexport type DictObj\t= {[key:string]:any};\nexport type DictKO\t= {[key:string]:KnockoutObservable<any>};\n\nexport abstract class BaseAutoItem\n{\n\tprivate readonly fieldNames : string[];\n\n\tconstructor($container:JQuery, src:DictObj, fieldNames?:string[])\n\t{\n\t\tthis.fieldNames = (fieldNames != null) ? fieldNames : [];\n\t\tthis.knockoutify( $container, src );\n\t}\n\n\tpublic toDictObj(dict?:DictObj) : DictObj\n\t{\n\t\tconst self = this;\n\t\tconst dictKO : DictKO = <any>self;\n\t\tif( dict == null )\n\t\t\tdict = {};\n\n\t\t$.each( self.fieldNames, (i,fieldName)=>\n\t\t\t{\n\t\t\t\tconst observable = dictKO[ fieldName ];\n\t\t\t\tdict[ fieldName ] = observable();\n\t\t\t} );\n\n\t\treturn dict;\n\t}\n\n\tpublic fromDictObj(dict:DictObj) : void\n\t{\n\t\tconst self = this;\n\t\tconst dictKO : DictKO = <any>self;\n\t\t$.each( self.fieldNames, (i,fieldName)=>\n\t\t\t{\n\t\t\t\tconst observable = dictKO[ fieldName ];\n\t\t\t\tobservable( dict[fieldName] );\n\t\t\t} );\n\t}\n\n\tprivate knockoutify($container:JQuery, src:DictObj) : void\n\t{\n\t\tconst self = this;\n\t\tconst dict : DictKO = <any>this;\n\n\t\t// For each tagged elements we find in '$container'\n\t\t$container.find( `[${fieldTagAttribute}]` ).each( (i,e)=>\n\t\t\t{\n\t\t\t\t// Extract the field name from that attribute\n\t\t\t\tconst $e = $(e);\n\t\t\t\tconst fieldName = $e.attr( fieldTagAttribute );\n\n\t\t\t\tif( self.fieldNames.indexOf(fieldName) >= 0 )\n\t\t\t\t\t// That field is already already listed\n\t\t\t\t\t{/*NOOP*/}\n\t\t\t\telse\n\t\t\t\t\t// Add that field to the fields list\n\t\t\t\t\tself.fieldNames.push( fieldName );\n\t\t\t} );\n\n\t\t// For each listed fields ...\n\t\tself.fieldNames.forEach( (fieldName)=>\n\t\t\t{\n\t\t\t\t// ... create a KO observable on 'this' and set it's value using 'src' ...\n\t\t\t\tdict[ fieldName ] = ko.observable( src[fieldName] );\n\t\t\t} );\n\t}\n}\n","\nimport * as common from \"../common\";\nimport * as loginCtrl from \"../../Services/LoginController\";\nimport * as trnCtrl from \"../../Services/TranslationController\";\nimport * as trnDto from \"../../DTOs/Translation\";\n\nconst passwordsDontMatchMessage = 'Les 2 mots de passe ne concordent pas';\nconst passwordChangedMessage = 'Password changed successfully';\n\nexport var changePassword : ChangePassword;\nexport var features : Features;\n\nexport async function init(p:{\t$passwordBlockingDiv : JQuery,\n\t\t\t\t\t\t\t\t$featuresBlockingDiv : JQuery,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tchangePassword\t= new ChangePassword( p.$passwordBlockingDiv );\n\tfeatures\t\t= new Features( p.$featuresBlockingDiv );\n}\n\nclass ChangePassword\n{\n\tprivate readonly\t$blockingDiv\t\t: JQuery;\n\n\tprotected readonly\toriginal\t\t\t: KnockoutObservable<string>;\n\tprotected readonly\tnewPassword\t\t\t: KnockoutObservable<string>;\n\tprotected readonly\tnewPasswordAgain\t: KnockoutObservable<string>;\n\n\tconstructor($blockingDiv:JQuery)\n\t{\n\t\tthis.$blockingDiv\t\t= $blockingDiv;\n\t\tthis.original\t\t\t= ko.observable( '' );\n\t\tthis.newPassword\t\t= ko.observable( '' );\n\t\tthis.newPasswordAgain\t= ko.observable( '' );\n\t}\n\n\tprotected async change() : Promise<void>\n\t{\n\t\tconst self = this;\n\t\tconst oldPassword = self.original();\n\t\tconst newPassword = self.newPassword();\n\t\tconst newPasswordAgain = self.newPasswordAgain();\n\n\t\tif( common.utils.stringIsNullOrWhitespace(newPassword) )\n\t\t\treturn;\n\t\tif( common.utils.stringIsNullOrWhitespace(oldPassword) )\n\t\t\treturn;\n\t\tif( newPassword != newPasswordAgain )\n\t\t{\n\t\t\tcommon.html.showMessage( passwordsDontMatchMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc = await loginCtrl.changePassword({ oldPassword, newPassword });\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'change password error', { rc } );\n\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\treturn;\n\t\t}\n\t\tcommon.html.showMessage( passwordChangedMessage );\n\t\treturn;\n\t}\n}\n\nabstract class TranslationsBase\n{\n\tprivate readonly\t$blockingDiv\t: JQuery;\n\n\tprivate readonly\ttype\t\t\t: trnCtrl.TranslationType;\n\tprotected readonly\titems\t\t\t: KnockoutObservableArray<TranslationItem>;\n\tprotected readonly\thasChanges\t\t: KnockoutComputed<boolean>;\n\n\tconstructor(type:trnCtrl.TranslationType, $blockingDiv:JQuery)\n\t{\n\t\tconst self = this;\n\n\t\tthis.$blockingDiv\t= $blockingDiv;\n\t\tthis.type\t\t\t= type;\n\t\tthis.items\t\t\t= ko.observableArray();\n\t\tthis.hasChanges\t\t= ko.computed( ()=>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst items = self.items();\n\t\t\t\t\t\t\t\t\t\tfor( let i=0; i<items.length; ++i )\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tif( items[i].modified() )\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t} );\n\n\t\tthis.refresh();\n\t}\n\n\tprotected async refresh() : Promise<void>\n\t{\n\t\tconst self = this;\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tvar rc = await trnCtrl.list({ type:self.type });\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'refresh translations error', { rc } );\n\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = rc.translations.map( v=>new TranslationItem(v) );\n\t\tself.items( items );\n\t}\n\n\tprotected clearLine(index:KnockoutObservable<number>) : void\n\t{\n\t\tconst self = this;\n\t\tconst item = self.items()[ index() ];\n\t\titem.setAllLanguagesTo( '' );\n\t}\n\tprotected addLine() : void\n\t{\n\t\tthis.items.push( new TranslationItem() );\n\t}\n\n\tprotected async save() : Promise<void>\n\t{\n\t\tconst self = this;\n\n\t\tconst toSave = self.items()\n\t\t\t\t\t\t.map( (item)=>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif(! item.modified() )\n\t\t\t\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t\t\t\tconst dto : trnCtrl.SaveRequestItem = item.toDTO();\n\t\t\t\t\t\t\t\tdto.enOriginal = item.enOriginal();\n\t\t\t\t\t\t\t\treturn dto;\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t.filter( (item)=>(item != null) );\n\n\t\tif( toSave.length == 0 )\n\t\t{\n\t\t\t// NOOP => Simply refresh\n\t\t\tawait self.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc = await trnCtrl.save({ type:self.type, translations:toSave });\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'save translations error', { rc } );\n\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tawait self.refresh();\n\t}\n}\nclass TranslationItem extends trnDto.TranslationItemKO\n{\n\tprotected readonly showReset\t: KnockoutComputed<boolean>;\n\n\tconstructor(src?:trnDto.TranslationItem)\n\t{\n\t\tsuper( src );\n\t\tconst self = this;\n\t\tthis.showReset = ko.computed( ()=>self.inTranslation() );\n\t}\n}\n\nclass Features extends TranslationsBase\n{\n\tconstructor($blockingDiv:JQuery)\n\t{\n\t\tsuper( trnCtrl.TranslationTypes.feature, $blockingDiv );\n\t}\n}\n","\nimport * as common from \"../common\";\n\nexport namespace list\n{\n\texport async function list(p:{ noLayout?:boolean, includeImages?:boolean, includeInactives?:boolean, skipToID?:number, take?:number }) : Promise<string>\n\t{\n\t\tvar url = common.routes.blog.list.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\t\treturn await common.url.getRequest( url, p );\n\t}\n}\n","\nimport * as common from \"../common\";\nimport * as ctrl from \"../../Services/BlogController\";\n\nexport async function init(p:{\t$picUploadControl\t: JQuery,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'edit.init() START', { p } );\n\n\tcommon.utils.log( 'edit.init(): Init picture upload' );\n\tp.$picUploadControl.on( 'change', ()=>\n\t\t{\n\t\t\tconst files = (<HTMLInputElement>p.$picUploadControl[0]).files;\n\t\t\tuploadPicture( files );\n\t\t} );\n\n\tcommon.utils.log( 'edit.init() END' );\n}\n\nasync function uploadPicture(files:FileList) : Promise<void>\n{\n\tcommon.utils.log( 'edit.uploadPicture(): START', {files} );\n\n\tif( files.length == 0 )\n\t\treturn;\n\tif( (<any>window).FormData === undefined )\n\t{\n\t\tcommon.utils.error( \"This browser doesn't support HTML5 file uploads!\" );\n\t\treturn;\n\t}\n\n\t const rc = await ctrl.uploadPicture( files[0] );\n\t if(! rc.success )\n\t {\n\t\t common.utils.error( 'edit.uploadPicture(): Error', { rc } );\n\t\t common.html.showMessage( rc.errorMessage );\n\t\t return;\n\t }\n\n\t $('#foobar').html( rc.imageTagContent );\n \n\tcommon.utils.log( 'edit.uploadPicture(): END' );\n}\n","\nimport * as common from \"../common\";\nimport * as dtos from \"../../DTOs/BlogPost\";\nimport * as apiCtrl from \"../../Services/BlogController\";\nimport * as htmlCtrl from \"./BlogController\";\n\nconst blogIdAttribute = 'ttt-blog-id';\n\nexport async function init(p:{\t$postsContainer\t: JQuery,\n\t\t\t\t\t\t\t\t$endPostElement\t: JQuery,\n\t\t\t\t\t\t\t\t$spinner\t\t: JQuery,\n\t\t\t\t\t\t\t\tpostsIncrement\t: number,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'list.init() START', { p } );\n\n\t// Retreive images of initially loaded posts\n\tconst lastPost = await loadImages();\n\n\tcommon.utils.log( 'list.init(): Wait for document.load' );\n\tawait new Promise<void>( (resolve)=>$(window).on( 'load', ()=>resolve() ) );\n\tcommon.utils.log( 'list.init(): Loaded!' );\n\n\t// Start \"scroll-triggered\" retreives loop\n\t/*await*/ loopLoadNextPosts({ $endPostElement:p.$endPostElement, $spinner:p.$spinner, lastPost, postsIncrement:p.postsIncrement });\n\n\tcommon.utils.log( 'list.init() END' );\n}\n\nasync function loopLoadNextPosts(p:{ $endPostElement:JQuery, $spinner:JQuery, lastPost:PostItem, postsIncrement:number }) : Promise<void>\n{\n\tcommon.utils.log( 'loopLoadNextPosts(): START', { p } );\n\n\tlet lastPost = p.lastPost;\n\twhile( lastPost != null )\n\t{\n\t\tcommon.utils.log( 'loopLoadNextPosts(): Wait for $endPostElement to be visible' );\n\t\tawait common.html.waitForScrolledVisible( p.$endPostElement );\n\n\t\tcommon.utils.log( `loopLoadNextPosts(): Request next '${p.postsIncrement}' posts` );\n\t\tp.$spinner.show();\n\t\tconst html = await htmlCtrl.list.list({ noLayout:true, includeImages:false, skipToID:lastPost.id, take:p.postsIncrement });\n\t\tp.$spinner.hide();\n\n\t\tcommon.utils.log( 'loopLoadNextPosts(): Append received posts' );\n\t\tp.$endPostElement.before( html );\n\n\t\tcommon.utils.log( `loopLoadNextPosts(): Launch 'loadImages()'`, { lastPost } );\n\t\tlastPost = await loadImages();\n\n\t\tcommon.utils.log( 'loopLoadNextPosts()', { lastPost } );\n\t}\n\n\tcommon.utils.log( 'loopLoadNextPosts(): END' );\n}\n\nasync function loadImages() : Promise<PostItem>\n{\n\tcommon.utils.log( 'loadImages(): START' );\n\n\t// Find all new elements with the \"tag attribute\" (i.e. all new blog posts)\n\tconst posts : PostItem[] = [];\n\t$(`[${blogIdAttribute}]`).each( (i,e)=>\n\t\t{\n\t\t\tconst $container = $(e);\n\t\t\tconst id = parseInt( $container.attr(blogIdAttribute) );\n\t\t\t$container.removeAttr( blogIdAttribute );  // Remove the \"tag attribute\" from the DOM so that next call to this method does not re-find this item\n\t\t\tposts.push({ id, $container, model:null });\n\t\t} );\n\n\tcommon.utils.log( 'loadImages(): Asynchroneously retreive posts (full) DTOs', { posts } );\n\tposts.forEach( async (item)=>\n\t\t{\n\t\t\tcommon.html.block( item.$container );\n\t\t\tconst rc = await apiCtrl.list({ id:item.id });\n\t\t\tcommon.html.unblock( item.$container );\n\t\t\tif(! rc.success )\n\t\t\t{\n\t\t\t\tcommon.utils.error( 'retreive post error', { rc } );\n\t\t\t\t// common.html.showMessage( rc.errorMessage ); <== publicly-accessible page => Don't show internal errors ...\n\t\t\t\treturn;\n\t\t\t}\n\t\t\titem.model = rc.posts[0];\n\n\t\t\tcommon.utils.log( 'loadImages(): Bind model', { /*model:item.model,*/ $element:item.$container, id:item.id } );\n\t\t\tko.applyBindings( item.model, item.$container[0] );\n\t\t} );\n\n\tconst lastPostItem = (posts.length > 0) ? posts[posts.length - 1] : null;\n\tcommon.utils.log( 'loadImages(): END', { lastPostItem } );\n\treturn lastPostItem;\n}\n\ninterface PostItem\n{\n\tid\t\t\t: number;\n\t$container\t: JQuery;\n\tmodel\t\t: dtos.BlogPost;\n}\n","\nimport * as common from \"../common\";\nimport * as dto from \"../../DTOs/Item\";\nimport * as ctrl from \"../../Services/ItemController\";\n\nvar $blockingDiv : JQuery;\nexport var item : dto.ItemKO;\n\nexport async function init(p:{\t$blockingDiv\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSave\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$fieldsContainer\t: JQuery }) : Promise<void>\n{\n\tcommon.utils.log( 'add.init() START', { p } );\n\t$blockingDiv = p.$blockingDiv;\n\n\tcommon.utils.log( 'add.init(): Create KO item' );\n\titem = new dto.ItemKO( p.$fieldsContainer );\n\n\tcommon.utils.log( 'add.init(): Apply KO item' );\n\tko.applyBindings( item, p.$fieldsContainer[0] );\n\n\tcommon.utils.log( 'add.init(): Bind JQuery events' );\n\tp.$btnSave.click( save );\n\n\tcommon.utils.log( 'add.init() END' );\n}\n\nasync function save() : Promise<void>\n{\n\tcommon.utils.log( 'add.save(): START' );\n\n\tconst obj = item.toDictObj();\n\n\tcommon.utils.log( 'add.save(): Launch save' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.save({ item:obj });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'add.save(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'add.save(): Redirect', { rc } );\n\tconst url = common.routes.itemTTT.edit.replace( common.routes.itemCodeParameter, rc.newCode );\n\tcommon.utils.log( `add.save(): url=\"${url}\"` );\n\tcommon.url.redirect( url );\n\n\tcommon.utils.log( 'add.save(): END' );\n}\n","\nimport * as common from \"../common\";\nimport * as dto from \"../../DTOs/Item\";\nimport { ItemPicture } from \"../../DTOs/ItemPicture\";\nimport * as ctrl from \"../../Services/ItemController\";\nimport * as picCtrl from \"../../Services/ItemPictureController\";\nimport * as trnCtrl from \"../../Services/TranslationController\";\nimport { TranslationKO } from \"../../DTOs/Translation\";\n\nconst message_confirmDelete = 'Are you sure you want to delete that item?';\nconst message_saveSuccess = 'Item saved successfully';\nconst message_refreshFailed = 'An error occured while refresing the data: ';\nconst message_confirmDeletePicture = 'Are you sure you want to delete that image?';\n\nvar $blockingDiv : JQuery;\nvar originalCode : string;\n\nexport var item\t\t\t: ItemKO;\nexport var picDropZone\t: { hover:KnockoutObservable<boolean> };\n\nexport async function init(p:{\tmodel\t\t\t\t: dto.Item,\n\t\t\t\t\t\t\t\t$blockingDiv\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSave\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnDelete\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$fieldsContainer\t: JQuery,\n\t\t\t\t\t\t\t\t$picUploadDropZone\t: JQuery,\n\t\t\t\t\t\t\t\t$picUploadControl\t: JQuery,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'edit.init() START', { p } );\n\t$blockingDiv = p.$blockingDiv;\n\n\tcommon.utils.log( 'edit.init(): Create KO item' );\n\titem = new ItemKO( p.$fieldsContainer, p.model );\n\toriginalCode = item.code();\n\n\tcommon.utils.log( 'edit.init(): Bind JQuery events' );\n\tp.$btnSave.click( save );\n\tp.$btnDelete.click( ()=>{ delete_(); } );\n\n\tcommon.utils.log( 'edit.init(): Init picture upload' );\n\tinitPictureUpload( p.$picUploadDropZone, p.$picUploadControl );\n\n\tcommon.utils.log( 'edit.init() END' );\n}\n\nfunction initPictureUpload($dropZone:JQuery, $upload:JQuery) : void\n{\n\tcommon.utils.log( 'edit.initDropZone(): Create drop zone object' );\n\n\tpicDropZone = {\n\t\t\thover : ko.observable(false),\n\t\t};\n\n\tcommon.utils.log( 'edit.initDropZone(): Watch for drag-drops on \"upload image drop zone\"' );\n\n\t$dropZone.on( 'dragenter', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( true );\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t} );\n\t$dropZone.on( 'dragover', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( true );\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t} );\n\t$dropZone.on( 'dragleave', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( false );\n\t\t} );\n\t$dropZone.on( 'drop', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( false );\n\t\t\te.preventDefault();\n\n\t\t\tvar files = (<any>e.originalEvent).dataTransfer.files;\n\t\t\tuploadPicture( files );\n\t\t});\n\n\t$upload.on( 'change', ()=>\n\t\t{\n\t\t\tconst files = (<HTMLInputElement>$upload[0]).files;\n\t\t\tuploadPicture( files );\n\t\t} );\n}\n\nexport async function autoCompleteFeature(searchTerm:string) : Promise<string[]>\n{\n\tvar rc = await trnCtrl.autoCompleteResolve({ type:trnCtrl.TranslationTypes.feature, searchString:searchTerm, includeTranslations:true });\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'autocomplete error', { rc } );\n\t\treturn [];\n\t}\n\treturn rc.list;\n}\n\nasync function save() : Promise<void>\n{\n\tcommon.utils.log( 'edit.save(): START' );\n\n\tconst obj = item.toDictObj();\n\n\tcommon.utils.log( 'edit.save(): Launch save' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.save({ originalCode, item:obj });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.save(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.save(): Refresh values', { rc } );\n\tconst rcr = await refresh( rc.newCode );\n\tif( rcr )\n\t\tcommon.html.showMessage( message_saveSuccess );\n\n\tcommon.utils.log( 'edit.save(): END' );\n}\n\nasync function delete_(confirmed?:boolean) : Promise<void>\n{\n\tcommon.utils.log( 'edit.delete(): START' );\n\n\tif( confirmed != true )\n\t{\n\t\tcommon.utils.log( 'edit.delete(): Ask confirmation' );\n\t\tconst rc = await common.html.confirm( message_confirmDelete );\n\t\tif(! rc )\n\t\t{\n\t\t\tcommon.utils.log( 'edit.delete(): NOT CONFIRMED' );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommon.utils.log( 'edit.delete(): Launch delete' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.delete_( originalCode );\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.delete(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.delete(): Redirect' );\n\tconst url = common.routes.itemTTT.list.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\tcommon.utils.log( 'edit.delete()', { url } );\n\tcommon.url.redirect( url );\n\n\tcommon.utils.log( 'edit.delete(): END' );\n}\n\nasync function uploadPicture(files:FileList) : Promise<void>\n{\n\tcommon.utils.log( 'edit.uploadPicture(): START', {files} );\n\n\tif( files.length == 0 )\n\t\treturn;\n\tif( (<any>window).FormData === undefined )\n\t{\n\t\tcommon.utils.error( \"This browser doesn't support HTML5 file uploads!\" );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( `edit.uploadPicture(): Create '${files.length}' upload tasks` );\n\tcommon.html.block( $blockingDiv );\n\tconst tasks = $.map( files, (file:File)=>\n\t\t{\n\t\t\treturn picCtrl.upload( originalCode, file );\n\t\t} );\n\n\tcommon.utils.log( 'edit.uploadPicture(): Wait for tasks to terminate' );\n\tconst rcs = await Promise.all( tasks );\n\tcommon.html.unblock( $blockingDiv );\n\tcommon.utils.log( 'edit.uploadPicture(): All tasks terminated' );\n\n\t$.each( rcs, (i,rc)=>\n\t\t{\n\t\t\tif(! rc )\n\t\t\t{\n\t\t\t\tcommon.utils.error( 'edit.delete(): Upload error', { i, rc } );\n\t\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\t}\n\t\t} );\n\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.uploadPicture(): END' );\n}\n\nexport async function deletePicture(picture:ItemPicture, confirmed?:boolean) : Promise<void>\n{\n\tcommon.utils.log( 'edit.deletePicture(): START' );\n\n\tif( confirmed != true )\n\t{\n\t\tcommon.utils.log( 'edit.deletePicture(): Ask confirmation' );\n\t\tconst rc = await common.html.confirm( message_confirmDeletePicture );\n\t\tif(! rc )\n\t\t{\n\t\t\tcommon.utils.log( 'edit.deletePicture(): NOT CONFIRMED' );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommon.utils.log( 'edit.deletePicture(): Launch delete request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.delete_({ itemCode:picture.itemCode, number:picture.number });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.deletePicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.deletePicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.deletePicture(): END' );\n}\n\nexport async function toggleMainPicture(picture:ItemPicture) : Promise<void>\n{\n\tcommon.utils.log( 'edit.toggleMainPicture(): START' );\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): Launch toggle request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.setMain({ itemCode:picture.itemCode, number:picture.number, isMain:(!picture.isMainImage) });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.toggleMainPicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): END' );\n}\n\nexport async function reorderPicture(picture:ItemPicture, offset:number) : Promise<void>\n{\n\tcommon.utils.log( 'edit.movePicture(): START' );\n\n\tlet newNumber = picture.number + offset;\n\tif( newNumber <= 0 )\n\t\tnewNumber = 1;\n\tif( picture.number == newNumber )\n\t\t// NOOP\n\t\treturn;\n\n\tcommon.utils.log( 'edit.movePicture(): Launch move request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.reorder({ itemCode:picture.itemCode, number:picture.number, newNumber:newNumber });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.movePicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.movePicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.movePicture(): END' );\n}\n\nasync function refresh(code?:string) : Promise<boolean>\n{\n\t// TODO: Allow refresh only images to avoid overwriting any modifications to input fields ...\n\tcommon.utils.log( 'edit.refresh(): START' );\n\n\tlet newUrl : string = null;\n\tif( code == null )\n\t{\n\t\tcode = originalCode;\n\t}\n\telse\n\t{\n\t\tif( originalCode != code )\n\t\t\t// URL must change!\n\t\t\tnewUrl = common.routes.itemTTT.edit.replace( common.routes.itemCodeParameter, code );\n\t\toriginalCode = code;\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): Launch request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.details( code );\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.refresh(): Error', { rc } );\n\t\tcommon.html.showMessage( message_refreshFailed+rc.errorMessage );\n\t\treturn false;\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): Load from new item', { rc } );\n\titem.fromDictObj( rc.item );\n\n\tif( newUrl != null )\n\t{\n\t\tcommon.utils.log( `edit.refresh(): Update URL to \"${newUrl}\"` );\n\t\tcommon.url.pushHistory({ pathname:newUrl, newTitle:item.name() });\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): END' );\n\treturn true;\n}\n\n/** Used to add a changing parameter to the URL to bypass browser's cache */\nexport function scrambleUrl(url:string) : string\n{\n\tif( url.indexOf('?') >= 0 )\n\t\turl = url + '&';\n\telse\n\t\turl = url + '?';\n\turl = url + 'p=' + common.utils.newGuid();\n\treturn url;\n}\n\nclass ItemKO extends dto.ItemKO\n{\n\tpublic readonly features\t\t: KnockoutObservableArray<TranslationKO>;\n\tpublic readonly pictures\t\t: KnockoutObservableArray<ItemPicture>;\n\n\tconstructor($container:JQuery, src:dto.Item)\n\t{\n\t\tsuper( $container, src );\n\t\tthis.features\t= ko.observableArray( src.features.map(v=>new TranslationKO(v)) );\n\t\tthis.pictures\t= ko.observableArray( src.pictures );\n\t}\n\n\tprotected addNewFeature() : void\n\t{\n\t\tconst self = this;\n\t\tself.features.push( new TranslationKO() );\n\t}\n\n\tpublic /*override*/ toDictObj(dict?:dto.DictObj) : dto.Item\n\t{\n\t\tconst self = this;\n\t\tconst item = <dto.Item>super.toDictObj( dict );\n\t\titem.features\t= self.features().map( v=>{ return { en:v.en(), fr:'', nl:'' }; } );  // nb: only EN is used server-side\n\t\treturn item;\n\t}\n\n\tpublic /*override*/ fromDictObj(item:dto.Item) : void\n\t{\n\t\tconst self = this;\n\t\tsuper.fromDictObj( item );\n\t\tself.features( item.features.map( v=>{ return new TranslationKO(v); } ) );\n\t\tself.pictures( item.pictures );\n\t}\n}\n","\nimport * as common from \"../common\";\n\nexport namespace list\n{\n\texport const { e:ViewModes, a:allViewModes } = common.utils.strEnum([ 'grid', 'list' ]);\n\texport type ViewMode = keyof typeof ViewModes;\n\n\texport const { e:SortingFields, a:allSortingFields } = common.utils.strEnum([ 'price', 'price_desc', 'name', 'name_desc' ]);\n\texport type SortingField = keyof typeof SortingFields;\n\n\texport async function getListContent(p:GetListContentRequest) : Promise<string>\n\t{\n\t\tvar url = common.routes.itemTTT.list.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\t\treturn await common.url.getRequest( url, p );\n\t}\n\texport interface GetListContentRequest\n\t\t{\n\t\t\tviewMode?\t\t: ViewMode,\n\t\t\tsortingField?\t: SortingField,\n\t\t\tnoLayout?\t\t: boolean,\n\t\t};\n}\n","\nimport * as common from \"../common\";\nimport * as itemCtrl from \"../../Services/ItemController\";\nimport { list } from \"./ItemTTTController\";\nimport * as dto from \"../../DTOs/Item\";\nimport { Languages } from \"../../Language\";\n\nconst modelSearchString = '[type=ttt-model]';\n\nvar currentSortingField : list.SortingField;\nvar $txtSearch\t\t: JQuery;\nvar $cbShowInactive\t: JQuery;\nvar $divCarsList\t: JQuery;\nvar $divBlocking\t: JQuery;\n\nexport var itemsList : ItemKO[];\n\nexport async function init(p:{\tsortingField\t: list.SortingField,\n\t\t\t\t\t\t\t\t$txtSearch\t\t: JQuery,\n\t\t\t\t\t\t\t\t$cbShowInactive\t: JQuery,\n\t\t\t\t\t\t\t\t$divCarsList\t: JQuery,\n\t\t\t\t\t\t\t\t$btnViewList\t: JQuery,\n\t\t\t\t\t\t\t\t$btnViewGrid\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSortName\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSortPrice\t: JQuery }) : Promise<void>\n{\n\tcommon.utils.log( 'list.init(): START' );\n\n\tcurrentSortingField\t= p.sortingField;\n\t$txtSearch\t\t\t= p.$txtSearch;\n\t$cbShowInactive\t\t= p.$cbShowInactive.prop( 'checked', true );\n\t$divCarsList\t\t= p.$divCarsList;\n\t$divBlocking\t\t= $divCarsList;\n\tp.$btnViewGrid\t.click( ()=>{ refreshList({ viewMode:list.ViewModes.grid }) } );\n\tp.$btnViewList\t.click( ()=>{ refreshList({ viewMode:list.ViewModes.list }) } );\n\tp.$btnSortName\t.click( ()=>{ refreshList({ sortingField:list.SortingFields.name }) } );\n\tp.$btnSortPrice\t.click( ()=>{ refreshList({ sortingField:list.SortingFields.price }) } );\n\n\treconstructItemsList();\n\n\tcommon.utils.log( 'list.init(): Bind JQuery events' );\n\t$txtSearch.keyup( ()=>{ filterItemsList(); } );\n\t$cbShowInactive.change( ()=>{ filterItemsList(); } );\n\n\tcommon.utils.log( 'list.init(): END' );\n}\n\nfunction reconstructItemsList() : void\n{\n\tcommon.utils.log( 'list.reconstructItemsList(): START' );\n\n\tconst $models = $divCarsList.find( modelSearchString );\n\n\tcommon.utils.log( `list.reconstructItemsList(): Reconstructing ${$models.length} models`  );\n\tconst items : ItemKO[] = [];\n\t$models.each( (i,e)=>\n\t\t{\n\t\t\t// Find the JSON model's tag & set its parent element as the item's container\n\t\t\tconst $modelElement = $(e);\n\t\t\tconst $container = $modelElement.parent();\n\t\t\tconst model = <dto.Item>JSON.parse( $modelElement.text() );\n\n\t\t\t// Remove the model tag (i.e. free memory ?)\n\t\t\t$modelElement.remove();\n\n\t\t\t// Create the ItemKO and add it to the list\n\t\t\tconst item = new ItemKO( $container, model );\n\t\t\titems.push( item );\n\t\t} );\n\n\tcommon.utils.log( 'list.reconstructItemsList(): Replacing itemsList'  );\n\titemsList = items;\n\n\tcommon.utils.log( 'list.reconstructItemsList(): END' );\n}\n\nexport function filterItemsList() : void\n{\n\titemsList.forEach( (item)=>\n\t\t{\n\t\t\titem.visible( item.getIsVisible() );\n\t\t} );\n}\n\nasync function refreshList(p:list.GetListContentRequest) : Promise<void>\n{\n\tcommon.utils.log( 'list.refreshList(): START', { p, currentSortingField } );\n\n\t// Ask for the stripped version of the page (no layout)\n\tp.noLayout = true;\n\n\t// Switch to descending order if required\n\tif( p.sortingField != null )\n\t{\n\t\tif( p.sortingField == currentSortingField )\n\t\t{\n\t\t\tswitch( currentSortingField )\n\t\t\t{\n\t\t\t\tcase list.SortingFields.name:\tp.sortingField = list.SortingFields.name_desc;\tbreak;\n\t\t\t\tcase list.SortingFields.price:\tp.sortingField = list.SortingFields.price_desc;\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tcurrentSortingField = p.sortingField;\n\t}\n\n\tcommon.utils.log( 'list.refreshList(): Request html & replace list DOM' );\n\tcommon.html.block( $divBlocking );\n\tvar html = await list.getListContent( p );\n\tcommon.html.unblock( $divBlocking );\n\t$divCarsList.html( html );\n\n\treconstructItemsList();\n\n\tcommon.utils.log( 'list.refreshList(): END', { currentSortingField } );\n}\n\nclass ItemKO extends dto.ItemKO\n{\n\tpublic readonly $container\t: JQuery;\n\tpublic readonly visible\t\t: KnockoutObservable<boolean>;\n\n\tconstructor($container:JQuery, model:dto.Item)\n\t{\n\t\tconst required = [\tcommon.utils.nameof<dto.ItemKO>('code'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('name'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionEN'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionFR'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionNL'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('active') ];\n\t\tsuper( $container, model, required );\n\t\tconst self = this;\n\t\tthis.$container\t= $container;\n\t\tthis.visible\t= ko.observable( self.getIsVisible() );\n\n\t\t// Bind this object to its container\n\t\tko.applyBindings( self, $container[0] );\n\t}\n\n\tpublic async toggleActive() : Promise<void>\n\t{\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): START' );\n\t\tconst self = this;\n\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): Retreive original model' );\n\t\tcommon.html.block( $divBlocking );\n\t\t{\n\t\t\tconst rc = await itemCtrl.details( self.code() );\n\t\t\tif(! rc.success )\n\t\t\t{\n\t\t\t\tcommon.html.unblock( $divBlocking );\n\t\t\t\tcommon.utils.error( 'Item retreive error', { rc } );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar model = rc.item;\n\t\t}\n\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): Toggle active flag & save' );\n\t\t{\n\t\t\tmodel.active = (! model.active);\n\t\t\tconst rc = await itemCtrl.save({ originalCode:model.code, item:model });\n\t\t\tif(! rc.success )\n\t\t\t\tcommon.utils.error( 'Item save error', { rc } );\n\t\t}\n\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): Refresh' );\n\t\tawait refreshList({});\n\n\t\tcommon.html.unblock( $divBlocking );\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): END' );\n\t}\n\n\tpublic getIsVisible() : boolean\n\t{\n\t\tconst self = this;\n\n\t\t// Check \"show active\" checkbox\n\n\t\tconst showInactive = $cbShowInactive.is( ':checked' );\n\t\tif( ! self.active() )\n\t\t\tif( ! showInactive )\n\t\t\t\treturn false;\n\n\t\t// Check \"search\" textbox\n\n\t\tlet searchString = <string>$txtSearch.val();\n\t\tsearchString = (searchString == null ? '' : searchString).toLowerCase().trim();\n\t\tif( searchString == '' )\n\t\t\treturn true;\n\t\tlet searchWords : string[] = [];\n\t\t$.each( searchString.split(' '), function(i,word)\n\t\t\t{\n\t\t\t\tif( common.utils.stringIsNullOrWhitespace(word) )\n\t\t\t\t\treturn;\n\t\t\t\tsearchWords.push( word.trim() );\n\t\t\t} );\n\n\t\tconst searchFields : string[] = [];\n\t\tsearchFields.push( self.name() );\n\t\tswitch( common.pageParameters.currentLanguage )\n\t\t{\n\t\t\tcase Languages.en:\tsearchFields.push( self.descriptionEN() );\tbreak;\n\t\t\tcase Languages.fr:\tsearchFields.push( self.descriptionFR() );\tbreak;\n\t\t\tcase Languages.nl:\tsearchFields.push( self.descriptionNL() );\tbreak;\n\t\t}\n\n\t\tlet matchCount = 0;\n\t\tsearchWords.forEach( (word,i)=>\n\t\t\t{\n\t\t\t\tfor( let i=0; i<searchFields.length; ++i )\n\t\t\t\t{\n\t\t\t\t\tconst field = searchFields[i].toLowerCase();\n\t\t\t\t\tif( field.indexOf(word) >= 0 )\n\t\t\t\t\t{\n\t\t\t\t\t\t++ matchCount;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\tif( matchCount != searchWords.length )  // All words must match\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n}\n","\r\nimport * as common from \"./common\";\r\nimport { PageParameters } from \"../PageHelper\";\r\nimport { Routes } from \"../Routes\";\r\n\r\n\r\nexport const debugMessages : boolean = false;  // NB: 'export' so that it can be easily changed from the browser's console\r\nexport var pageParameters : PageParameters;\r\nexport var routes : Routes;\r\n\r\nexport function init(p:{ pageParameters:PageParameters })\r\n{\r\n\tpageParameters = p.pageParameters;\r\n\troutes = pageParameters.routes;\r\n\tutils.log( 'common.init()' );\r\n\r\n\tutils.log( 'common.init(): Add custom KnockoutHandler' );\r\n\r\n\tko.bindingHandlers.ttt_autocomplete =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst searchFunction : (term:string)=>Promise<string[]> = valueAccessor();\r\n\t\t\t\t\t\t$(element).autocomplete( {\tminLength\t: 0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsource\t\t: async (request:{term:string}, resolve:(list:string[])=>void)=>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst list = await searchFunction( request.term );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tresolve( list );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t},\r\n\t\t};\r\n\r\n\t// cf. https://knockoutjs.com/examples/animatedTransitions.html\r\n\tko.bindingHandlers.ttt_slideUpDownVisible =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif(! value )\r\n\t\t\t\t\t\t\t$(element).hide();\r\n\t\t\t\t\t},\r\n\t\t\tupdate: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif( value )\r\n\t\t\t\t\t\t\t$(element).slideDown();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t$(element).slideUp();\r\n\t\t\t\t\t}\r\n\t\t};\r\n\tko.bindingHandlers.ttt_slideLeftRightVisible =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif(! value )\r\n\t\t\t\t\t\t\t$(element).hide();\r\n\t\t\t\t\t},\r\n\t\t\tupdate: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif( value )\r\n\t\t\t\t\t\t\t$(element).show( 'blind', { direction: 'left' } );\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t$(element).hide( 'blind', { direction: 'left' } );\r\n\t\t\t\t\t}\r\n\t\t};\r\n}\r\n\r\nexport namespace utils\r\n{\r\n\texport function log(...optionalParams: any[]) : void\r\n\t{\r\n\t\tif( pageParameters.isDebug )\r\n\t\t\tconsole.log.apply( console, arguments );\r\n\t}\r\n\r\n\texport function error(...optionalParams: any[]) : void\r\n\t{\r\n\t\tconsole.error.apply( console, arguments );\r\n\t}\r\n\r\n\t/** cf. https://schneidenbach.gitbooks.io/typescript-cookbook/nameof-operator.html */\r\n\texport const nameof = <T>(name: keyof T) => name;\r\n\r\n\t/** Function to simulate string-valued enums\r\n\t * Based on: https://basarat.gitbooks.io/typescript/docs/types/literal-types.html\r\n\t * Returns: { e:the enum , a:the array specified as parameter } */\r\n\texport function strEnum<T extends string>(a:Array<T>): { e:{[K in T]: K}, a:T[] }\r\n\t{\r\n\t\tconst e = a.reduce( (res, key)=>\r\n\t\t\t{\r\n\t\t\t\tres[key] = key;\r\n\t\t\t\treturn res;\r\n\t\t\t}, Object.create(null) );\r\n\t\treturn { e, a };\r\n\t}\r\n\r\n\texport function stringIsNullOrEmpty(str:string) : boolean\r\n\t{\r\n\t\tif( str == null )\r\n\t\t\treturn true;\r\n\t\tif( str == '' )\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t}\r\n\texport function stringIsNullOrWhitespace(str:string) : boolean\r\n\t{\r\n\t\tif( str == null )\r\n\t\t\treturn true;\r\n\t\tif( str.trim() == '' )\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\texport function htmlEncode(txt:string|string[]) : string\r\n\t{\r\n\t\t// TODO: Find a better way ?\r\n\t\tif( Array.isArray(txt) )\r\n\t\t\treturn $.map( <string[]>txt, v=>$(document.createElement('span')).text( v ).html() ).join( '<br/>' );\r\n\t\telse\r\n\t\t\treturn $(document.createElement('span')).text( txt ).html();\r\n\t}\r\n\r\n\texport function arrayContains<T>(a:T[], item:any) : boolean\r\n\t{\r\n\t\treturn ( a.indexOf( item ) >= 0 );\r\n\t}\r\n\r\n//ES5 incompatible ...\r\n//\texport function arrayUnique<T>(a:T[]) : T[]\r\n//\t{\r\n//\t\t//return a.filter( (v,i)=>( a.indexOf(v) === i ) );\r\n//\t\treturn [ ... new Set(a) ];\r\n//\t}\r\n\r\n\texport function arrayRemoveItem<T>(a:T[], item:T) : boolean\r\n\t{\r\n\t\tlet i = a.indexOf( item );\r\n\t\tif( i < 0 )\r\n\t\t\treturn false;\r\n\t\ta.splice( i, 1 );\r\n\t\treturn true;\r\n\t}\r\n\r\n\texport function arraySum<T>(a:T[], f:(e:T)=>number) : number\r\n\t{\r\n\t\tlet rc = 0;\r\n\t\ta.forEach( function(e)\r\n\t\t\t{\r\n\t\t\t\trc += f(e);\r\n\t\t\t} );\r\n\t\treturn rc;\r\n\t}\r\n\r\n\texport function arrayMoveItem<T>(p:{ list:T[], item:T, direction?:'up'|'down' }) : T[]\r\n\t{\r\n\t\t// NB: Does not yet work when n>1 ...\r\n\r\n\t\tlet n = 1;\r\n\t\tif( p.direction != null )\r\n\t\t\tn = (p.direction == 'up') ? -n : n;\r\n\t\tconst i = p.list.indexOf( p.item );  // Start position\r\n\t\tif( i < 0 )\r\n\t\t\tthrow { error:'Could not find item in list', item:p.item };\r\n\t\tlet j = i + n;  // End position\r\n\t\tif( j < 0 )\r\n\t\t\tj = 0;\r\n\t\telse if( j >= p.list.length )\r\n\t\t\tj = p.list.length - 1;\r\n\t\tif( i == j )\r\n\t\t\t// NOOP\r\n\t\t\treturn p.list;\r\n\r\n\t\t// Swap items here\r\n\t\tconst tmp = p.list[ i ];\r\n\t\tp.list[ i ] = p.list[ j ];\r\n\t\tp.list[ j ] = tmp;\r\n\r\n\t\treturn p.list;\r\n\t}\r\n\r\n\texport function ensureInteger(p:{\tobservable:KnockoutObservable<Number>,\r\n\t\t\t\t\t\t\t\t\t\tfallbackValue?:number,\r\n\t\t\t\t\t\t\t\t\t\tmustBePositive?:boolean,\r\n\t\t\t\t\t\t\t\t\t\tcanBeZero?:boolean,\r\n\t\t\t\t\t\t\t\t\t\tcanBeNull?:boolean }) : void\r\n\t{\r\n\t\tif( p.canBeZero == null )\r\n\t\t\tp.canBeZero = true;\r\n\t\tif( p.canBeNull == null )\r\n\t\t\tp.canBeNull = false;\r\n\t\tif( p.fallbackValue == null )\r\n\t\t{\r\n\t\t\tif( p.canBeZero )\r\n\t\t\t\tp.fallbackValue = 0;\r\n\t\t\telse\r\n\t\t\t\tp.fallbackValue = 1;\r\n\t\t}\r\n\r\n\t\tlet canBeNull = p.canBeNull;\r\n\t\tp.observable.subscribe( function(value:number)\r\n\t\t\t{\r\n\t\t\t\tif( canBeNull )\r\n\t\t\t\t{\r\n\t\t\t\t\tif( (<any>value == '') || (value == null) )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tp.observable( null );\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar newValue = parseInt( <any>value );\r\n\r\n\t\t\t\tif( isNaN(newValue) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\t\t\t\telse if( (!p.canBeZero) && (value == 0) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\t\t\t\telse if( (p.mustBePositive) && (value < 0) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\r\n\t\t\t\tif( value !== newValue )\r\n\t\t\t\t\t// Value must be changed\r\n\t\t\t\t\tp.observable( newValue );\r\n\t\t\t} );\r\n\t}\r\n\r\n\t/** Generates a GUID-like string (something that looks like one, but NOT a real one!!!)\r\n\t * cf. http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript */\r\n\texport function newGuid() : string\r\n\t{\r\n\t\tvar S4 = function() : string\r\n\t\t{\r\n\t\t\treturn (((1+Math.random())*0x10000)|0).toString(16).substring(1);\r\n\t\t};\r\n\t\treturn (S4()+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+S4()+S4());\r\n\t}\r\n\r\n\texport function sleep(ms:number) : Promise<void>\r\n\t{\r\n\t\treturn new Promise( resolve => setTimeout(resolve, ms) );\r\n\t}\r\n} // namespace utils\r\n\r\nexport namespace html\r\n{\r\n\texport function showMessage(msg:string) : void\r\n\t{\r\n\t\t// Bootstrap style:\r\n\t\tconst html = `<div class=\"modal\" tabindex=\"-1\" role=\"dialog\">\r\n\t\t\t\t\t\t<div class=\"modal-dialog\" role=\"document\">\r\n\t\t\t\t\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t\t\t\t\t<div class=\"modal-body\">\r\n\t\t\t\t\t\t\t\t\t<!-- Text content here -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"modal-footer\">\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\tconst $div = $(html);\r\n\t\t$div.find( '.modal-body' ).text( msg );\r\n\t\t$div.modal();\r\n\r\n\t\t// JQuery style:\r\n\t\t// var $div = $('<div/>').text('Hello world');\r\n\t\t// $('body').append( $div );\r\n\t\t// $div.dialog()\r\n\t}\r\n\r\n\texport function confirm(msg:string) : Promise<boolean>\r\n\t{\r\n\t\t// Bootstrap style:\r\n\t\tconst html = `<div class=\"modal\" tabindex=\"-1\" role=\"dialog\">\r\n\t\t\t\t\t\t<div class=\"modal-dialog\" role=\"document\">\r\n\t\t\t\t\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t\t\t\t\t<div class=\"modal-body\">\r\n\t\t\t\t\t\t\t\t\t<!-- Text content here -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"modal-footer\">\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\">Save changes</button>\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\tconst $div = $(html);\r\n\t\t$div.find( '.modal-body' ).text( msg );\r\n\t\treturn new Promise<boolean>( (resolve)=>\r\n\t\t\t{\r\n\t\t\t\tlet confirmed = false;\r\n\t\t\t\t$div.find( '.btn-primary' ).click( ()=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconfirmed = true;\r\n\t\t\t\t\t\t$div.modal( 'hide' );\r\n\t\t\t\t\t\tresolve( true );\r\n\t\t\t\t\t} );\r\n\t\t\t\t$div.on( 'hidden.bs.modal', (e)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif( confirmed )\r\n\t\t\t\t\t\t\t// Clicked on 'Save' => NOOP\r\n\t\t\t\t\t\t\t// nb: should not happen, but in case ...\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t// Manually closed => Cancel\r\n\t\t\t\t\t\tresolve( false );\r\n\t\t\t\t\t} );\r\n\t\t\t\t$div.modal();\r\n\t\t\t} );\r\n\r\n\t\t// JQuery style:\r\n\t\t// TODO ...\r\n\t}\r\n\r\n\t/** Invoke jQuery.blockUI's '.block()' on the specified element but supports multiple invokation on the same element */\r\n\texport function block($e:JQuery) : JQuery\r\n\t{\r\n\t\t// Insert/increment a block counter as jQuery 'data()'\r\n\t\tvar blockCounter = ( $e.data('ttt_blockCounter')|0 ) + 1;\r\n\t\t$e.data( 'ttt_blockCounter', blockCounter );\r\n\r\n\t\tif( blockCounter == 1 )\r\n\t\t\t// This element is not blocked yet\r\n\t\t\t(<any>$e).block();  // TODO: ACA: jQuery.blockUI typings ...\r\n\r\n\t\treturn $e;\r\n\t}\r\n\r\n\t/** Invoke jQuery.blockUI's '.unblock()' on the specified element except if it has been block()ed more than once */\r\n\texport function unblock($e:JQuery) : JQuery\r\n\t{\r\n\t\t// Decrement the block counter in the jQuery 'data()'\r\n\t\tvar blockCounter = ( $e.data('ttt_blockCounter')|0 ) - 1;\r\n\t\t$e.data( 'ttt_blockCounter', blockCounter );\r\n\r\n\t\tif( blockCounter < 0 )\r\n\t\t{\r\n\t\t\t// There is a logic error somewhere...\r\n\t\t\tcommon.utils.error( 'INTERNAL ERROR: Unblock count > block count:', blockCounter );\r\n\r\n\t\t\t// Reset counter\r\n\t\t\tblockCounter = 0;\r\n\t\t\t$e.data( 'ttt_blockCounter', 0 );\r\n\t\t}\r\n\r\n\t\tif( blockCounter == 0 )\r\n\t\t\t// This element is no more blocked by anything else\r\n\t\t\t(<any>$e).unblock();  // TODO: ACA: jQuery.blockUI typings ...\r\n\r\n\t\treturn $e;\r\n\t}\r\n\r\n\texport function ensureVisible($e:JQuery) : void\r\n\t{\r\n\t\t// Scroll\r\n\t\tconst offset = $e.offset().top - ( 20 + $e.height() );\r\n\t\t$('html, body').animate({ scrollTop:offset });  // cf.: https://stackoverflow.com/questions/4884839/how-do-i-get-an-element-to-scroll-into-view-using-jquery?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa\r\n\r\n\t\t// Blink\r\n\t\t$e.effect( \"highlight\", {}, 2000 );  // cf.: https://stackoverflow.com/questions/5205445/jquery-blinking-highlight-effect-on-div?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa\r\n\t}\r\n\r\n\texport function waitForScrolledVisible($elem:JQuery) : Promise<void>\r\n\t{\r\n\t\tconst $window = $(window);\r\n\r\n\t\tfunction isScrolledVisible()\r\n\t\t{\r\n\t\t\tconst docViewTop = $window.scrollTop();\r\n\t\t\tconst docViewBottom = docViewTop + $window.height();\r\n\r\n\t\t\tconst elemTop = $elem.offset().top;\r\n\t\t\tconst elemBottom = elemTop + $elem.height();\r\n\t\t\treturn ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));\r\n\t\t}\r\n\r\n\t\treturn new Promise( (resolve)=>\r\n\t\t\t{\r\n\t\t\t\tlet scrollHandler : ()=>void;\r\n\t\t\t\tscrollHandler = function()\r\n\t\t\t\t{\r\n\t\t\t\t\tif(! isScrolledVisible() )\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// This is a one-shot only => unbind myself\r\n\t\t\t\t\t$window.unbind( 'scroll', scrollHandler );\r\n\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( isScrolledVisible() )\r\n\t\t\t\t\t// Element is visible right now => no need to bind to scroll event\r\n\t\t\t\t\tresolve();\r\n\t\t\t\telse  // Bind to scroll event & wait for $elem to be visible\r\n\t\t\t\t\t$window.bind( 'scroll', scrollHandler );\r\n\t\t\t} );\r\n\t}\r\n} // namespace html\r\n\r\nexport namespace url\r\n{\r\n\tconst onChangedEvent = 'onUrlChanged';\r\n\tvar onChangedCallbacks = $({});\r\n\tvar onChangedCallbacksRegistered = false;\r\n\r\n\texport function redirect(url:string)\r\n\t{\r\n\t\twindow.location.href = url;\r\n\t}\r\n\r\n\t/** Parse a parameters string like 'foo=bar&hello=world' and return the a dictionary like {foo:'bar',hello:'world'} */\r\n\texport function parseParameters(searchString?:string) : {[key:string]:any}\r\n\t{\r\n\t\tif( searchString == null )\r\n\t\t\tsearchString = window.location.search.substring(1);\r\n\t\tif( searchString.length == 0 )\r\n\t\t\treturn {};\r\n\r\n\t\tvar tokens = searchString.split( '&' );\r\n\r\n\t\tvar dict = <{[key:string]:any}>{};\r\n\t\tfor( var i=0; i < tokens.length; ++i )\r\n\t\t{\r\n\t\t\tvar pairs = tokens[i].split( '=' );\r\n\t\t\tvar key = decodeURIComponent( pairs[0] );\r\n\t\t\tvar value = decodeURIComponent( pairs[1] );\r\n\r\n\t\t\t// Try parse JSON\r\n\t\t\ttry { value = JSON.parse(value); }\r\n\t\t\tcatch( ex ){/* Not JSON => Keep the string as-is*/}\r\n\r\n\t\t\tdict[ key ] = value;\r\n\t\t}\r\n\t\treturn dict;\r\n\t}\r\n\r\n\t/** Transform a dictionary like {foo:'bar',hello:'world'} to a parameters string like 'foo=bar&hello=world' */\r\n\texport function stringifyParameters(parms:{[key:string]:any}) : string\r\n\t{\r\n\t\tvar pairs = <string[]>[];\r\n\t\t$.each( parms, function(key:string,value)\r\n\t\t\t{\r\n\t\t\t\tkey = encodeURIComponent( key );\r\n\r\n\t\t\t\tif( (value == null) || (typeof(value) === 'string') || (typeof(value) === 'number') || (typeof(value) === 'boolean') )\r\n\t\t\t\t\t{/*Keep as-is*/}\r\n\t\t\t\telse\r\n\t\t\t\t\t// Convert to JSON\r\n\t\t\t\t\tvalue = JSON.stringify( value );\r\n\t\t\t\tvalue = encodeURIComponent( value );\r\n\r\n\t\t\t\tpairs.push( key+\"=\"+value );\r\n\t\t\t} );\r\n\t\treturn pairs.join( '&' );\r\n\t}\r\n\r\n\t/** Registers a callback to be invoked whenever the browser's URL changes (cf. 'pushHistory()') */\r\n\texport function onChanged(callback:()=>void) : void\r\n\t{\r\n\t\t// NB: The callback gets invoked ALSO when 'pushHistory()' is invoked\r\n\r\n\t\tif( onChangedCallbacksRegistered == false )\r\n\t\t{\r\n\t\t\t$(window).bind( 'popstate', function(evt)\r\n\t\t\t\t{\r\n\t\t\t\t\tonChangedCallbacks.trigger( onChangedEvent );\r\n\t\t\t\t} );\r\n\t\t\tonChangedCallbacksRegistered = true;\r\n\t\t}\r\n\r\n\t\tonChangedCallbacks.bind( onChangedEvent, callback );\r\n\t}\r\n\r\n\texport function createUrl(p:{ pathname?:string, parameters?:{[key:string]:any} }) : string\r\n\t{\r\n\t\tvar newPath = p.pathname;\r\n\t\tif( newPath == null )\r\n\t\t\tnewPath = window.location.pathname;\r\n\r\n\t\tif( p.parameters != null )\r\n\t\t{\r\n\t\t\tconst queryString = stringifyParameters( p.parameters );\r\n\t\t\tif( queryString.length > 0 )\r\n\t\t\t\tnewPath = newPath+'?'+queryString;\r\n\t\t}\r\n\t\treturn newPath;\r\n\t}\r\n\r\n\t/** Change the browser's current URL without triggering an HTTP request (NB: Will trigger any registered 'onChanged()' callbacks) */\r\n\texport function pushHistory(p:{ pathname?:string, parameters?:{[key:string]:any}, newTitle?:string }) : void\r\n\t{\r\n\t\tconst newPath = createUrl( p );\r\n\t\twindow.history.pushState( {}, p.newTitle, newPath );\r\n\r\n\t\t// Invoke any registered callbacks\r\n\t\tonChangedCallbacks.trigger( onChangedEvent );\r\n\t}\r\n\r\n\texport function postRequestForm<T>(url:string, request:{[key:string]:any}) : Promise<T>\r\n\t{\r\n\t\tutils.log( 'postRequestForm', { url, request } );\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'POST',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'application/x-www-form-urlencoded',\r\n\t\t\t\t\t\t\tdata\t\t: request,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'postRequestForm', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'postRequestForm rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function postRequestFormData<T>(url:string, formData:FormData) : Promise<T>\r\n\t{\r\n\t\tutils.log( 'postRequestFormData', { url, formData } );\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax( {\ttype\t\t: \"POST\",\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: false,\r\n\t\t\t\t\t\t\tprocessData\t: false,\r\n\t\t\t\t\t\t\tdata\t\t: formData,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data:T,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'postRequestFormData', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'postRequestFormData rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t} );\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function postRequestJSON<T>(url:string, request:{[key:string]:any}) : Promise<T>\r\n\t{\r\n\t\tutils.log( 'postRequestJSON', { url, request } );\r\n\t\tlet requestStr = JSON.stringify( request );\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'POST',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'application/json',\r\n\t\t\t\t\t\t\tdata\t\t: requestStr,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'postRequestJSON', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'postRequestJSON rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function getRequest(url:string, request?:{[key:string]:any}) : Promise<string>\r\n\t{\r\n\t\tif( request != null )\r\n\t\t{\r\n\t\t\tconst parms = stringifyParameters( request );\r\n\t\t\turl = `${url}?${parms}`;\r\n\t\t}\r\n\t\tutils.log( 'getRequest', { url, request } );\r\n\r\n\t\treturn new Promise<string>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'GET',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'text/html',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'getRequest', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'getRequest rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function downloadFile(url:string) : void\r\n\t{\r\n\t\t$(document.body).append( $(\"<iframe/>\").attr({\tsrc\t\t: url,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle\t: 'visibility:hidden;display:none' })\r\n\t\t\t\t\t\t\t\t);\r\n\t}\r\n\r\n} // namespace url\r\n\r\n// nb: Exports at the end or the order of execution breaks everything (i.e. strEnum must be defined before) ...\r\nexport * from \"../Language\";\r\nexport * from \"../PageHelper\";\r\nexport * from \"../Routes\";\r\n"]}