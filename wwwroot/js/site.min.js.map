{"version":3,"sources":["node_modules/browser-pack/_prelude.js","global.ts","src/DTOs/Item.ts","src/DTOs/Translation.ts","src/Language.ts","src/Services/ItemController.ts","src/Services/ItemPictureController.ts","src/Utils/BaseAutoItem.ts","src/Views/ItemTTT/Add.ts","src/Views/ItemTTT/Edit.ts","src/Views/ItemTTT/ItemTTTController.ts","src/Views/ItemTTT/List.ts","src/Views/common.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","ttt","common","itemttt","list","add","edit","window","ItemKO","_super","$container","src","fieldNames","_this","name","features","options","pictures","self","this","price","utils","ensureInteger","observable","canBeZero","canBeNull","mustBePositive","__extends","prototype","toDictObj","dict","BaseAutoItem","TranslationKO","en","ko","Languages","_a","strEnum","allLanguages","getUrlCode","originalCode","stringIsNullOrWhitespace","url","getRequest","routes","api","sent","details","itemDetails","replace","itemCodeParameter","postRequestJSON","rc","item","result","save","itemSave","newCode","delete_","itemDelete","upload","itemCode","file","itemPictureUpload","formData","FormData","append","Promise","resolve","reject","$","ajax","type","contentType","processData","data","dataType","success","textStatus","jqXHR","imageNumber","error","errorThrown","itemPictureDelete","postRequestForm","number","reorder","itemPictureReorder","newNumber","setMain","itemPictureSetMain","isMain","fieldTagAttribute","knockoutify","dictKO","each","fieldName","fromDictObj","find","attr","indexOf","push","forEach","$blockingDiv","dto","ctrl","log","obj","html","block","unblock","itemTTT","itemEdit","redirect","showMessage","errorMessage","init","$fieldsContainer","applyBindings","$btnSave","click","picCtrl","Translation_1","message_confirmDelete","message_saveSuccess","message_refreshFailed","message_confirmDeletePicture","refresh","uploadPicture","files","undefined","tasks","map","all","rcs","newUrl","pushHistory","pathname","newTitle","$dropZone","$upload","model","$btnDelete","confirmed","confirm","itemsList","languageParameter","pageParameters","currentLanguage","$picUploadDropZone","$picUploadControl","picDropZone","hover","on","stopPropagation","preventDefault","originalEvent","dataTransfer","deletePicture","picture","toggleMainPicture","isMainImage","reorderPicture","offset","scrambleUrl","newGuid","observableArray","v","addNewFeature","addNewOption","fr","nl","ViewModes","allViewModes","_b","SortingFields","allSortingFields","getListContent","currentSortingField","$txtSearch","$cbShowInactive","$divCarsList","$divBlocking","ItemTTTController_1","Language_1","modelSearchString","reconstructItemsList","$models","items","$modelElement","parent","JSON","parse","text","remove","filterItemsList","visible","getIsVisible","refreshList","noLayout","sortingField","name_desc","price_desc","prop","$btnViewGrid","viewMode","grid","$btnViewList","$btnSortName","$btnSortPrice","keyup","change","required","nameof","toggleActive","console","warn","showInactive","is","active","searchString","val","toLowerCase","trim","searchWords","split","word","searchFields","descriptionEN","descriptionFR","descriptionNL","matchCount","i_1","html_1","debugMessages","bindingHandlers","ttt_slideUpDownVisible","element","valueAccessor","unwrap","hide","update","slideDown","slideUp","ttt_slideLeftRightVisible","show","direction","optionalParams","_i","arguments","isDebug","apply","reduce","res","key","Object","create","stringIsNullOrEmpty","str","htmlEncode","txt","Array","isArray","document","createElement","join","arrayContains","arrayRemoveItem","splice","arraySum","arrayMoveItem","j","tmp","fallbackValue","subscribe","value","newValue","parseInt","isNaN","S4","Math","random","toString","substring","sleep","ms","setTimeout","msg","$div","modal","$e","blockCounter","ensureVisible","top","height","animate","scrollTop","effect","url_1","onChangedEvent","onChangedCallbacks","onChangedCallbacksRegistered","stringifyParameters","parms","pairs","encodeURIComponent","stringify","createUrl","newPath","location","parameters","queryString","href","parseParameters","search","tokens","decodeURIComponent","ex","onChanged","callback","bind","evt","trigger","history","pushState","request","requestStr","downloadFile","body","style","__export"],"mappings":"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","file":"site.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\r\nimport * as common\t\tfrom \"./src/Views/common\";\r\nimport * as itemlist\tfrom \"./src/Views/ItemTTT/List\";\r\nimport * as itemadd\t\tfrom \"./src/Views/ItemTTT/Add\";\r\nimport * as itemedit\tfrom \"./src/Views/ItemTTT/Edit\";\r\n\r\n///////\r\n\r\n// Global assignment of window.itemttt (will be available in each pages e.g. from the console):\r\nvar ttt =\r\n{\r\n\tcommon: common,\r\n\titemttt: {\r\n\t\tlist\t: itemlist,\r\n\t\tadd\t\t: itemadd,\r\n\t\tedit\t: itemedit,\r\n\t},\r\n}\r\ndeclare global\r\n{\r\n\tinterface Window { ttt: typeof ttt; }\r\n}\r\nwindow.ttt = ttt;\r\n","\nimport * as common from \"../Views/common\";\nimport { BaseAutoItem, DictObj } from \"../Utils/BaseAutoItem\";\nexport { DictObj, DictKO } from \"../Utils/BaseAutoItem\";\nimport { Translation } from \"./Translation\";\nimport { ItemPicture } from \"./ItemPicture\";\n\nexport interface Item extends DictObj\n{\n\tfeatures\t: Translation[];\n\toptions\t\t: Translation[];\n\tpictures\t: ItemPicture[];\n}\n\nexport class ItemKO extends BaseAutoItem\n{\n\tpublic readonly code\t\t\t: KnockoutObservable<string>;\n\tpublic readonly name\t\t\t: KnockoutObservable<string>;\n\tpublic readonly descriptionEN\t: KnockoutObservable<string>;\n\tpublic readonly descriptionFR\t: KnockoutObservable<string>;\n\tpublic readonly descriptionNL\t: KnockoutObservable<string>;\n\tpublic readonly active\t\t\t: KnockoutObservable<boolean>;\n\tpublic readonly price\t\t\t: KnockoutObservable<number>;\n\n\tconstructor($container:JQuery, src?:Item, fieldNames?:string[])\n\t{\n\t\tif( src == null )\n\t\t\tsrc = { name:'', features:[], options:[], pictures:[] };\n\t\tsuper( $container, src, fieldNames );\n\t\tconst self = this;\n\n\t\tif( self.price != null )\n\t\t\tcommon.utils.ensureInteger({ observable:self.price, canBeZero:false, canBeNull:true, mustBePositive:true });\n\t}\n\n\tpublic /*override*/ toDictObj(dict?:DictObj) : Item\n\t{\n\t\tconst rc = super.toDictObj( dict );\n\t\treturn <Item>rc;\n\t}\n}\n","\nexport interface Translation\n{\n\ten : string;\n\tfr : string;\n\tnl : string;\n}\n\nexport class TranslationKO\n{\n\tpublic readonly en\t: KnockoutObservable<string>;\n\n\tconstructor(src?:Translation)\n\t{\n\t\tif( src == null )\n\t\t\tsrc = <Translation>{ en:'' };\n\t\tthis.en = ko.observable( src.en );\n\t}\n}\n","\nimport * as common from \"./Views/common\";\n\nexport const { e:Languages, a:allLanguages } = common.utils.strEnum([ 'en', 'fr', 'nl' ]);\nexport type Language = keyof typeof Languages;\n","\nimport * as common from \"../Views/common\";\nimport { Item } from \"../DTOs/Item\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function getUrlCode(originalCode:string) : Promise<string>\n{\n\tif( common.utils.stringIsNullOrWhitespace(originalCode) )\n\t\treturn null;\n\treturn await common.url.getRequest( common.routes.api.getUrlCode, { originalCode } );\n}\n\nexport async function details(code:string) : Promise<DetailsResult>\n{\n\tconst url = common.routes.api.itemDetails.replace( common.routes.itemCodeParameter, code );\n\tconst rc = await common.url.postRequestJSON<DetailsResult>( url, {} );\n\trc.item = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface DetailsResult extends Result\n{\n\titem : Item;\n}\n\nexport async function save(p:SaveRequest) : Promise<SaveResult>\n{\n\tconst rc = await common.url.postRequestJSON<SaveResult>( common.routes.api.itemSave, p );\n\trc.newCode = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface SaveRequest\n{\n\toriginalCode?\t: string;\n\titem\t\t\t: Item;\n}\nexport interface SaveResult extends Result\n{\n\tnewCode : string;\n}\n\nexport async function delete_(code:string) : Promise<SaveResult>\n{\n\tconst url = common.routes.api.itemDelete.replace( common.routes.itemCodeParameter, code );\n\tconst rc = await common.url.postRequestJSON<SaveResult>( url, {} );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport function upload(itemCode:string, file:File) : Promise<UploadResult>\n{\n\tconst url = common.routes.api.itemPictureUpload.replace( common.routes.itemCodeParameter, itemCode );\n\tconst formData = new FormData();\n\tformData.append( 'file', file );\n\treturn new Promise<UploadResult>( (resolve,reject)=>\n\t\t{\n\t\t\t$.ajax( {\ttype\t\t: \"POST\",\n\t\t\t\t\t\turl\t\t\t: url,\n\t\t\t\t\t\tcontentType\t: false,\n\t\t\t\t\t\tprocessData\t: false,\n\t\t\t\t\t\tdata\t\t: formData,\n\t\t\t\t\t\tdataType\t: 'json',\n\t\t\t\t\t\tsuccess\t\t: (data:UploadResult,textStatus,jqXHR)=>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tdata.imageNumber = data.result;\n\t\t\t\t\t\t\t\t\t\t\tdelete data.result;\n\t\t\t\t\t\t\t\t\t\t\tresolve( data );\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t} );\n\t\t} );\n}\nexport interface UploadResult extends Result\n{\n\timageNumber : number;\n}\n\nexport async function delete_(p:{ itemCode:string, number:number }) : Promise<Result>\n{\n\tconst url = common.routes.api.itemPictureDelete.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number } );\n\treturn rc;\n}\n\nexport async function reorder(p:{ itemCode:string, number:number, newNumber:number }) : Promise<Result>\n{\n\tconst url = common.routes.api.itemPictureReorder.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number, newNumber:p.newNumber } );\n\treturn rc;\n}\n\nexport async function setMain(p:{ itemCode:string, number:number, isMain:boolean }) : Promise<Result>\n{\n\tconst url = common.routes.api.itemPictureSetMain.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number, isMain:p.isMain } );\n\treturn rc;\n}\n","\nconst fieldTagAttribute = 'ttt-name';\n\nexport type DictObj\t= {[key:string]:any};\nexport type DictKO\t= {[key:string]:KnockoutObservable<any>};\n\nexport abstract class BaseAutoItem\n{\n\tprivate readonly fieldNames : string[];\n\n\tconstructor($container:JQuery, src:DictObj, fieldNames?:string[])\n\t{\n\t\tthis.fieldNames = (fieldNames != null) ? fieldNames : [];\n\t\tthis.knockoutify( $container, src );\n\t}\n\n\tpublic toDictObj(dict?:DictObj) : DictObj\n\t{\n\t\tconst self = this;\n\t\tconst dictKO : DictKO = <any>self;\n\t\tif( dict == null )\n\t\t\tdict = {};\n\n\t\t$.each( self.fieldNames, (i,fieldName)=>\n\t\t\t{\n\t\t\t\tconst observable = dictKO[ fieldName ];\n\t\t\t\tdict[ fieldName ] = observable();\n\t\t\t} );\n\n\t\treturn dict;\n\t}\n\n\tpublic fromDictObj(dict:DictObj) : void\n\t{\n\t\tconst self = this;\n\t\tconst dictKO : DictKO = <any>self;\n\t\t$.each( self.fieldNames, (i,fieldName)=>\n\t\t\t{\n\t\t\t\tconst observable = dictKO[ fieldName ];\n\t\t\t\tobservable( dict[fieldName] );\n\t\t\t} );\n\t}\n\n\tprivate knockoutify($container:JQuery, src:DictObj) : void\n\t{\n\t\tconst self = this;\n\t\tconst dict : DictKO = <any>this;\n\n\t\t// For each tagged elements we find in '$container'\n\t\t$container.find( `[${fieldTagAttribute}]` ).each( (i,e)=>\n\t\t\t{\n\t\t\t\t// Extract the field name from that attribute\n\t\t\t\tconst $e = $(e);\n\t\t\t\tconst fieldName = $e.attr( fieldTagAttribute );\n\n\t\t\t\tif( self.fieldNames.indexOf(fieldName) >= 0 )\n\t\t\t\t\t// That field is already already listed\n\t\t\t\t\t{/*NOOP*/}\n\t\t\t\telse\n\t\t\t\t\t// Add that field to the fields list\n\t\t\t\t\tself.fieldNames.push( fieldName );\n\t\t\t} );\n\n\t\t// For each listed fields ...\n\t\tself.fieldNames.forEach( (fieldName)=>\n\t\t\t{\n\t\t\t\t// ... create a KO observable on 'this' and set it's value using 'src' ...\n\t\t\t\tdict[ fieldName ] = ko.observable( src[fieldName] );\n\t\t\t} );\n\t}\n}\n","\nimport * as common from \"../common\";\nimport * as dto from \"../../DTOs/Item\";\nimport * as ctrl from \"../../Services/ItemController\";\n\nvar $blockingDiv : JQuery;\nexport var item : dto.ItemKO;\n\nexport async function init(p:{\t$blockingDiv\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSave\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$fieldsContainer\t: JQuery }) : Promise<void>\n{\n\tcommon.utils.log( 'add.init() START', { p } );\n\t$blockingDiv = p.$blockingDiv;\n\n\tcommon.utils.log( 'add.init(): Create KO item' );\n\titem = new dto.ItemKO( p.$fieldsContainer );\n\n\tcommon.utils.log( 'add.init(): Apply KO item' );\n\tko.applyBindings( item, p.$fieldsContainer[0] );\n\n\tcommon.utils.log( 'add.init(): Bind JQuery events' );\n\tp.$btnSave.click( save );\n\n\tcommon.utils.log( 'add.init() END' );\n}\n\nasync function save() : Promise<void>\n{\n\tcommon.utils.log( 'add.save(): START' );\n\n\tconst obj = item.toDictObj();\n\n\tcommon.utils.log( 'add.save(): Launch save' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.save({ item:obj });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'add.save(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'add.save(): Redirect', { rc } );\n\tconst url = common.routes.itemTTT.itemEdit.replace( common.routes.itemCodeParameter, rc.newCode );\n\tcommon.utils.log( `add.save(): url=\"${url}\"` );\n\tcommon.url.redirect( url );\n\n\tcommon.utils.log( 'add.save(): END' );\n}\n","\nimport * as common from \"../common\";\nimport * as dto from \"../../DTOs/Item\";\nimport { ItemPicture } from \"../../DTOs/ItemPicture\";\nimport * as ctrl from \"../../Services/ItemController\";\nimport * as picCtrl from \"../../Services/ItemPictureController\";\nimport { TranslationKO } from \"../../DTOs/Translation\";\n\nconst message_confirmDelete = 'Are you sure you want to delete that item?';\nconst message_saveSuccess = 'Item saved successfully';\nconst message_refreshFailed = 'An error occured while refresing the data: ';\nconst message_confirmDeletePicture = 'Are you sure you want to delete that image?';\n\nvar $blockingDiv : JQuery;\nvar originalCode : string;\n\nexport var item\t\t\t: ItemKO;\nexport var picDropZone\t: { hover:KnockoutObservable<boolean> };\n\nexport async function init(p:{\tmodel\t\t\t\t: dto.Item,\n\t\t\t\t\t\t\t\t$blockingDiv\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSave\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnDelete\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$fieldsContainer\t: JQuery,\n\t\t\t\t\t\t\t\t$picUploadDropZone\t: JQuery,\n\t\t\t\t\t\t\t\t$picUploadControl\t: JQuery,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'edit.init() START', { p } );\n\t$blockingDiv = p.$blockingDiv;\n\n\tcommon.utils.log( 'edit.init(): Create KO item' );\n\titem = new ItemKO( p.$fieldsContainer, p.model );\n\toriginalCode = item.code();\n\n\tcommon.utils.log( 'edit.init(): Bind JQuery events' );\n\tp.$btnSave.click( save );\n\tp.$btnDelete.click( ()=>{ delete_(); } );\n\n\tcommon.utils.log( 'edit.init(): Init picture upload' );\n\tinitPictureUpload( p.$picUploadDropZone, p.$picUploadControl );\n\n\tcommon.utils.log( 'edit.init() END' );\n}\n\nfunction initPictureUpload($dropZone:JQuery, $upload:JQuery) : void\n{\n\tcommon.utils.log( 'edit.initDropZone(): Create drop zone object' );\n\n\tpicDropZone = {\n\t\t\thover : ko.observable(false),\n\t\t};\n\n\tcommon.utils.log( 'edit.initDropZone(): Watch for drag-drops on \"upload image drop zone\"' );\n\n\t$dropZone.on( 'dragenter', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( true );\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t} );\n\t$dropZone.on( 'dragover', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( true );\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t} );\n\t$dropZone.on( 'dragleave', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( false );\n\t\t} );\n\t$dropZone.on( 'drop', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( false );\n\t\t\te.preventDefault();\n\n\t\t\tvar files = (<any>e.originalEvent).dataTransfer.files;\n\t\t\tuploadPicture( files );\n\t\t});\n\n\t$upload.on( 'change', ()=>\n\t\t{\n\t\t\tconst files = (<HTMLInputElement>$upload[0]).files;\n\t\t\tuploadPicture( files );\n\t\t} );\n}\n\nasync function save() : Promise<void>\n{\n\tcommon.utils.log( 'edit.save(): START' );\n\n\tconst obj = item.toDictObj();\n\n\tcommon.utils.log( 'edit.save(): Launch save' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.save({ originalCode, item:obj });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.save(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.save(): Refresh values', { rc } );\n\tconst rcr = await refresh( rc.newCode );\n\tif( rcr )\n\t\tcommon.html.showMessage( message_saveSuccess );\n\n\tcommon.utils.log( 'edit.save(): END' );\n}\n\nasync function delete_(confirmed?:boolean) : Promise<void>\n{\n\tcommon.utils.log( 'edit.delete(): START' );\n\n\tif( confirmed != true )\n\t{\n\t\tcommon.utils.log( 'edit.delete(): Ask confirmation' );\n\t\tconst rc = await common.html.confirm( message_confirmDelete );\n\t\tif(! rc )\n\t\t{\n\t\t\tcommon.utils.log( 'edit.delete(): NOT CONFIRMED' );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommon.utils.log( 'edit.delete(): Launch delete' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.delete_( originalCode );\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.delete(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.delete(): Redirect' );\n\tconst url = common.routes.itemTTT.itemsList.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\tcommon.utils.log( 'edit.delete()', { url } );\n\tcommon.url.redirect( url );\n\n\tcommon.utils.log( 'edit.delete(): END' );\n}\n\nasync function uploadPicture(files:FileList) : Promise<void>\n{\n\tcommon.utils.log( 'edit.uploadPicture(): START', {files} );\n\n\tif( files.length == 0 )\n\t\treturn;\n\tif( (<any>window).FormData === undefined )\n\t{\n\t\tcommon.utils.error( \"This browser doesn't support HTML5 file uploads!\" );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( `edit.uploadPicture(): Create '${files.length}' upload tasks` );\n\tcommon.html.block( $blockingDiv );\n\tconst tasks = $.map( files, (file:File)=>\n\t\t{\n\t\t\treturn picCtrl.upload( originalCode, file );\n\t\t} );\n\n\tcommon.utils.log( 'edit.uploadPicture(): Wait for tasks to terminate' );\n\tconst rcs = await Promise.all( tasks );\n\tcommon.html.unblock( $blockingDiv );\n\tcommon.utils.log( 'edit.uploadPicture(): All tasks terminated' );\n\n\t$.each( rcs, (i,rc)=>\n\t\t{\n\t\t\tif(! rc )\n\t\t\t{\n\t\t\t\tcommon.utils.error( 'edit.delete(): Upload error', { i, rc } );\n\t\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\t}\n\t\t} );\n\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.uploadPicture(): END' );\n}\n\nexport async function deletePicture(picture:ItemPicture, confirmed?:boolean) : Promise<void>\n{\n\tcommon.utils.log( 'edit.deletePicture(): START' );\n\n\tif( confirmed != true )\n\t{\n\t\tcommon.utils.log( 'edit.deletePicture(): Ask confirmation' );\n\t\tconst rc = await common.html.confirm( message_confirmDeletePicture );\n\t\tif(! rc )\n\t\t{\n\t\t\tcommon.utils.log( 'edit.deletePicture(): NOT CONFIRMED' );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommon.utils.log( 'edit.deletePicture(): Launch delete request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.delete_({ itemCode:picture.itemCode, number:picture.number });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.deletePicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.deletePicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.deletePicture(): END' );\n}\n\nexport async function toggleMainPicture(picture:ItemPicture) : Promise<void>\n{\n\tcommon.utils.log( 'edit.toggleMainPicture(): START' );\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): Launch toggle request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.setMain({ itemCode:picture.itemCode, number:picture.number, isMain:(!picture.isMainImage) });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.toggleMainPicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): END' );\n}\n\nexport async function reorderPicture(picture:ItemPicture, offset:number) : Promise<void>\n{\n\tcommon.utils.log( 'edit.movePicture(): START' );\n\n\tlet newNumber = picture.number + offset;\n\tif( newNumber <= 0 )\n\t\tnewNumber = 1;\n\tif( picture.number == newNumber )\n\t\t// NOOP\n\t\treturn;\n\n\tcommon.utils.log( 'edit.movePicture(): Launch move request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.reorder({ itemCode:picture.itemCode, number:picture.number, newNumber:newNumber });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.movePicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.movePicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.movePicture(): END' );\n}\n\nasync function refresh(code?:string) : Promise<boolean>\n{\n\t// TODO: Allow refresh only images to avoid overwriting any modifications to input fields ...\n\tcommon.utils.log( 'edit.refresh(): START' );\n\n\tlet newUrl : string = null;\n\tif( code == null )\n\t{\n\t\tcode = originalCode;\n\t}\n\telse\n\t{\n\t\tif( originalCode != code )\n\t\t\t// URL must change!\n\t\t\tnewUrl = common.routes.itemTTT.itemEdit.replace( common.routes.itemCodeParameter, code );\n\t\toriginalCode = code;\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): Launch request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.details( code );\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.refresh(): Error', { rc } );\n\t\tcommon.html.showMessage( message_refreshFailed+rc.errorMessage );\n\t\treturn false;\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): Load from new item', { rc } );\n\titem.fromDictObj( rc.item );\n\n\tif( newUrl != null )\n\t{\n\t\tcommon.utils.log( `edit.refresh(): Update URL to \"${newUrl}\"` );\n\t\tcommon.url.pushHistory({ pathname:newUrl, newTitle:item.name() });\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): END' );\n\treturn true;\n}\n\n/** Used to add a changing parameter to the URL to bypass browser's cache */\nexport function scrambleUrl(url:string) : string\n{\n\tif( url.indexOf('?') >= 0 )\n\t\turl = url + '&';\n\telse\n\t\turl = url + '?';\n\turl = url + 'p=' + common.utils.newGuid();\n\treturn url;\n}\n\nclass ItemKO extends dto.ItemKO\n{\n\tpublic readonly features\t\t: KnockoutObservableArray<TranslationKO>;\n\tpublic readonly options\t\t\t: KnockoutObservableArray<TranslationKO>;\n\tpublic readonly pictures\t\t: KnockoutObservableArray<ItemPicture>;\n\n\tconstructor($container:JQuery, src:dto.Item)\n\t{\n\t\tsuper( $container, src );\n\t\tthis.features\t= ko.observableArray( src.features.map(v=>new TranslationKO(v)) );\n\t\tthis.options\t= ko.observableArray( src.options.map(v=>new TranslationKO(v)) );\n\t\tthis.pictures\t= ko.observableArray( src.pictures );\n\t}\n\n\tprotected addNewFeature() : void\n\t{\n\t\tconst self = this;\n\t\tself.features.push( new TranslationKO() );\n\t}\n\n\tprotected addNewOption() : void\n\t{\n\t\tconst self = this;\n\t\tself.options.push( new TranslationKO() );\n\t}\n\n\tpublic /*override*/ toDictObj(dict?:dto.DictObj) : dto.Item\n\t{\n\t\tconst self = this;\n\t\tconst item = <dto.Item>super.toDictObj( dict );\n\t\titem.features\t= self.features().map( v=>{ return { en:v.en(), fr:'', nl:'' }; } );  // nb: only EN is used server-side\n\t\titem.options\t= self.options().map( v=>{ return { en:v.en(), fr:'', nl:'' }; } );  // nb: only EN is used server-side\n\t\treturn item;\n\t}\n\n\tpublic /*override*/ fromDictObj(item:dto.Item) : void\n\t{\n\t\tconst self = this;\n\t\tsuper.fromDictObj( item );\n\t\tself.features( item.features.map( v=>{ return new TranslationKO(v); } ) );\n\t\tself.options( item.options.map( v=>{ return new TranslationKO(v); } ) );\n\t\tself.pictures( item.pictures );\n\t}\n}\n","\nimport * as common from \"../common\";\n\nexport namespace list\n{\n\texport const { e:ViewModes, a:allViewModes } = common.utils.strEnum([ 'grid', 'list' ]);\n\texport type ViewMode = keyof typeof ViewModes;\n\n\texport const { e:SortingFields, a:allSortingFields } = common.utils.strEnum([ 'price', 'price_desc', 'name', 'name_desc' ]);\n\texport type SortingField = keyof typeof SortingFields;\n\n\texport async function getListContent(p:GetListContentRequest) : Promise<string>\n\t{\n\t\tvar url = common.routes.itemTTT.itemsList.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\t\treturn await common.url.getRequest( url, p );\n\t}\n\texport interface GetListContentRequest\n\t\t{\n\t\t\tviewMode?\t\t: ViewMode,\n\t\t\tsortingField?\t: SortingField,\n\t\t\tnoLayout?\t\t: boolean,\n\t\t};\n}\n","\nimport * as common from \"../common\";\nimport { list } from \"./ItemTTTController\";\nimport * as dto from \"../../DTOs/Item\";\nimport { Languages } from \"../../Language\";\n\nconst modelSearchString = '[type=ttt-model]';\n\nvar currentSortingField : list.SortingField;\nvar $txtSearch\t\t: JQuery;\nvar $cbShowInactive\t: JQuery;\nvar $divCarsList\t: JQuery;\nvar $divBlocking\t: JQuery;\n\nexport var itemsList : ItemKO[];\n\nexport async function init(p:{\tsortingField\t: list.SortingField,\n\t\t\t\t\t\t\t\t$txtSearch\t\t: JQuery,\n\t\t\t\t\t\t\t\t$cbShowInactive\t: JQuery,\n\t\t\t\t\t\t\t\t$divCarsList\t: JQuery,\n\t\t\t\t\t\t\t\t$btnViewList\t: JQuery,\n\t\t\t\t\t\t\t\t$btnViewGrid\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSortName\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSortPrice\t: JQuery }) : Promise<void>\n{\n\tcommon.utils.log( 'list.init(): START' );\n\n\tcurrentSortingField\t= p.sortingField;\n\t$txtSearch\t\t\t= p.$txtSearch;\n\t$cbShowInactive\t\t= p.$cbShowInactive.prop( 'checked', true );\n\t$divCarsList\t\t= p.$divCarsList;\n\t$divBlocking\t\t= $divCarsList;\n\tp.$btnViewGrid\t.click( ()=>{ refreshList({ viewMode:list.ViewModes.grid }) } );\n\tp.$btnViewList\t.click( ()=>{ refreshList({ viewMode:list.ViewModes.list }) } );\n\tp.$btnSortName\t.click( ()=>{ refreshList({ sortingField:list.SortingFields.name }) } );\n\tp.$btnSortPrice\t.click( ()=>{ refreshList({ sortingField:list.SortingFields.price }) } );\n\n\treconstructItemsList();\n\n\tcommon.utils.log( 'list.init(): Bind JQuery events' );\n\t$txtSearch.keyup( ()=>{ filterItemsList(); } );\n\t$cbShowInactive.change( ()=>{ filterItemsList(); } );\n\n\tcommon.utils.log( 'list.init(): END' );\n}\n\nfunction reconstructItemsList() : void\n{\n\tcommon.utils.log( 'list.reconstructItemsList(): START' );\n\n\tconst $models = $divCarsList.find( modelSearchString );\n\n\tcommon.utils.log( `list.reconstructItemsList(): Reconstructing ${$models.length} models`  );\n\tconst items : ItemKO[] = [];\n\t$models.each( (i,e)=>\n\t\t{\n\t\t\t// Find the JSON model's tag & set its parent element as the item's container\n\t\t\tconst $modelElement = $(e);\n\t\t\tconst $container = $modelElement.parent();\n\t\t\tconst model = <dto.Item>JSON.parse( $modelElement.text() );\n\n\t\t\t// Remove the model tag (i.e. free memory ?)\n\t\t\t$modelElement.remove();\n\n\t\t\t// Create the ItemKO and add it to the list\n\t\t\tconst item = new ItemKO( $container, model );\n\t\t\titems.push( item );\n\t\t} );\n\n\tcommon.utils.log( 'list.reconstructItemsList(): Replacing itemsList'  );\n\titemsList = items;\n\n\tcommon.utils.log( 'list.reconstructItemsList(): END' );\n}\n\nexport function filterItemsList() : void\n{\n\titemsList.forEach( (item)=>\n\t\t{\n\t\t\titem.visible( item.getIsVisible() );\n\t\t} );\n}\n\nasync function refreshList(p:list.GetListContentRequest) : Promise<void>\n{\n\tcommon.utils.log( 'list.refreshList(): START', { p, currentSortingField } );\n\n\t// Ask for the stripped version of the page (no layout)\n\tp.noLayout = true;\n\n\t// Switch to descending order if required\n\tif( p.sortingField != null )\n\t{\n\t\tif( p.sortingField == currentSortingField )\n\t\t{\n\t\t\tswitch( currentSortingField )\n\t\t\t{\n\t\t\t\tcase list.SortingFields.name:\tp.sortingField = list.SortingFields.name_desc;\tbreak;\n\t\t\t\tcase list.SortingFields.price:\tp.sortingField = list.SortingFields.price_desc;\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tcurrentSortingField = p.sortingField;\n\t}\n\n\tcommon.utils.log( 'list.refreshList(): Request html & replace list DOM' );\n\tcommon.html.block( $divBlocking );\n\tvar html = await list.getListContent( p );\n\tcommon.html.unblock( $divBlocking );\n\t$divCarsList.html( html );\n\n\treconstructItemsList();\n\n\tcommon.utils.log( 'list.refreshList(): END', { currentSortingField } );\n}\n\nclass ItemKO extends dto.ItemKO\n{\n\tpublic readonly $container\t: JQuery;\n\tpublic readonly visible\t\t: KnockoutObservable<boolean>;\n\n\tconstructor($container:JQuery, model:dto.Item)\n\t{\n\t\tconst required = [\tcommon.utils.nameof<dto.ItemKO>('name'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionEN'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionFR'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionNL'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('active') ];\n\t\tsuper( $container, model, required );\n\t\tconst self = this;\n\t\tthis.$container\t= $container;\n\t\tthis.visible\t= ko.observable( self.getIsVisible() );\n\n\t\t// Bind this object to its container\n\t\tko.applyBindings( self, $container[0] );\n\t}\n\n\tpublic toggleActive() : void\n\t{\n\t\tconsole.warn( 'TODO: toggleActive', { self:this } );\n\t}\n\n\tpublic getIsVisible() : boolean\n\t{\n\t\tconst self = this;\n\n\t\t// Check \"show active\" checkbox\n\n\t\tconst showInactive = $cbShowInactive.is( ':checked' );\n\t\tif( ! self.active() )\n\t\t\tif( ! showInactive )\n\t\t\t\treturn false;\n\n\t\t// Check \"search\" textbox\n\n\t\tlet searchString = <string>$txtSearch.val();\n\t\tsearchString = (searchString == null ? '' : searchString).toLowerCase().trim();\n\t\tif( searchString == '' )\n\t\t\treturn true;\n\t\tlet searchWords : string[] = [];\n\t\t$.each( searchString.split(' '), function(i,word)\n\t\t\t{\n\t\t\t\tif( common.utils.stringIsNullOrWhitespace(word) )\n\t\t\t\t\treturn;\n\t\t\t\tsearchWords.push( word.trim() );\n\t\t\t} );\n\n\t\tconst searchFields : string[] = [];\n\t\tsearchFields.push( self.name() );\n\t\tswitch( common.pageParameters.currentLanguage )\n\t\t{\n\t\t\tcase Languages.en:\tsearchFields.push( self.descriptionEN() );\tbreak;\n\t\t\tcase Languages.fr:\tsearchFields.push( self.descriptionFR() );\tbreak;\n\t\t\tcase Languages.nl:\tsearchFields.push( self.descriptionNL() );\tbreak;\n\t\t}\n\n\t\tlet matchCount = 0;\n\t\tsearchWords.forEach( (word,i)=>\n\t\t\t{\n\t\t\t\tfor( let i=0; i<searchFields.length; ++i )\n\t\t\t\t{\n\t\t\t\t\tconst field = searchFields[i].toLowerCase();\n\t\t\t\t\tif( field.indexOf(word) >= 0 )\n\t\t\t\t\t{\n\t\t\t\t\t\t++ matchCount;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\tif( matchCount != searchWords.length )  // All words must match\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n}\n","\r\nimport * as common from \"./common\";\r\nimport { PageParameters } from \"../PageHelper\";\r\nimport { Routes } from \"../Routes\";\r\n\r\n\r\nexport const debugMessages : boolean = false;  // NB: 'export' so that it can be easily changed from the browser's console\r\nexport var pageParameters : PageParameters;\r\nexport var routes : Routes;\r\n\r\nexport function init(p:{ pageParameters:PageParameters })\r\n{\r\n\tpageParameters = p.pageParameters;\r\n\troutes = pageParameters.routes;\r\n\tutils.log( 'common.init()' );\r\n\r\n\tutils.log( 'common.init(): Add custom KnockoutHandler' );\r\n\t// cf. https://knockoutjs.com/examples/animatedTransitions.html\r\n\tko.bindingHandlers.ttt_slideUpDownVisible =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif(! value )\r\n\t\t\t\t\t\t\t$(element).hide();\r\n\t\t\t\t\t},\r\n\t\t\tupdate: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif( value )\r\n\t\t\t\t\t\t\t$(element).slideDown();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t$(element).slideUp();\r\n\t\t\t\t\t}\r\n\t\t};\r\n\tko.bindingHandlers.ttt_slideLeftRightVisible =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif(! value )\r\n\t\t\t\t\t\t\t$(element).hide();\r\n\t\t\t\t\t},\r\n\t\t\tupdate: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif( value )\r\n\t\t\t\t\t\t\t$(element).show( 'blind', { direction: 'left' } );\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t$(element).hide( 'blind', { direction: 'left' } );\r\n\t\t\t\t\t}\r\n\t\t};\r\n}\r\n\r\nexport namespace utils\r\n{\r\n\texport function log(...optionalParams: any[]) : void\r\n\t{\r\n\t\tif( pageParameters.isDebug )\r\n\t\t\tconsole.log.apply( console, arguments );\r\n\t}\r\n\r\n\texport function error(...optionalParams: any[]) : void\r\n\t{\r\n\t\tconsole.error.apply( console, arguments );\r\n\t}\r\n\r\n\t/** cf. https://schneidenbach.gitbooks.io/typescript-cookbook/nameof-operator.html */\r\n\texport const nameof = <T>(name: keyof T) => name;\r\n\r\n\t/** Function to simulate string-valued enums\r\n\t * Based on: https://basarat.gitbooks.io/typescript/docs/types/literal-types.html\r\n\t * Returns: { e:the enum , a:the array specified as parameter } */\r\n\texport function strEnum<T extends string>(a:Array<T>): { e:{[K in T]: K}, a:T[] }\r\n\t{\r\n\t\tconst e = a.reduce( (res, key)=>\r\n\t\t\t{\r\n\t\t\t\tres[key] = key;\r\n\t\t\t\treturn res;\r\n\t\t\t}, Object.create(null) );\r\n\t\treturn { e, a };\r\n\t}\r\n\r\n\texport function stringIsNullOrEmpty(str:string) : boolean\r\n\t{\r\n\t\tif( str == null )\r\n\t\t\treturn true;\r\n\t\tif( str == '' )\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t}\r\n\texport function stringIsNullOrWhitespace(str:string) : boolean\r\n\t{\r\n\t\tif( str == null )\r\n\t\t\treturn true;\r\n\t\tif( str.trim() == '' )\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\texport function htmlEncode(txt:string|string[]) : string\r\n\t{\r\n\t\t// TODO: Find a better way ?\r\n\t\tif( Array.isArray(txt) )\r\n\t\t\treturn $.map( <string[]>txt, v=>$(document.createElement('span')).text( v ).html() ).join( '<br/>' );\r\n\t\telse\r\n\t\t\treturn $(document.createElement('span')).text( txt ).html();\r\n\t}\r\n\r\n\texport function arrayContains<T>(a:T[], item:any) : boolean\r\n\t{\r\n\t\treturn ( a.indexOf( item ) >= 0 );\r\n\t}\r\n\r\n//ES5 incompatible ...\r\n//\texport function arrayUnique<T>(a:T[]) : T[]\r\n//\t{\r\n//\t\t//return a.filter( (v,i)=>( a.indexOf(v) === i ) );\r\n//\t\treturn [ ... new Set(a) ];\r\n//\t}\r\n\r\n\texport function arrayRemoveItem<T>(a:T[], item:T) : boolean\r\n\t{\r\n\t\tlet i = a.indexOf( item );\r\n\t\tif( i < 0 )\r\n\t\t\treturn false;\r\n\t\ta.splice( i, 1 );\r\n\t\treturn true;\r\n\t}\r\n\r\n\texport function arraySum<T>(a:T[], f:(e:T)=>number) : number\r\n\t{\r\n\t\tlet rc = 0;\r\n\t\ta.forEach( function(e)\r\n\t\t\t{\r\n\t\t\t\trc += f(e);\r\n\t\t\t} );\r\n\t\treturn rc;\r\n\t}\r\n\r\n\texport function arrayMoveItem<T>(p:{ list:T[], item:T, direction?:'up'|'down' }) : T[]\r\n\t{\r\n\t\t// NB: Does not yet work when n>1 ...\r\n\r\n\t\tlet n = 1;\r\n\t\tif( p.direction != null )\r\n\t\t\tn = (p.direction == 'up') ? -n : n;\r\n\t\tconst i = p.list.indexOf( p.item );  // Start position\r\n\t\tif( i < 0 )\r\n\t\t\tthrow { error:'Could not find item in list', item:p.item };\r\n\t\tlet j = i + n;  // End position\r\n\t\tif( j < 0 )\r\n\t\t\tj = 0;\r\n\t\telse if( j >= p.list.length )\r\n\t\t\tj = p.list.length - 1;\r\n\t\tif( i == j )\r\n\t\t\t// NOOP\r\n\t\t\treturn p.list;\r\n\r\n\t\t// Swap items here\r\n\t\tconst tmp = p.list[ i ];\r\n\t\tp.list[ i ] = p.list[ j ];\r\n\t\tp.list[ j ] = tmp;\r\n\r\n\t\treturn p.list;\r\n\t}\r\n\r\n\texport function ensureInteger(p:{\tobservable:KnockoutObservable<Number>,\r\n\t\t\t\t\t\t\t\t\t\tfallbackValue?:number,\r\n\t\t\t\t\t\t\t\t\t\tmustBePositive?:boolean,\r\n\t\t\t\t\t\t\t\t\t\tcanBeZero?:boolean,\r\n\t\t\t\t\t\t\t\t\t\tcanBeNull?:boolean }) : void\r\n\t{\r\n\t\tif( p.canBeZero == null )\r\n\t\t\tp.canBeZero = true;\r\n\t\tif( p.canBeNull == null )\r\n\t\t\tp.canBeNull = false;\r\n\t\tif( p.fallbackValue == null )\r\n\t\t{\r\n\t\t\tif( p.canBeZero )\r\n\t\t\t\tp.fallbackValue = 0;\r\n\t\t\telse\r\n\t\t\t\tp.fallbackValue = 1;\r\n\t\t}\r\n\r\n\t\tlet canBeNull = p.canBeNull;\r\n\t\tp.observable.subscribe( function(value:number)\r\n\t\t\t{\r\n\t\t\t\tif( canBeNull )\r\n\t\t\t\t{\r\n\t\t\t\t\tif( (<any>value == '') || (value == null) )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tp.observable( null );\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar newValue = parseInt( <any>value );\r\n\r\n\t\t\t\tif( isNaN(newValue) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\t\t\t\telse if( (!p.canBeZero) && (value == 0) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\t\t\t\telse if( (p.mustBePositive) && (value < 0) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\r\n\t\t\t\tif( value !== newValue )\r\n\t\t\t\t\t// Value must be changed\r\n\t\t\t\t\tp.observable( newValue );\r\n\t\t\t} );\r\n\t}\r\n\r\n\t/** Generates a GUID-like string (something that looks like one, but NOT a real one!!!)\r\n\t * cf. http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript */\r\n\texport function newGuid() : string\r\n\t{\r\n\t\tvar S4 = function() : string\r\n\t\t{\r\n\t\t\treturn (((1+Math.random())*0x10000)|0).toString(16).substring(1);\r\n\t\t};\r\n\t\treturn (S4()+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+S4()+S4());\r\n\t}\r\n\r\n\texport function sleep(ms:number) : Promise<void>\r\n\t{\r\n\t\treturn new Promise( resolve => setTimeout(resolve, ms) );\r\n\t}\r\n} // namespace utils\r\n\r\nexport namespace html\r\n{\r\n\texport function showMessage(msg:string) : void\r\n\t{\r\n\t\t// Bootstrap style:\r\n\t\tconst html = `<div class=\"modal\" tabindex=\"-1\" role=\"dialog\">\r\n\t\t\t\t\t\t<div class=\"modal-dialog\" role=\"document\">\r\n\t\t\t\t\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t\t\t\t\t<div class=\"modal-body\">\r\n\t\t\t\t\t\t\t\t\t<!-- Text content here -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"modal-footer\">\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\tconst $div = $(html);\r\n\t\t$div.find( '.modal-body' ).text( msg );\r\n\t\t$div.modal();\r\n\r\n\t\t// JQuery style:\r\n\t\t// var $div = $('<div/>').text('Hello world');\r\n\t\t// $('body').append( $div );\r\n\t\t// $div.dialog()\r\n\t}\r\n\r\n\texport function confirm(msg:string) : Promise<boolean>\r\n\t{\r\n\t\t// Bootstrap style:\r\n\t\tconst html = `<div class=\"modal\" tabindex=\"-1\" role=\"dialog\">\r\n\t\t\t\t\t\t<div class=\"modal-dialog\" role=\"document\">\r\n\t\t\t\t\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t\t\t\t\t<div class=\"modal-body\">\r\n\t\t\t\t\t\t\t\t\t<!-- Text content here -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"modal-footer\">\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\">Save changes</button>\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\tconst $div = $(html);\r\n\t\t$div.find( '.modal-body' ).text( msg );\r\n\t\treturn new Promise<boolean>( (resolve)=>\r\n\t\t\t{\r\n\t\t\t\tlet confirmed = false;\r\n\t\t\t\t$div.find( '.btn-primary' ).click( ()=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconfirmed = true;\r\n\t\t\t\t\t\t$div.modal( 'hide' );\r\n\t\t\t\t\t\tresolve( true );\r\n\t\t\t\t\t} );\r\n\t\t\t\t$div.on( 'hidden.bs.modal', (e)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif( confirmed )\r\n\t\t\t\t\t\t\t// Clicked on 'Save' => NOOP\r\n\t\t\t\t\t\t\t// nb: should not happen, but in case ...\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t// Manually closed => Cancel\r\n\t\t\t\t\t\tresolve( false );\r\n\t\t\t\t\t} );\r\n\t\t\t\t$div.modal();\r\n\t\t\t} );\r\n\r\n\t\t// JQuery style:\r\n\t\t// TODO ...\r\n\t}\r\n\r\n\t/** Invoke jQuery.blockUI's '.block()' on the specified element but supports multiple invokation on the same element */\r\n\texport function block($e:JQuery) : JQuery\r\n\t{\r\n\t\t// Insert/increment a block counter as jQuery 'data()'\r\n\t\tvar blockCounter = ( $e.data('ttt_blockCounter')|0 ) + 1;\r\n\t\t$e.data( 'ttt_blockCounter', blockCounter );\r\n\r\n\t\tif( blockCounter == 1 )\r\n\t\t\t// This element is not blocked yet\r\n\t\t\t(<any>$e).block();  // TODO: ACA: jQuery.blockUI typings ...\r\n\r\n\t\treturn $e;\r\n\t}\r\n\r\n\t/** Invoke jQuery.blockUI's '.unblock()' on the specified element except if it has been block()ed more than once */\r\n\texport function unblock($e:JQuery) : JQuery\r\n\t{\r\n\t\t// Decrement the block counter in the jQuery 'data()'\r\n\t\tvar blockCounter = ( $e.data('ttt_blockCounter')|0 ) - 1;\r\n\t\t$e.data( 'ttt_blockCounter', blockCounter );\r\n\r\n\t\tif( blockCounter < 0 )\r\n\t\t{\r\n\t\t\t// There is a logic error somewhere...\r\n\t\t\tcommon.utils.error( 'INTERNAL ERROR: Unblock count > block count:', blockCounter );\r\n\r\n\t\t\t// Reset counter\r\n\t\t\tblockCounter = 0;\r\n\t\t\t$e.data( 'ttt_blockCounter', 0 );\r\n\t\t}\r\n\r\n\t\tif( blockCounter == 0 )\r\n\t\t\t// This element is no more blocked by anything else\r\n\t\t\t(<any>$e).unblock();  // TODO: ACA: jQuery.blockUI typings ...\r\n\r\n\t\treturn $e;\r\n\t}\r\n\r\n\texport function ensureVisible($e:JQuery) : void\r\n\t{\r\n\t\t// Scroll\r\n\t\tconst offset = $e.offset().top - ( 20 + $e.height() );\r\n\t\t$('html, body').animate({ scrollTop:offset });  // cf.: https://stackoverflow.com/questions/4884839/how-do-i-get-an-element-to-scroll-into-view-using-jquery?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa\r\n\r\n\t\t// Blink\r\n\t\t$e.effect( \"highlight\", {}, 2000 );  // cf.: https://stackoverflow.com/questions/5205445/jquery-blinking-highlight-effect-on-div?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa\r\n\t}\r\n} // namespace html\r\n\r\nexport namespace url\r\n{\r\n\tconst onChangedEvent = 'onUrlChanged';\r\n\tvar onChangedCallbacks = $({});\r\n\tvar onChangedCallbacksRegistered = false;\r\n\r\n\texport function redirect(url:string)\r\n\t{\r\n\t\twindow.location.href = url;\r\n\t}\r\n\r\n\t/** Parse a parameters string like 'foo=bar&hello=world' and return the a dictionary like {foo:'bar',hello:'world'} */\r\n\texport function parseParameters(searchString?:string) : {[key:string]:any}\r\n\t{\r\n\t\tif( searchString == null )\r\n\t\t\tsearchString = window.location.search.substring(1);\r\n\t\tif( searchString.length == 0 )\r\n\t\t\treturn {};\r\n\r\n\t\tvar tokens = searchString.split( '&' );\r\n\r\n\t\tvar dict = <{[key:string]:any}>{};\r\n\t\tfor( var i=0; i < tokens.length; ++i )\r\n\t\t{\r\n\t\t\tvar pairs = tokens[i].split( '=' );\r\n\t\t\tvar key = decodeURIComponent( pairs[0] );\r\n\t\t\tvar value = decodeURIComponent( pairs[1] );\r\n\r\n\t\t\t// Try parse JSON\r\n\t\t\ttry { value = JSON.parse(value); }\r\n\t\t\tcatch( ex ){/* Not JSON => Keep the string as-is*/}\r\n\r\n\t\t\tdict[ key ] = value;\r\n\t\t}\r\n\t\treturn dict;\r\n\t}\r\n\r\n\t/** Transform a dictionary like {foo:'bar',hello:'world'} to a parameters string like 'foo=bar&hello=world' */\r\n\texport function stringifyParameters(parms:{[key:string]:any}) : string\r\n\t{\r\n\t\tvar pairs = <string[]>[];\r\n\t\t$.each( parms, function(key:string,value)\r\n\t\t\t{\r\n\t\t\t\tkey = encodeURIComponent( key );\r\n\r\n\t\t\t\tif( (value == null) || (typeof(value) === 'string') || (typeof(value) === 'number') || (typeof(value) === 'boolean') )\r\n\t\t\t\t\t{/*Keep as-is*/}\r\n\t\t\t\telse\r\n\t\t\t\t\t// Convert to JSON\r\n\t\t\t\t\tvalue = JSON.stringify( value );\r\n\t\t\t\tvalue = encodeURIComponent( value );\r\n\r\n\t\t\t\tpairs.push( key+\"=\"+value );\r\n\t\t\t} );\r\n\t\treturn pairs.join( '&' );\r\n\t}\r\n\r\n\t/** Registers a callback to be invoked whenever the browser's URL changes (cf. 'pushHistory()') */\r\n\texport function onChanged(callback:()=>void) : void\r\n\t{\r\n\t\t// NB: The callback gets invoked ALSO when 'pushHistory()' is invoked\r\n\r\n\t\tif( onChangedCallbacksRegistered == false )\r\n\t\t{\r\n\t\t\t$(window).bind( 'popstate', function(evt)\r\n\t\t\t\t{\r\n\t\t\t\t\tonChangedCallbacks.trigger( onChangedEvent );\r\n\t\t\t\t} );\r\n\t\t\tonChangedCallbacksRegistered = true;\r\n\t\t}\r\n\r\n\t\tonChangedCallbacks.bind( onChangedEvent, callback );\r\n\t}\r\n\r\n\texport function createUrl(p:{ pathname?:string, parameters?:{[key:string]:any} }) : string\r\n\t{\r\n\t\tvar newPath = p.pathname;\r\n\t\tif( newPath == null )\r\n\t\t\tnewPath = window.location.pathname;\r\n\r\n\t\tif( p.parameters != null )\r\n\t\t{\r\n\t\t\tconst queryString = stringifyParameters( p.parameters );\r\n\t\t\tif( queryString.length > 0 )\r\n\t\t\t\tnewPath = newPath+'?'+queryString;\r\n\t\t}\r\n\t\treturn newPath;\r\n\t}\r\n\r\n\t/** Change the browser's current URL without triggering an HTTP request (NB: Will trigger any registered 'onChanged()' callbacks) */\r\n\texport function pushHistory(p:{ pathname?:string, parameters?:{[key:string]:any}, newTitle?:string }) : void\r\n\t{\r\n\t\tconst newPath = createUrl( p );\r\n\t\twindow.history.pushState( {}, p.newTitle, newPath );\r\n\r\n\t\t// Invoke any registered callbacks\r\n\t\tonChangedCallbacks.trigger( onChangedEvent );\r\n\t}\r\n\r\n\texport function postRequestForm<T>(url:string, request:{[key:string]:any}) : Promise<T>\r\n\t{\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'POST',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'application/x-www-form-urlencoded',\r\n\t\t\t\t\t\t\tdata\t\t: request,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>resolve( data ),\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function postRequestJSON<T>(url:string, request:{[key:string]:any}) : Promise<T>\r\n\t{\r\n\t\tlet requestStr = JSON.stringify( request );\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'POST',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'application/json',\r\n\t\t\t\t\t\t\tdata\t\t: requestStr,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>resolve( data ),\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function getRequest(url:string, request?:{[key:string]:any}) : Promise<string>\r\n\t{\r\n\t\tif( request != null )\r\n\t\t{\r\n\t\t\tconst parms = stringifyParameters( request );\r\n\t\t\turl = `${url}?${parms}`;\r\n\t\t}\r\n\r\n\t\treturn new Promise<string>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'GET',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'text/html',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>resolve( data ),\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function downloadFile(url:string) : void\r\n\t{\r\n\t\t$(document.body).append( $(\"<iframe/>\").attr({\tsrc\t\t: url,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle\t: 'visibility:hidden;display:none' })\r\n\t\t\t\t\t\t\t\t);\r\n\t}\r\n\r\n} // namespace url\r\n\r\n// nb: Exports at the end or the order of execution breaks everything (i.e. strEnum must be defined before) ...\r\nexport * from \"../Language\";\r\nexport * from \"../PageHelper\";\r\nexport * from \"../Routes\";\r\n"]}