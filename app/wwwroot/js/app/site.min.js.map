{"version":3,"sources":["node_modules/browser-pack/_prelude.js","app/global.ts","app/src/DTOs/BlogPost.ts","app/src/DTOs/Item.ts","app/src/DTOs/Translation.ts","app/src/Language.ts","app/src/Services/BlogController.ts","app/src/Services/DynamicPageController.ts","app/src/Services/ItemController.ts","app/src/Services/ItemPictureController.ts","app/src/Services/LoginController.ts","app/src/Services/TestimonialController.ts","app/src/Services/TranslationController.ts","app/src/Utils/BaseAutoItem.ts","app/src/Views/Admin/Home.ts","app/src/Views/Blog/BlogController.ts","app/src/Views/Blog/Edit.ts","app/src/Views/Blog/List.ts","app/src/Views/DynamicPage/Show.ts","app/src/Views/ItemTTT/Add.ts","app/src/Views/ItemTTT/Edit.ts","app/src/Views/ItemTTT/ItemTTTController.ts","app/src/Views/ItemTTT/List.ts","app/src/Views/Testimonial/List.ts","app/src/Views/common.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","ttt","common","admin","home","itemttt","list","add","edit","blog","testimonial","dynamicpage","show","window","BlogPostKO","prototype","fromDTO","src","self","this","id","date","imageHtml","titleHtmlEN","titleHtmlFR","titleHtmlNL","textHtmlEN","textHtmlFR","textHtmlNL","active","toDTO","dst","ko","observable","_super","BaseAutoItem_1","ItemKO","BaseAutoItem","__extends","toDictObj","dict","$container","fieldNames","_this","features","pictures","price","utils","ensureInteger","canBeZero","canBeNull","mustBePositive","TranslationKO","en","fr","nl","TranslationItemKO","setAllLanguagesTo","str","copyEnToBlanks","stringIsNullOrWhitespace","inOriginal","inTranslation","enOriginal","frOriginal","nlOriginal","modified","computed","Languages","_a","strEnum","allLanguages","url","postRequestForm","routes","api","rc","sent","posts","result","uploadPicture","file","pictureUpload","formData","FormData","append","postRequestFormData","response","imageTagContent","save","post","postRequestJSON","delete_","delete","get","language","pageParameters","currentLanguage","dynamicPage","update","getUrlCode","originalCode","getRequest","details","items","replace","itemCodeParameter","item","newCode","upload","itemCode","imageNumber","number","reorder","newNumber","setMain","isMain","changePassword","testimonials","imageData","TranslationTypes","allTranslationTypes","translations","autoCompleteResolve","autoComplete","fieldTagAttribute","dictKO","$","each","fieldName","fromDictObj","knockoutify","find","attr","indexOf","push","forEach","loginCtrl","trnCtrl","trnDto","init","ChangePassword","$passwordBlockingDiv","Features","$featuresBlockingDiv","change","oldPassword","original","newPassword","newPasswordAgain","html","showMessage","block","$blockingDiv","unblock","success","error","errorMessage","TranslationsBase","refresh","type","map","v","TranslationItem","clearLine","index","addLine","toSave","dto","filter","observableArray","hasChanges","showReset","feature","languageParameter","isAdding","dtos","ctrl","message_confirmRefresh","message_confirmDelete","addKoTinymceEditor","bindingHandlers","tinymceEditor","element","valueAccessor","allBindings","viewModel","bindingContext","$element","tinymce","inline","plugins","setup","ed","on","newHtml","confirmed","log","confirm","includeImages","includeInactives","$picUploadControl","files","undefined","$txtDate","datepicker","dateFormat","itemIDParameter","redirect","apiCtrl","htmlCtrl","blogIdAttribute","loadImages","parseInt","removeAttr","model","__awaiter","applyBindings","lastPostItem","lastPost","Promise","resolve","waitForScrolledVisible","$endPostElement","postsIncrement","$spinner","noLayout","skipToID","take","hide","before","loopLoadNextPosts","Edit_1","textHtml","text","obj","itemTTT","$fieldsContainer","$btnSave","click","picCtrl","Translation_1","message_saveSuccess","message_refreshFailed","message_confirmDeletePicture","tasks","all","rcs","newUrl","pushHistory","pathname","newTitle","name","$dropZone","$upload","$btnDelete","$picUploadDropZone","picDropZone","hover","stopPropagation","preventDefault","originalEvent","dataTransfer","autoCompleteFeature","searchTerm","searchString","includeTranslations","deletePicture","picture","toggleMainPicture","isMainImage","reorderPicture","offset","scrambleUrl","newGuid","addNewFeature","ViewModes","allViewModes","_b","SortingFields","allSortingFields","getListContent","currentSortingField","$txtSearch","$cbShowInactive","$divCarsList","$divBlocking","itemCtrl","ItemTTTController_1","Language_1","modelSearchString","reconstructItemsList","$models","$modelElement","parent","JSON","parse","remove","itemsList","filterItemsList","visible","getIsVisible","refreshList","sortingField","name_desc","price_desc","prop","$btnViewGrid","viewMode","grid","$btnViewList","$btnSortName","$btnSortPrice","keyup","toggleActive","showInactive","is","val","toLowerCase","trim","searchWords","split","word","searchFields","descriptionEN","descriptionFR","descriptionNL","matchCount","i_1","required","nameof","message_imageUploadError","saveSuccessMessage","testimonialIdAttribute","imageUploadErrorMessage","formTestimonial","FormTestimonial","$formDialog","urlImgNotFound","isAutenticated","$e","TestimonialItem","rc1","saveRequest","extend","saveImage","rc2","location","reload","reset","open","firstLastName","whosWho","modal","close","showRequiredText","fields","imageSrc","data","html_1","url_1","onChangedEvent","onChangedCallbacks","onChangedCallbacksRegistered","stringifyParameters","parms","pairs","key","value","encodeURIComponent","stringify","join","createUrl","newPath","parameters","queryString","debugMessages","hasErrors","logs","ttt_autocomplete","searchFunction","autocomplete","minLength","source","request","term","ttt_slideUpDownVisible","unwrap","slideDown","slideUp","ttt_slideLeftRightVisible","direction","ttt_blink","koValue","fadeIn","delay","fadeOut","optionalParams","_i","arguments","isDebug","console","apply","reduce","res","Object","create","stringIsNullOrEmpty","htmlEncode","txt","Array","isArray","document","createElement","arrayContains","arrayRemoveItem","splice","arraySum","arrayMoveItem","j","tmp","fallbackValue","subscribe","newValue","isNaN","S4","Math","random","toString","substring","sleep","ms","setTimeout","msg","$div","blockCounter","ensureVisible","top","height","animate","scrollTop","effect","$elem","$window","isScrolledVisible","docViewTop","docViewBottom","elemTop","scrollHandler","unbind","bind","href","parseParameters","search","tokens","decodeURIComponent","ex","onChanged","callback","evt","trigger","history","pushState","reject","ajax","contentType","dataType","textStatus","jqXHR","errorThrown","processData","requestStr","downloadFile","body","style","__export"],"mappings":"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","file":"../site.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\r\nimport * as common\t\tfrom \"./src/Views/common\";\r\nimport * as adminhome\tfrom \"./src/Views/Admin/Home\";\r\nimport * as itemlist\tfrom \"./src/Views/ItemTTT/List\";\r\nimport * as itemadd\t\tfrom \"./src/Views/ItemTTT/Add\";\r\nimport * as itemedit\tfrom \"./src/Views/ItemTTT/Edit\";\r\nimport * as bloglist\tfrom \"./src/Views/Blog/List\";\r\nimport * as blogedit\tfrom \"./src/Views/Blog/Edit\";\r\nimport * as tstmlist\tfrom \"./src/Views/Testimonial/List\";\r\nimport * as dynpgshow\tfrom \"./src/Views/DynamicPage/Show\";\r\n\r\n///////\r\n\r\n// Global assignment of window.itemttt (will be available in each pages e.g. from the console):\r\nvar ttt =\r\n{\r\n\tcommon: common,\r\n\tadmin: {\r\n\t\thome : adminhome,\r\n\t},\r\n\titemttt: {\r\n\t\tlist\t: itemlist,\r\n\t\tadd\t\t: itemadd,\r\n\t\tedit\t: itemedit,\r\n\t},\r\n\tblog: {\r\n\t\tlist\t: bloglist,\r\n\t\tedit\t: blogedit,\r\n\t},\r\n\ttestimonial: {\r\n\t\tlist\t: tstmlist,\r\n\t},\r\n\tdynamicpage: {\r\n\t\tshow\t: dynpgshow,\r\n\t},\r\n}\r\ndeclare global\r\n{\r\n\tinterface Window { ttt: typeof ttt; }\r\n}\r\nwindow.ttt = ttt;\r\n","\nexport interface BlogPost\n{\n\tid?\t\t\t: number;\n\tdate\t\t: string;\n\timageHtml\t: string;\n\ttitleHtmlEN\t: string;\n\ttitleHtmlFR\t: string;\n\ttitleHtmlNL\t: string;\n\ttextHtmlEN\t: string;\n\ttextHtmlFR\t: string;\n\ttextHtmlNL\t: string;\n\tactive\t\t: boolean;\n}\n\nexport class BlogPostKO\n{\n\tpublic readonly\tid\t\t\t: KnockoutObservable<number>;\n\tpublic readonly\tdate\t\t: KnockoutObservable<string>;\n\tpublic readonly\timageHtml\t: KnockoutObservable<string>;\n\tpublic readonly\ttitleHtmlEN\t: KnockoutObservable<string>;\n\tpublic readonly\ttitleHtmlFR\t: KnockoutObservable<string>;\n\tpublic readonly\ttitleHtmlNL\t: KnockoutObservable<string>;\n\tpublic readonly\ttextHtmlEN\t: KnockoutObservable<string>;\n\tpublic readonly\ttextHtmlFR\t: KnockoutObservable<string>;\n\tpublic readonly\ttextHtmlNL\t: KnockoutObservable<string>;\n\tpublic readonly\tactive\t\t: KnockoutObservable<boolean>;\n\n\tconstructor(src?:BlogPost)\n\t{\n\t\tconst self = this;\n\n\t\tthis.id\t\t\t\t= ko.observable( null );\n\t\tthis.date\t\t\t= ko.observable( '' );\n\t\tthis.imageHtml\t\t= ko.observable( '' );\n\t\tthis.titleHtmlEN\t= ko.observable( '' );\n\t\tthis.titleHtmlFR\t= ko.observable( '' );\n\t\tthis.titleHtmlNL\t= ko.observable( '' );\n\t\tthis.textHtmlEN\t\t= ko.observable( '' );\n\t\tthis.textHtmlFR\t\t= ko.observable( '' );\n\t\tthis.textHtmlNL\t\t= ko.observable( '' );\n\t\tthis.active\t\t\t= ko.observable( false );\n\n\t\tif( src != null )\n\t\t\tself.fromDTO( src );\n\t}\n\n\tpublic fromDTO(src:BlogPost) : void\n\t{\n\t\tconst self = this;\n\n\t\tself.id\t\t\t\t( src.id );\n\t\tself.date\t\t\t( src.date );\n\t\tself.imageHtml\t\t( src.imageHtml );\n\t\tself.titleHtmlEN\t( src.titleHtmlEN );\n\t\tself.titleHtmlFR\t( src.titleHtmlFR );\n\t\tself.titleHtmlNL\t( src.titleHtmlNL );\n\t\tself.textHtmlEN\t\t( src.textHtmlEN );\n\t\tself.textHtmlFR\t\t( src.textHtmlFR );\n\t\tself.textHtmlNL\t\t( src.textHtmlNL );\n\t\tself.active\t\t\t( src.active );\n\t}\n\n\tpublic toDTO() : BlogPost\n\t{\n\t\tconst self = this;\n\t\tconst dst : BlogPost = <any>{};\n\n\t\tdst.id\t\t\t= self.id();\n\t\tdst.date\t\t= self.date();\n\t\tdst.imageHtml\t= self.imageHtml();\n\t\tdst.titleHtmlEN\t= self.titleHtmlEN();\n\t\tdst.titleHtmlFR\t= self.titleHtmlFR();\n\t\tdst.titleHtmlNL\t= self.titleHtmlNL();\n\t\tdst.textHtmlEN\t= self.textHtmlEN();\n\t\tdst.textHtmlFR\t= self.textHtmlFR();\n\t\tdst.textHtmlNL\t= self.textHtmlNL();\n\t\tdst.active\t\t= self.active();\n\n\t\treturn dst;\n\t}\n}\n","\nimport * as common from \"../Views/common\";\nimport { BaseAutoItem, DictObj } from \"../Utils/BaseAutoItem\";\nexport { DictObj, DictKO } from \"../Utils/BaseAutoItem\";\nimport { Translation } from \"./Translation\";\nimport { ItemPicture } from \"./ItemPicture\";\n\nexport interface Item extends DictObj\n{\n\tcode\t\t: string;\n\tactive\t\t: boolean;\n\tfeatures\t: Translation[];\n\tpictures\t: ItemPicture[];\n}\n\nexport class ItemKO extends BaseAutoItem\n{\n\tpublic readonly code\t\t\t: KnockoutObservable<string>;\n\tpublic readonly name\t\t\t: KnockoutObservable<string>;\n\tpublic readonly descriptionEN\t: KnockoutObservable<string>;\n\tpublic readonly descriptionFR\t: KnockoutObservable<string>;\n\tpublic readonly descriptionNL\t: KnockoutObservable<string>;\n\tpublic readonly active\t\t\t: KnockoutObservable<boolean>;\n\tpublic readonly price\t\t\t: KnockoutObservable<number>;\n\n\tconstructor($container:JQuery, src?:Item, fieldNames?:string[])\n\t{\n\t\tif( src == null )\n\t\t\tsrc = { code:null, active:false, features:[], pictures:[] };\n\t\tsuper( $container, src, fieldNames );\n\t\tconst self = this;\n\n\t\tif( self.price != null )\n\t\t\tcommon.utils.ensureInteger({ observable:self.price, canBeZero:false, canBeNull:true, mustBePositive:true });\n\t}\n\n\tpublic /*override*/ toDictObj(dict?:DictObj) : Item\n\t{\n\t\tconst rc = super.toDictObj( dict );\n\t\treturn <Item>rc;\n\t}\n}\n","\nimport * as common from \"../Views/common\";\n\nexport interface Translation\n{\n\ten : string;\n\tfr : string;\n\tnl : string;\n}\nexport interface TranslationItem extends Translation\n{\n\tinOriginal\t\t: boolean;\n\tinTranslation\t: boolean;\n}\n\nexport class TranslationKO\n{\n\tpublic readonly en\t: KnockoutObservable<string>;\n\tpublic readonly fr\t: KnockoutObservable<string>;\n\tpublic readonly nl\t: KnockoutObservable<string>;\n\n\tconstructor(src?:Translation)\n\t{\n\t\tif( src == null )\n\t\t\tsrc = { en:'', fr:'', nl:'' };\n\t\tthis.en = ko.observable( src.en );\n\t\tthis.fr = ko.observable( src.fr );\n\t\tthis.nl = ko.observable( src.nl );\n\t}\n}\nexport class TranslationItemKO extends TranslationKO\n{\n\tpublic readonly inOriginal\t\t: KnockoutObservable<boolean>;\n\tpublic readonly inTranslation\t: KnockoutObservable<boolean>;\n\n\tpublic readonly enOriginal\t: KnockoutObservable<string>;\n\tpublic readonly frOriginal\t: KnockoutObservable<string>;\n\tpublic readonly nlOriginal\t: KnockoutObservable<string>;\n\tpublic readonly modified\t: KnockoutComputed<boolean>;\n\n\tconstructor(src?:TranslationItem)\n\t{\n\t\tif( src == null )\n\t\t\tsrc = { en:'', fr:'', nl:'', inOriginal:false, inTranslation:false };\n\t\tsuper( src );\n\t\tconst self = this;\n\n\t\tthis.inOriginal\t\t= ko.observable( src.inOriginal\t );\n\t\tthis.inTranslation\t= ko.observable( src.inTranslation );\n\n\t\tthis.enOriginal = ko.observable( self.en() );\n\t\tthis.frOriginal = ko.observable( self.fr() );\n\t\tthis.nlOriginal = ko.observable( self.nl() );\n\t\tthis.modified = ko.computed( ()=>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( self.en() != self.enOriginal() )\treturn true;\n\t\t\t\t\t\t\t\tif( self.fr() != self.frOriginal() )\treturn true;\n\t\t\t\t\t\t\t\tif( self.nl() != self.nlOriginal() )\treturn true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t} );\n\t}\n\n\tpublic toDTO() : Translation\n\t{\n\t\treturn {\n\t\t\t\ten : this.en(),\n\t\t\t\tfr : this.fr(),\n\t\t\t\tnl : this.nl(),\n\t\t\t};\n\t}\n\n\tpublic setAllLanguagesTo(str:string) : void\n\t{\n\t\tthis.en( str );\n\t\tthis.fr( str );\n\t\tthis.nl( str );\n\t}\n\n\tpublic copyEnToBlanks() : void\n\t{\n\t\tconst self = this;\n\t\tconst en = self.en();\n\t\tif( common.utils.stringIsNullOrWhitespace(self.fr()) )\n\t\t\tself.fr( en );\n\t\tif( common.utils.stringIsNullOrWhitespace(self.nl()) )\n\t\t\tself.nl( en );\n\t}\n}\n","\nimport * as common from \"./Views/common\";\n\nexport const { e:Languages, a:allLanguages } = common.utils.strEnum([ 'en', 'fr', 'nl' ]);\nexport type Language = keyof typeof Languages;\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\nimport * as dto from \"../DTOs/BlogPost\";\n\nexport async function list(p:ListRequest) : Promise<ListResponse>\n{\n\tconst rc = <ListResponse>await common.url.postRequestForm( common.routes.api.blog.list, p );\n\trc.posts = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface ListRequest\n{\n\tincludeImages?\t\t: boolean;\n\tincludeInactives?\t: boolean;\n\tid?\t\t\t\t\t: number;\n\tskipToID?\t\t\t: number;\n\tskip?\t\t\t\t: number;\n\ttake?\t\t\t\t: number;\n}\nexport interface ListResponse extends Result\n{\n\tposts : dto.BlogPost[];\n}\n\nexport async function uploadPicture(file:File) : Promise<UploadPictureResult>\n{\n\tconst url = common.routes.api.blog.pictureUpload;\n\tconst formData = new FormData();\n\tformData.append( 'file', file );\n\n\tconst response = await common.url.postRequestFormData<UploadPictureResult>( url, formData );\n\tresponse.imageTagContent = response.result;\n\tdelete response.result;\n\n\treturn response;\n}\nexport interface UploadPictureResult extends Result\n{\n\timageTagContent : string;\n}\n\nexport async function save(post:dto.BlogPost) : Promise<SaveResponse>\n{\n\tconst rc = await common.url.postRequestJSON<SaveResponse>( common.routes.api.blog.save, post );\n\trc.id = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface SaveResponse extends Result\n{\n\tid : number;\n}\n\nexport async function delete_(id:number) : Promise<Result>\n{\n\tconst rc = await common.url.postRequestForm<Result>( common.routes.api.blog.delete, { id } );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport { Result } from \"../Utils/TTTServiceResult\";\nimport { Language } from \"../Views/common\";\n\nexport async function get(p:{ itemCode:string, language?:Language }) : Promise<string>\n{\n\tif( p.language == null )\n\t\tp.language = common.pageParameters.currentLanguage;\n\tconst rc = <Result>await common.url.postRequestForm( common.routes.api.dynamicPage.get, p );\n\treturn rc.result;\n}\n\nexport async function update(p:{ itemCode:string, language?:Language, text:string, allowAdd?:boolean }) : Promise<string>\n{\n\tif( p.language == null )\n\t\tp.language = common.pageParameters.currentLanguage;\n\tconst rc = <Result>await common.url.postRequestForm( common.routes.api.dynamicPage.update, p );\n\treturn rc.result;\n}\n","\nimport * as common from \"../Views/common\";\nimport { Item } from \"../DTOs/Item\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function getUrlCode(originalCode:string) : Promise<string>\n{\n\tif( common.utils.stringIsNullOrWhitespace(originalCode) )\n\t\treturn null;\n\treturn await common.url.getRequest( common.routes.api.getUrlCode, { originalCode } );\n}\n\nexport async function details(code:string) : Promise<DetailsResult>\n{\n\tconst url = common.routes.api.items.details.replace( common.routes.itemCodeParameter, code );\n\tconst rc = await common.url.postRequestJSON<DetailsResult>( url, {} );\n\trc.item = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface DetailsResult extends Result\n{\n\titem : Item;\n}\n\nexport async function save(p:SaveRequest) : Promise<SaveResult>\n{\n\tconst rc = await common.url.postRequestJSON<SaveResult>( common.routes.api.items.save, p );\n\trc.newCode = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface SaveRequest\n{\n\toriginalCode?\t: string;\n\titem\t\t\t: Item;\n}\nexport interface SaveResult extends Result\n{\n\tnewCode : string;\n}\n\nexport async function delete_(code:string) : Promise<SaveResult>\n{\n\tconst url = common.routes.api.items.delete.replace( common.routes.itemCodeParameter, code );\n\tconst rc = await common.url.postRequestJSON<SaveResult>( url, {} );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function upload(itemCode:string, file:File) : Promise<UploadResult>\n{\n\tconst url = common.routes.api.items.pictures.upload.replace( common.routes.itemCodeParameter, itemCode );\n\tconst formData = new FormData();\n\tformData.append( 'file', file );\n\n\tconst response = await common.url.postRequestFormData<UploadResult>( url, formData );\n\tresponse.imageNumber = response.result;\n\tdelete response.result;\n\t\n\treturn response;\n}\nexport interface UploadResult extends Result\n{\n\timageNumber : number;\n}\n\nexport async function delete_(p:{ itemCode:string, number:number }) : Promise<Result>\n{\n\tconst url = common.routes.api.items.pictures.delete.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number } );\n\treturn rc;\n}\n\nexport async function reorder(p:{ itemCode:string, number:number, newNumber:number }) : Promise<Result>\n{\n\tconst url = common.routes.api.items.pictures.reorder.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number, newNumber:p.newNumber } );\n\treturn rc;\n}\n\nexport async function setMain(p:{ itemCode:string, number:number, isMain:boolean }) : Promise<Result>\n{\n\tconst url = common.routes.api.items.pictures.setMain.replace( common.routes.itemCodeParameter, p.itemCode );\n\tconst rc = await common.url.postRequestForm<Result>( url, { number:p.number, isMain:p.isMain } );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function changePassword(p:{ oldPassword:string, newPassword:string }) : Promise<Result>\n{\n\tconst url = common.routes.api.changePassword;\n\tconst rc = <Result>await common.url.postRequestForm( url, p );\n\treturn rc;\n}\n","\nimport * as common from \"../Views/common\";\nimport * as dto from \"../DTOs/Testimonial\";\nimport Result from \"../Utils/TTTServiceResult\";\n\nexport async function list(p:ListRequest) : Promise<ListResponse>\n{\n\tconst rc = <ListResponse>await common.url.postRequestForm( common.routes.api.testimonial.list, p );\n\trc.testimonials = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface ListRequest\n{\n\tincludeImages?\t\t: boolean;\n\tincludeInactives?\t: boolean;\n\tid?\t\t\t\t\t: number;\n}\nexport interface ListResponse extends Result\n{\n\ttestimonials : dto.Testimonial[];\n}\n\nexport async function save(post:SaveRequest) : Promise<Result>\n{\n\tconst rc = await common.url.postRequestJSON<Result>( common.routes.api.testimonial.save, post );\n\treturn rc;\n}\nexport interface SaveRequest extends dto.Testimonial\n{\n\tsaveImage\t: boolean;\n}\n\nexport async function delete_(id:number) : Promise<Result>\n{\n\tconst rc = await common.url.postRequestForm<Result>( common.routes.api.testimonial.delete, { id } );\n\treturn rc;\n}\n\nexport async function uploadPicture(file:File) : Promise<UploadPictureResult>\n{\n\tconst url = common.routes.api.testimonial.pictureUpload;\n\tconst formData = new FormData();\n\tformData.append( 'file', file );\n\n\tconst response = await common.url.postRequestFormData<UploadPictureResult>( url, formData );\n\tresponse.imageData = response.result;\n\tdelete response.result;\n\n\treturn response;\n}\nexport interface UploadPictureResult extends Result\n{\n\timageData : string;\n}\n","\nimport * as common from \"../Views/common\";\nimport Result from \"../Utils/TTTServiceResult\";\nimport * as dto from \"../DTOs/Translation\";\n\nexport const { e:TranslationTypes, a:allTranslationTypes } = common.utils.strEnum([\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'feature',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]);\nexport type TranslationType = keyof typeof TranslationTypes;\n\nexport async function list(p:ListRequest) : Promise<ListResponse>\n{\n\tconst rc = <ListResponse>await common.url.postRequestForm( common.routes.api.translations.list, p );\n\trc.translations = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface ListRequest\n{\n\ttype\t\t\t\t\t: TranslationType;\n\tincludeOriginals?\t\t: boolean;\n\tincludeTranslations?\t: boolean;\n}\nexport interface ListResponse extends Result\n{\n\ttranslations : dto.TranslationItem[];\n}\n\nexport async function save(p:SaveRequest) : Promise<Result>\n{\n\treturn await common.url.postRequestJSON<Result>( common.routes.api.translations.save, p );\n}\nexport interface SaveRequest\n{\n\ttype\t\t\t: TranslationType;\n\ttranslations\t: SaveRequestItem[];\n}\nexport interface SaveRequestItem extends dto.Translation\n{\n\tenOriginal?\t: string;\n}\n\nexport async function autoCompleteResolve(p:AutoCompleteResolveRequest) : Promise<AutoCompleteResolveResponse>\n{\n\tconst url = common.routes.api.autoComplete;\n\tconst rc = <AutoCompleteResolveResponse>await common.url.postRequestForm( url, p );\n\trc.list = rc.result;\n\tdelete rc.result;\n\treturn rc;\n}\nexport interface AutoCompleteResolveRequest\n{\n\ttype\t\t\t\t\t: TranslationType;\n\tsearchString?\t\t\t: string;\n\tincludeTranslations?\t: boolean;\n}\nexport interface AutoCompleteResolveResponse extends Result\n{\n\tlist : string[];\n}\n","\nconst fieldTagAttribute = 'ttt-name';\n\nexport type DictObj\t= {[key:string]:any};\nexport type DictKO\t= {[key:string]:KnockoutObservable<any>};\n\nexport abstract class BaseAutoItem\n{\n\tprivate readonly fieldNames : string[];\n\n\tconstructor($container:JQuery, src:DictObj, fieldNames?:string[])\n\t{\n\t\tthis.fieldNames = (fieldNames != null) ? fieldNames : [];\n\t\tthis.knockoutify( $container, src );\n\t}\n\n\tpublic toDictObj(dict?:DictObj) : DictObj\n\t{\n\t\tconst self = this;\n\t\tconst dictKO : DictKO = <any>self;\n\t\tif( dict == null )\n\t\t\tdict = {};\n\n\t\t$.each( self.fieldNames, (i,fieldName)=>\n\t\t\t{\n\t\t\t\tconst observable = dictKO[ fieldName ];\n\t\t\t\tdict[ fieldName ] = observable();\n\t\t\t} );\n\n\t\treturn dict;\n\t}\n\n\tpublic fromDictObj(dict:DictObj) : void\n\t{\n\t\tconst self = this;\n\t\tconst dictKO : DictKO = <any>self;\n\t\t$.each( self.fieldNames, (i,fieldName)=>\n\t\t\t{\n\t\t\t\tconst observable = dictKO[ fieldName ];\n\t\t\t\tobservable( dict[fieldName] );\n\t\t\t} );\n\t}\n\n\tprivate knockoutify($container:JQuery, src:DictObj) : void\n\t{\n\t\tconst self = this;\n\t\tconst dict : DictKO = <any>this;\n\n\t\t// For each tagged elements we find in '$container'\n\t\t$container.find( `[${fieldTagAttribute}]` ).each( (i,e)=>\n\t\t\t{\n\t\t\t\t// Extract the field name from that attribute\n\t\t\t\tconst $e = $(e);\n\t\t\t\tconst fieldName = $e.attr( fieldTagAttribute );\n\n\t\t\t\tif( self.fieldNames.indexOf(fieldName) >= 0 )\n\t\t\t\t\t// That field is already already listed\n\t\t\t\t\t{/*NOOP*/}\n\t\t\t\telse\n\t\t\t\t\t// Add that field to the fields list\n\t\t\t\t\tself.fieldNames.push( fieldName );\n\t\t\t} );\n\n\t\t// For each listed fields ...\n\t\tself.fieldNames.forEach( (fieldName)=>\n\t\t\t{\n\t\t\t\t// ... create a KO observable on 'this' and set it's value using 'src' ...\n\t\t\t\tdict[ fieldName ] = ko.observable( src[fieldName] );\n\t\t\t} );\n\t}\n}\n","\nimport * as common from \"../common\";\nimport * as loginCtrl from \"../../Services/LoginController\";\nimport * as trnCtrl from \"../../Services/TranslationController\";\nimport * as trnDto from \"../../DTOs/Translation\";\n\nconst passwordsDontMatchMessage = 'Les 2 mots de passe ne concordent pas';\nconst passwordChangedMessage = 'Password changed successfully';\n\nexport var changePassword : ChangePassword;\nexport var features : Features;\n\nexport async function init(p:{\t$passwordBlockingDiv : JQuery,\n\t\t\t\t\t\t\t\t$featuresBlockingDiv : JQuery,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tchangePassword\t= new ChangePassword( p.$passwordBlockingDiv );\n\tfeatures\t\t= new Features( p.$featuresBlockingDiv );\n}\n\nclass ChangePassword\n{\n\tprivate readonly\t$blockingDiv\t\t: JQuery;\n\n\tprotected readonly\toriginal\t\t\t: KnockoutObservable<string>;\n\tprotected readonly\tnewPassword\t\t\t: KnockoutObservable<string>;\n\tprotected readonly\tnewPasswordAgain\t: KnockoutObservable<string>;\n\n\tconstructor($blockingDiv:JQuery)\n\t{\n\t\tthis.$blockingDiv\t\t= $blockingDiv;\n\t\tthis.original\t\t\t= ko.observable( '' );\n\t\tthis.newPassword\t\t= ko.observable( '' );\n\t\tthis.newPasswordAgain\t= ko.observable( '' );\n\t}\n\n\tprotected async change() : Promise<void>\n\t{\n\t\tconst self = this;\n\t\tconst oldPassword = self.original();\n\t\tconst newPassword = self.newPassword();\n\t\tconst newPasswordAgain = self.newPasswordAgain();\n\n\t\tif( common.utils.stringIsNullOrWhitespace(newPassword) )\n\t\t\treturn;\n\t\tif( common.utils.stringIsNullOrWhitespace(oldPassword) )\n\t\t\treturn;\n\t\tif( newPassword != newPasswordAgain )\n\t\t{\n\t\t\tcommon.html.showMessage( passwordsDontMatchMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc = await loginCtrl.changePassword({ oldPassword, newPassword });\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'change password error', { rc } );\n\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\treturn;\n\t\t}\n\t\tcommon.html.showMessage( passwordChangedMessage );\n\t\treturn;\n\t}\n}\n\nabstract class TranslationsBase\n{\n\tprivate readonly\t$blockingDiv\t: JQuery;\n\n\tprivate readonly\ttype\t\t\t: trnCtrl.TranslationType;\n\tprotected readonly\titems\t\t\t: KnockoutObservableArray<TranslationItem>;\n\tprotected readonly\thasChanges\t\t: KnockoutComputed<boolean>;\n\n\tconstructor(type:trnCtrl.TranslationType, $blockingDiv:JQuery)\n\t{\n\t\tconst self = this;\n\n\t\tthis.$blockingDiv\t= $blockingDiv;\n\t\tthis.type\t\t\t= type;\n\t\tthis.items\t\t\t= ko.observableArray();\n\t\tthis.hasChanges\t\t= ko.computed( ()=>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst items = self.items();\n\t\t\t\t\t\t\t\t\t\tfor( let i=0; i<items.length; ++i )\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tif( items[i].modified() )\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t} );\n\n\t\tthis.refresh();\n\t}\n\n\tprotected async refresh() : Promise<void>\n\t{\n\t\tconst self = this;\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tvar rc = await trnCtrl.list({ type:self.type });\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'refresh translations error', { rc } );\n\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = rc.translations.map( v=>new TranslationItem(v) );\n\t\tself.items( items );\n\t}\n\n\tprotected clearLine(index:KnockoutObservable<number>) : void\n\t{\n\t\tconst self = this;\n\t\tconst item = self.items()[ index() ];\n\t\titem.setAllLanguagesTo( '' );\n\t}\n\tprotected addLine() : void\n\t{\n\t\tthis.items.push( new TranslationItem() );\n\t}\n\n\tprotected async save() : Promise<void>\n\t{\n\t\tconst self = this;\n\n\t\tconst toSave = self.items()\n\t\t\t\t\t\t.map( (item)=>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif(! item.modified() )\n\t\t\t\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t\t\t\tconst dto : trnCtrl.SaveRequestItem = item.toDTO();\n\t\t\t\t\t\t\t\tdto.enOriginal = item.enOriginal();\n\t\t\t\t\t\t\t\treturn dto;\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t.filter( (item)=>(item != null) );\n\n\t\tif( toSave.length == 0 )\n\t\t{\n\t\t\t// NOOP => Simply refresh\n\t\t\tawait self.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc = await trnCtrl.save({ type:self.type, translations:toSave });\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'save translations error', { rc } );\n\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tawait self.refresh();\n\t}\n}\nclass TranslationItem extends trnDto.TranslationItemKO\n{\n\tprotected readonly showReset\t: KnockoutComputed<boolean>;\n\n\tconstructor(src?:trnDto.TranslationItem)\n\t{\n\t\tsuper( src );\n\t\tconst self = this;\n\t\tthis.showReset = ko.computed( ()=>self.inTranslation() );\n\t}\n}\n\nclass Features extends TranslationsBase\n{\n\tconstructor($blockingDiv:JQuery)\n\t{\n\t\tsuper( trnCtrl.TranslationTypes.feature, $blockingDiv );\n\t}\n}\n","\nimport * as common from \"../common\";\n\nexport namespace list\n{\n\texport async function list(p:{ noLayout?:boolean, includeImages?:boolean, includeInactives?:boolean, skipToID?:number, take?:number }) : Promise<string>\n\t{\n\t\tvar url = common.routes.blog.list.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\t\treturn await common.url.getRequest( url, p );\n\t}\n}\n","\nimport * as tmce from \"tinymce\";\nimport * as common from \"../common\";\nimport * as dtos from \"../../DTOs/BlogPost\";\nimport * as ctrl from \"../../Services/BlogController\";\n\nconst message_confirmRefresh = 'Are your sure you want to reset the current form ?';\nconst message_confirmDelete = 'Are your sure you want to delete the current post ?';\n\nvar isAdding : boolean;\nvar $blockingDiv : JQuery;\nexport var post : dtos.BlogPostKO;\n\nexport async function init(p:{\tisAdding\t\t\t: boolean,\n\t\t\t\t\t\t\t\tpost\t\t\t\t: dtos.BlogPost,\n\t\t\t\t\t\t\t\t$blockingDiv\t\t: JQuery,\n\t\t\t\t\t\t\t\t$picUploadControl\t: JQuery,\n\t\t\t\t\t\t\t\t$txtDate\t\t\t: JQuery,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'edit.init() START', { p } );\n\n\tisAdding\t\t= p.isAdding;\n\t$blockingDiv\t= p.$blockingDiv;\n\tpost\t\t\t= new dtos.BlogPostKO( p.post );\n\n\tcommon.utils.log( 'edit.init(): add custom Knockout bindings handler' );\n\taddKoTinymceEditor();\n\n\tcommon.utils.log( 'edit.init(): Init picture upload' );\n\tp.$picUploadControl.on( 'change', ()=>\n\t\t{\n\t\t\tconst files = (<HTMLInputElement>p.$picUploadControl[0]).files;\n\t\t\tuploadPicture( files );\n\t\t} );\n\n\tcommon.utils.log( 'edit.init(): Init date picker' );\n\tp.$txtDate.datepicker({ dateFormat: 'yy-mm-dd' });\n\n\tcommon.utils.log( 'edit.init() END' );\n}\n\n/** Add 'tinymceEditor' Knockout bindings handler */\nexport function addKoTinymceEditor() : void\n{\n\t// Create HTML editor KO's binding\n\tko.bindingHandlers.tinymceEditor =\n\t\t{\n\t\t\tinit : function(element, valueAccessor, allBindings, viewModel, bindingContext)\n\t\t\t\t{\n\t\t\t\t\tconst $element = $(element);\n\t\t\t\t\tconst observable : KnockoutObservable<string> = valueAccessor();\n\n\t\t\t\t\t// Initial sync.\n\t\t\t\t\t$element.html( observable() );\n\n\t\t\t\t\t(<any>$element).tinymce( {\n\t\t\t\t\t\t\tinline\t: true,\n\t\t\t\t\t\t\tplugins\t: 'image,code',\n\t\t\t\t\t\t\tsetup\t: function(ed:tmce.Editor)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\ted.on( 'change', function()\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t// HTML has changed\n\t\t\t\t\t\t\t\t\t\t\t\t\tobservable( $element.html() );\n\t\t\t\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\tupdate : function(element, valueAccessor)\n\t\t\t\t{\n\t\t\t\t\t// Observable has changed\n\t\t\t\t\tconst observable : KnockoutObservable<string> = valueAccessor();\n\t\t\t\t\tconst newHtml = observable();\n\t\t\t\t\tconst $element = $(element);\n\t\t\t\t\tconst origHtml = $element.html();\n\t\t\t\t\tif( newHtml != origHtml )\n\t\t\t\t\t\t// HTML has changed\n\t\t\t\t\t\t$element.html( newHtml );\n\t\t\t\t\telse\n\t\t\t\t\t\t{/*nb: Don't update HTML when not necessary or we loose the cursor position*/}\n\t\t\t\t},\n\t\t};\n}\n\nasync function uploadPicture(files:FileList) : Promise<void>\n{\n\tcommon.utils.log( 'edit.uploadPicture(): START', {files} );\n\n\tif( files.length == 0 )\n\t\treturn;\n\tif( (<any>window).FormData === undefined )\n\t{\n\t\tcommon.utils.error( \"This browser doesn't support HTML5 file uploads!\" );\n\t\treturn;\n\t}\n\n\t const rc = await ctrl.uploadPicture( files[0] );\n\t if(! rc.success )\n\t {\n\t\t common.utils.error( 'edit.uploadPicture(): Error', { rc } );\n\t\t common.html.showMessage( rc.errorMessage );\n\t\t return;\n\t }\n\n\tpost.imageHtml( rc.imageTagContent );\n\n\tcommon.utils.log( 'edit.uploadPicture(): END' );\n}\n\nexport async function refresh(confirmed:boolean) : Promise<void>\n{\n\tcommon.utils.log( 'edit.refresh(): START' );\n\n\tcommon.utils.log( 'edit.refresh(): Wait for user confirmation' );\n\tif( confirmed != true )\n\t\tconfirmed = await common.html.confirm( message_confirmRefresh );\n\tif(! confirmed )\n\t{\n\t\tcommon.utils.log( 'edit.refresh(): NOT confirmed ; END' );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): Retreive item' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.list({ id:post.id(), includeImages:true, includeInactives:true });\n\tcommon.html.unblock( $blockingDiv );\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'retreive post error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\tcommon.utils.log( 'edit.refresh(): Update blog post' );\n\tpost.fromDTO( rc.posts[0] );\n\n\tcommon.utils.log( 'edit.refresh(): END' );\n}\n\nexport async function save() : Promise<void>\n{\n\tcommon.utils.log( 'edit.save(): START' );\n\n\tcommon.utils.log( 'edit.save(): Create DTO' );\n\tconst dto = post.toDTO();\n\n\tcommon.utils.log( 'edit.save(): Send the save request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.save( dto );\n\tcommon.html.unblock( $blockingDiv );\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.save(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tif( isAdding )\n\t{\n\t\tcommon.utils.log( 'edit.save(): Adding => Redirect to edit page' );\n\t\tconst url = common.routes.blog.edit.replace( common.routes.itemIDParameter, ''+rc.id );\n\t\tcommon.url.redirect( url );\n\t}\n\telse\n\t{\n\t\tawait refresh( /*confirmed*/true );\n\t}\n\n\tcommon.utils.log( 'edit.save(): END' );\n}\n\nexport async function delete_() : Promise<void>\n{\n\tcommon.utils.log( 'edit.delete(): START' );\n\n\tcommon.utils.log( 'edit.delete(): Wait for user confirmation' );\n\tconst confirmed = await common.html.confirm( message_confirmDelete );\n\tif(! confirmed )\n\t{\n\t\tcommon.utils.log( 'edit.delete(): NOT confirmed ; END' );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.delete(): Send the delete request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.delete_( post.id() );\n\tcommon.html.unblock( $blockingDiv );\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.delete(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.error( 'edit.delete(): Redirect to list page' );\n\tconst url = common.routes.blog.list.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\tcommon.url.redirect( url );\n\n\tcommon.utils.log( 'edit.delete(): END' );\n}\n","\nimport * as common from \"../common\";\nimport * as dtos from \"../../DTOs/BlogPost\";\nimport * as apiCtrl from \"../../Services/BlogController\";\nimport * as htmlCtrl from \"./BlogController\";\n\nconst blogIdAttribute = 'ttt-blog-id';\n\nexport async function init(p:{\t$postsContainer\t: JQuery,\n\t\t\t\t\t\t\t\t$endPostElement\t: JQuery,\n\t\t\t\t\t\t\t\t$spinner\t\t: JQuery,\n\t\t\t\t\t\t\t\tpostsIncrement\t: number,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'list.init() START', { p } );\n\n\t// Retreive images of initially loaded posts\n\tconst lastPost = await loadImages();\n\n\tcommon.utils.log( 'list.init(): Wait for document.load' );\n\tawait new Promise<void>( (resolve)=>$(window).on( 'load', ()=>resolve() ) );\n\tcommon.utils.log( 'list.init(): Loaded!' );\n\n\t// Start \"scroll-triggered\" retreives loop\n\t/*await*/ loopLoadNextPosts({ $endPostElement:p.$endPostElement, $spinner:p.$spinner, lastPost, postsIncrement:p.postsIncrement });\n\n\tcommon.utils.log( 'list.init() END' );\n}\n\nasync function loopLoadNextPosts(p:{ $endPostElement:JQuery, $spinner:JQuery, lastPost:PostItem, postsIncrement:number }) : Promise<void>\n{\n\tcommon.utils.log( 'loopLoadNextPosts(): START', { p } );\n\n\tlet lastPost = p.lastPost;\n\twhile( lastPost != null )\n\t{\n\t\tcommon.utils.log( 'loopLoadNextPosts(): Wait for $endPostElement to be visible' );\n\t\tawait common.html.waitForScrolledVisible( p.$endPostElement );\n\n\t\tcommon.utils.log( `loopLoadNextPosts(): Request next '${p.postsIncrement}' posts` );\n\t\tp.$spinner.show();\n\t\tconst html = await htmlCtrl.list.list({ noLayout:true, includeImages:false, skipToID:lastPost.id, take:p.postsIncrement });\n\t\tp.$spinner.hide();\n\n\t\tcommon.utils.log( 'loopLoadNextPosts(): Append received posts' );\n\t\tp.$endPostElement.before( html );\n\n\t\tcommon.utils.log( `loopLoadNextPosts(): Launch 'loadImages()'`, { lastPost } );\n\t\tlastPost = await loadImages();\n\n\t\tcommon.utils.log( 'loopLoadNextPosts()', { lastPost } );\n\t}\n\n\tcommon.utils.log( 'loopLoadNextPosts(): END' );\n}\n\nasync function loadImages() : Promise<PostItem>\n{\n\tcommon.utils.log( 'loadImages(): START' );\n\n\t// Find all new elements with the \"tag attribute\" (i.e. all new blog posts)\n\tconst posts : PostItem[] = [];\n\t$(`[${blogIdAttribute}]`).each( (i,e)=>\n\t\t{\n\t\t\tconst $container = $(e);\n\t\t\tconst id = parseInt( $container.attr(blogIdAttribute) );\n\t\t\t$container.removeAttr( blogIdAttribute );  // Remove the \"tag attribute\" from the DOM so that next call to this method does not re-find this item\n\t\t\tposts.push({ id, $container, model:null });\n\t\t} );\n\n\tcommon.utils.log( 'loadImages(): Asynchroneously retreive posts (full) DTOs', { posts } );\n\tposts.forEach( async (item)=>\n\t\t{\n\t\t\tcommon.html.block( item.$container );\n\t\t\tconst rc = await apiCtrl.list({ id:item.id, includeInactives:true });\n\t\t\tcommon.html.unblock( item.$container );\n\t\t\tif(! rc.success )\n\t\t\t{\n\t\t\t\tcommon.utils.error( 'retreive post error', { rc } );\n\t\t\t\t// common.html.showMessage( rc.errorMessage ); <== publicly-accessible page => Don't show internal errors ...\n\t\t\t\treturn;\n\t\t\t}\n\t\t\titem.model = rc.posts[0];\n\n\t\t\tcommon.utils.log( 'loadImages(): Bind model', { /*model:item.model,*/ $element:item.$container, id:item.id } );\n\t\t\tko.applyBindings( item.model, item.$container[0] );\n\t\t} );\n\n\tconst lastPostItem = (posts.length > 0) ? posts[posts.length - 1] : null;\n\tcommon.utils.log( 'loadImages(): END', { lastPostItem } );\n\treturn lastPostItem;\n}\n\ninterface PostItem\n{\n\tid\t\t\t: number;\n\t$container\t: JQuery;\n\tmodel\t\t: dtos.BlogPost;\n}\n","\nimport * as common from \"../common\";\nimport { addKoTinymceEditor } from \"../Blog/Edit\";\nimport * as ctrl from \"../../Services/DynamicPageController\";\n\nvar $blockingDiv\t: JQuery;\nvar itemCode\t\t: string;\nexport var textHtml\t: KnockoutObservable<string>;\n\nexport async function init(p:{\t$blockingDiv\t: JQuery,\n\t\t\t\t\t\t\t\titemCode\t\t: string,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'show.init() START', { p } );\n\n\t$blockingDiv\t= p.$blockingDiv;\n\titemCode\t\t= p.itemCode;\n\ttextHtml\t\t= ko.observable();\n\n\tcommon.utils.log( 'show.init(): add custom Knockout bindings handler' );\n\taddKoTinymceEditor();\n\n\tcommon.utils.log( 'show.init() END' );\n}\n\nexport async function save() : Promise<void>\n{\n\tcommon.utils.log( 'show.save(): START' );\n\tcommon.html.block( $blockingDiv );\n\n\tcommon.utils.log( 'show.save(): Send the save request' );\n\tawait ctrl.update({ itemCode, text:textHtml() });\n\n\tcommon.utils.log( 'show.save(): Refresh' );\n\tawait refresh();\n\n\tcommon.html.unblock( $blockingDiv );\n\tcommon.utils.log( 'show.save(): END' );\n}\n\nexport async function refresh() : Promise<void>\n{\n\tcommon.utils.log( 'show.refresh(): START' );\n\tcommon.html.block( $blockingDiv );\n\n\tcommon.utils.log( 'show.save(): Send the get request' );\n\tconst newHtml = await ctrl.get({ itemCode });\n\n\tcommon.utils.log( 'show.save(): Update html' );\n\ttextHtml( newHtml );\n\n\tcommon.html.unblock( $blockingDiv );\n\tcommon.utils.log( 'show.refresh(): END' );\n}\n","\nimport * as common from \"../common\";\nimport * as dto from \"../../DTOs/Item\";\nimport * as ctrl from \"../../Services/ItemController\";\n\nvar $blockingDiv : JQuery;\nexport var item : dto.ItemKO;\n\nexport async function init(p:{\t$blockingDiv\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSave\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$fieldsContainer\t: JQuery }) : Promise<void>\n{\n\tcommon.utils.log( 'add.init() START', { p } );\n\t$blockingDiv = p.$blockingDiv;\n\n\tcommon.utils.log( 'add.init(): Create KO item' );\n\titem = new dto.ItemKO( p.$fieldsContainer );\n\n\tcommon.utils.log( 'add.init(): Apply KO item' );\n\tko.applyBindings( item, p.$fieldsContainer[0] );\n\n\tcommon.utils.log( 'add.init(): Bind JQuery events' );\n\tp.$btnSave.click( save );\n\n\tcommon.utils.log( 'add.init() END' );\n}\n\nasync function save() : Promise<void>\n{\n\tcommon.utils.log( 'add.save(): START' );\n\n\tconst obj = item.toDictObj();\n\n\tcommon.utils.log( 'add.save(): Launch save' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.save({ item:obj });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'add.save(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'add.save(): Redirect', { rc } );\n\tconst url = common.routes.itemTTT.edit.replace( common.routes.itemCodeParameter, rc.newCode );\n\tcommon.utils.log( `add.save(): url=\"${url}\"` );\n\tcommon.url.redirect( url );\n\n\tcommon.utils.log( 'add.save(): END' );\n}\n","\nimport * as common from \"../common\";\nimport * as dto from \"../../DTOs/Item\";\nimport { ItemPicture } from \"../../DTOs/ItemPicture\";\nimport * as ctrl from \"../../Services/ItemController\";\nimport * as picCtrl from \"../../Services/ItemPictureController\";\nimport * as trnCtrl from \"../../Services/TranslationController\";\nimport { TranslationKO } from \"../../DTOs/Translation\";\n\nconst message_confirmDelete = 'Are you sure you want to delete that item?';\nconst message_saveSuccess = 'Item saved successfully';\nconst message_refreshFailed = 'An error occured while refresing the data: ';\nconst message_confirmDeletePicture = 'Are you sure you want to delete that image?';\n\nvar $blockingDiv : JQuery;\nvar originalCode : string;\n\nexport var item\t\t\t: ItemKO;\nexport var picDropZone\t: { hover:KnockoutObservable<boolean> };\n\nexport async function init(p:{\tmodel\t\t\t\t: dto.Item,\n\t\t\t\t\t\t\t\t$blockingDiv\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSave\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$btnDelete\t\t\t: JQuery,\n\t\t\t\t\t\t\t\t$fieldsContainer\t: JQuery,\n\t\t\t\t\t\t\t\t$picUploadDropZone\t: JQuery,\n\t\t\t\t\t\t\t\t$picUploadControl\t: JQuery,\n\t\t\t\t\t\t\t}) : Promise<void>\n{\n\tcommon.utils.log( 'edit.init() START', { p } );\n\t$blockingDiv = p.$blockingDiv;\n\n\tcommon.utils.log( 'edit.init(): Create KO item' );\n\titem = new ItemKO( p.$fieldsContainer, p.model );\n\toriginalCode = item.code();\n\n\tcommon.utils.log( 'edit.init(): Bind JQuery events' );\n\tp.$btnSave.click( save );\n\tp.$btnDelete.click( ()=>{ delete_(); } );\n\n\tcommon.utils.log( 'edit.init(): Init picture upload' );\n\tinitPictureUpload( p.$picUploadDropZone, p.$picUploadControl );\n\n\tcommon.utils.log( 'edit.init() END' );\n}\n\nfunction initPictureUpload($dropZone:JQuery, $upload:JQuery) : void\n{\n\tcommon.utils.log( 'edit.initDropZone(): Create drop zone object' );\n\n\tpicDropZone = {\n\t\t\thover : ko.observable(false),\n\t\t};\n\n\tcommon.utils.log( 'edit.initDropZone(): Watch for drag-drops on \"upload image drop zone\"' );\n\n\t$dropZone.on( 'dragenter', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( true );\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t} );\n\t$dropZone.on( 'dragover', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( true );\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t} );\n\t$dropZone.on( 'dragleave', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( false );\n\t\t} );\n\t$dropZone.on( 'drop', function(e)\n\t\t{\n\t\t\tpicDropZone.hover( false );\n\t\t\te.preventDefault();\n\n\t\t\tvar files = (<any>e.originalEvent).dataTransfer.files;\n\t\t\tuploadPicture( files );\n\t\t});\n\n\t$upload.on( 'change', ()=>\n\t\t{\n\t\t\tconst files = (<HTMLInputElement>$upload[0]).files;\n\t\t\tuploadPicture( files );\n\t\t} );\n}\n\nexport async function autoCompleteFeature(searchTerm:string) : Promise<string[]>\n{\n\tvar rc = await trnCtrl.autoCompleteResolve({ type:trnCtrl.TranslationTypes.feature, searchString:searchTerm, includeTranslations:true });\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'autocomplete error', { rc } );\n\t\treturn [];\n\t}\n\treturn rc.list;\n}\n\nasync function save() : Promise<void>\n{\n\tcommon.utils.log( 'edit.save(): START' );\n\n\tconst obj = item.toDictObj();\n\n\tcommon.utils.log( 'edit.save(): Launch save' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.save({ originalCode, item:obj });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.save(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.save(): Refresh values', { rc } );\n\tconst rcr = await refresh( rc.newCode );\n\tif( rcr )\n\t\tcommon.html.showMessage( message_saveSuccess );\n\n\tcommon.utils.log( 'edit.save(): END' );\n}\n\nasync function delete_(confirmed?:boolean) : Promise<void>\n{\n\tcommon.utils.log( 'edit.delete(): START' );\n\n\tif( confirmed != true )\n\t{\n\t\tcommon.utils.log( 'edit.delete(): Ask confirmation' );\n\t\tconst rc = await common.html.confirm( message_confirmDelete );\n\t\tif(! rc )\n\t\t{\n\t\t\tcommon.utils.log( 'edit.delete(): NOT CONFIRMED' );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommon.utils.log( 'edit.delete(): Launch delete' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.delete_( originalCode );\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.delete(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( 'edit.delete(): Redirect' );\n\tconst url = common.routes.itemTTT.list.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\tcommon.utils.log( 'edit.delete()', { url } );\n\tcommon.url.redirect( url );\n\n\tcommon.utils.log( 'edit.delete(): END' );\n}\n\nasync function uploadPicture(files:FileList) : Promise<void>\n{\n\tcommon.utils.log( 'edit.uploadPicture(): START', {files} );\n\n\tif( files.length == 0 )\n\t\treturn;\n\tif( (<any>window).FormData === undefined )\n\t{\n\t\tcommon.utils.error( \"This browser doesn't support HTML5 file uploads!\" );\n\t\treturn;\n\t}\n\n\tcommon.utils.log( `edit.uploadPicture(): Create '${files.length}' upload tasks` );\n\tcommon.html.block( $blockingDiv );\n\tconst tasks = $.map( files, (file:File)=>\n\t\t{\n\t\t\treturn picCtrl.upload( originalCode, file );\n\t\t} );\n\n\tcommon.utils.log( 'edit.uploadPicture(): Wait for tasks to terminate' );\n\tconst rcs = await Promise.all( tasks );\n\tcommon.html.unblock( $blockingDiv );\n\tcommon.utils.log( 'edit.uploadPicture(): All tasks terminated' );\n\n\t$.each( rcs, (i,rc)=>\n\t\t{\n\t\t\tif(! rc )\n\t\t\t{\n\t\t\t\tcommon.utils.error( 'edit.delete(): Upload error', { i, rc } );\n\t\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\t}\n\t\t} );\n\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.uploadPicture(): END' );\n}\n\nexport async function deletePicture(picture:ItemPicture, confirmed?:boolean) : Promise<void>\n{\n\tcommon.utils.log( 'edit.deletePicture(): START' );\n\n\tif( confirmed != true )\n\t{\n\t\tcommon.utils.log( 'edit.deletePicture(): Ask confirmation' );\n\t\tconst rc = await common.html.confirm( message_confirmDeletePicture );\n\t\tif(! rc )\n\t\t{\n\t\t\tcommon.utils.log( 'edit.deletePicture(): NOT CONFIRMED' );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommon.utils.log( 'edit.deletePicture(): Launch delete request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.delete_({ itemCode:picture.itemCode, number:picture.number });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.deletePicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.deletePicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.deletePicture(): END' );\n}\n\nexport async function toggleMainPicture(picture:ItemPicture) : Promise<void>\n{\n\tcommon.utils.log( 'edit.toggleMainPicture(): START' );\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): Launch toggle request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.setMain({ itemCode:picture.itemCode, number:picture.number, isMain:(!picture.isMainImage) });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.toggleMainPicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.toggleMainPicture(): END' );\n}\n\nexport async function reorderPicture(picture:ItemPicture, offset:number) : Promise<void>\n{\n\tcommon.utils.log( 'edit.movePicture(): START' );\n\n\tlet newNumber = picture.number + offset;\n\tif( newNumber <= 0 )\n\t\tnewNumber = 1;\n\tif( picture.number == newNumber )\n\t\t// NOOP\n\t\treturn;\n\n\tcommon.utils.log( 'edit.movePicture(): Launch move request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await picCtrl.reorder({ itemCode:picture.itemCode, number:picture.number, newNumber:newNumber });\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.movePicture(): Error', { rc } );\n\t\tcommon.html.showMessage( rc.errorMessage );\n\t}\n\n\tcommon.utils.log( 'edit.movePicture(): Launch refresh' );\n\tawait refresh();\n\n\tcommon.utils.log( 'edit.movePicture(): END' );\n}\n\nasync function refresh(code?:string) : Promise<boolean>\n{\n\t// TODO: Allow refresh only images to avoid overwriting any modifications to input fields ...\n\tcommon.utils.log( 'edit.refresh(): START' );\n\n\tlet newUrl : string = null;\n\tif( code == null )\n\t{\n\t\tcode = originalCode;\n\t}\n\telse\n\t{\n\t\tif( originalCode != code )\n\t\t\t// URL must change!\n\t\t\tnewUrl = common.routes.itemTTT.edit.replace( common.routes.itemCodeParameter, code );\n\t\toriginalCode = code;\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): Launch request' );\n\tcommon.html.block( $blockingDiv );\n\tconst rc = await ctrl.details( code );\n\tcommon.html.unblock( $blockingDiv );\n\n\tif(! rc.success )\n\t{\n\t\tcommon.utils.error( 'edit.refresh(): Error', { rc } );\n\t\tcommon.html.showMessage( message_refreshFailed+rc.errorMessage );\n\t\treturn false;\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): Load from new item', { rc } );\n\titem.fromDictObj( rc.item );\n\n\tif( newUrl != null )\n\t{\n\t\tcommon.utils.log( `edit.refresh(): Update URL to \"${newUrl}\"` );\n\t\tcommon.url.pushHistory({ pathname:newUrl, newTitle:item.name() });\n\t}\n\n\tcommon.utils.log( 'edit.refresh(): END' );\n\treturn true;\n}\n\n/** Used to add a changing parameter to the URL to bypass browser's cache */\nexport function scrambleUrl(url:string) : string\n{\n\tif( url.indexOf('?') >= 0 )\n\t\turl = url + '&';\n\telse\n\t\turl = url + '?';\n\turl = url + 'p=' + common.utils.newGuid();\n\treturn url;\n}\n\nclass ItemKO extends dto.ItemKO\n{\n\tpublic readonly features\t\t: KnockoutObservableArray<TranslationKO>;\n\tpublic readonly pictures\t\t: KnockoutObservableArray<ItemPicture>;\n\n\tconstructor($container:JQuery, src:dto.Item)\n\t{\n\t\tsuper( $container, src );\n\t\tthis.features\t= ko.observableArray( src.features.map(v=>new TranslationKO(v)) );\n\t\tthis.pictures\t= ko.observableArray( src.pictures );\n\t}\n\n\tprotected addNewFeature() : void\n\t{\n\t\tconst self = this;\n\t\tself.features.push( new TranslationKO() );\n\t}\n\n\tpublic /*override*/ toDictObj(dict?:dto.DictObj) : dto.Item\n\t{\n\t\tconst self = this;\n\t\tconst item = <dto.Item>super.toDictObj( dict );\n\t\titem.features\t= self.features().map( v=>{ return { en:v.en(), fr:'', nl:'' }; } );  // nb: only EN is used server-side\n\t\treturn item;\n\t}\n\n\tpublic /*override*/ fromDictObj(item:dto.Item) : void\n\t{\n\t\tconst self = this;\n\t\tsuper.fromDictObj( item );\n\t\tself.features( item.features.map( v=>{ return new TranslationKO(v); } ) );\n\t\tself.pictures( item.pictures );\n\t}\n}\n","\nimport * as common from \"../common\";\n\nexport namespace list\n{\n\texport const { e:ViewModes, a:allViewModes } = common.utils.strEnum([ 'grid', 'list' ]);\n\texport type ViewMode = keyof typeof ViewModes;\n\n\texport const { e:SortingFields, a:allSortingFields } = common.utils.strEnum([ 'price', 'price_desc', 'name', 'name_desc' ]);\n\texport type SortingField = keyof typeof SortingFields;\n\n\texport async function getListContent(p:GetListContentRequest) : Promise<string>\n\t{\n\t\tvar url = common.routes.itemTTT.list.replace( common.routes.languageParameter, common.pageParameters.currentLanguage );\n\t\treturn await common.url.getRequest( url, p );\n\t}\n\texport interface GetListContentRequest\n\t\t{\n\t\t\tviewMode?\t\t: ViewMode,\n\t\t\tsortingField?\t: SortingField,\n\t\t\tnoLayout?\t\t: boolean,\n\t\t};\n}\n","\nimport * as common from \"../common\";\nimport * as itemCtrl from \"../../Services/ItemController\";\nimport { list } from \"./ItemTTTController\";\nimport * as dto from \"../../DTOs/Item\";\nimport { Languages } from \"../../Language\";\n\nconst modelSearchString = '[type=ttt-model]';\n\nvar currentSortingField : list.SortingField;\nvar $txtSearch\t\t: JQuery;\nvar $cbShowInactive\t: JQuery;\nvar $divCarsList\t: JQuery;\nvar $divBlocking\t: JQuery;\n\nexport var itemsList : ItemKO[];\n\nexport async function init(p:{\tsortingField\t: list.SortingField,\n\t\t\t\t\t\t\t\t$txtSearch\t\t: JQuery,\n\t\t\t\t\t\t\t\t$cbShowInactive\t: JQuery,\n\t\t\t\t\t\t\t\t$divCarsList\t: JQuery,\n\t\t\t\t\t\t\t\t$btnViewList\t: JQuery,\n\t\t\t\t\t\t\t\t$btnViewGrid\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSortName\t: JQuery,\n\t\t\t\t\t\t\t\t$btnSortPrice\t: JQuery }) : Promise<void>\n{\n\tcommon.utils.log( 'list.init(): START' );\n\n\tcurrentSortingField\t= p.sortingField;\n\t$txtSearch\t\t\t= p.$txtSearch;\n\t$cbShowInactive\t\t= p.$cbShowInactive.prop( 'checked', true );\n\t$divCarsList\t\t= p.$divCarsList;\n\t$divBlocking\t\t= $divCarsList;\n\tp.$btnViewGrid\t.click( ()=>{ refreshList({ viewMode:list.ViewModes.grid }) } );\n\tp.$btnViewList\t.click( ()=>{ refreshList({ viewMode:list.ViewModes.list }) } );\n\tp.$btnSortName\t.click( ()=>{ refreshList({ sortingField:list.SortingFields.name }) } );\n\tp.$btnSortPrice\t.click( ()=>{ refreshList({ sortingField:list.SortingFields.price }) } );\n\n\treconstructItemsList();\n\n\tcommon.utils.log( 'list.init(): Bind JQuery events' );\n\t$txtSearch.keyup( ()=>{ filterItemsList(); } );\n\t$cbShowInactive.change( ()=>{ filterItemsList(); } );\n\n\tcommon.utils.log( 'list.init(): END' );\n}\n\nfunction reconstructItemsList() : void\n{\n\tcommon.utils.log( 'list.reconstructItemsList(): START' );\n\n\tconst $models = $divCarsList.find( modelSearchString );\n\n\tcommon.utils.log( `list.reconstructItemsList(): Reconstructing ${$models.length} models`  );\n\tconst items : ItemKO[] = [];\n\t$models.each( (i,e)=>\n\t\t{\n\t\t\t// Find the JSON model's tag & set its parent element as the item's container\n\t\t\tconst $modelElement = $(e);\n\t\t\tconst $container = $modelElement.parent();\n\t\t\tconst model = <dto.Item>JSON.parse( $modelElement.text() );\n\n\t\t\t// Remove the model tag (i.e. free memory ?)\n\t\t\t$modelElement.remove();\n\n\t\t\t// Create the ItemKO and add it to the list\n\t\t\tconst item = new ItemKO( $container, model );\n\t\t\titems.push( item );\n\t\t} );\n\n\tcommon.utils.log( 'list.reconstructItemsList(): Replacing itemsList'  );\n\titemsList = items;\n\n\tcommon.utils.log( 'list.reconstructItemsList(): END' );\n}\n\nexport function filterItemsList() : void\n{\n\titemsList.forEach( (item)=>\n\t\t{\n\t\t\titem.visible( item.getIsVisible() );\n\t\t} );\n}\n\nasync function refreshList(p:list.GetListContentRequest) : Promise<void>\n{\n\tcommon.utils.log( 'list.refreshList(): START', { p, currentSortingField } );\n\n\t// Ask for the stripped version of the page (no layout)\n\tp.noLayout = true;\n\n\t// Switch to descending order if required\n\tif( p.sortingField != null )\n\t{\n\t\tif( p.sortingField == currentSortingField )\n\t\t{\n\t\t\tswitch( currentSortingField )\n\t\t\t{\n\t\t\t\tcase list.SortingFields.name:\tp.sortingField = list.SortingFields.name_desc;\tbreak;\n\t\t\t\tcase list.SortingFields.price:\tp.sortingField = list.SortingFields.price_desc;\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tcurrentSortingField = p.sortingField;\n\t}\n\n\tcommon.utils.log( 'list.refreshList(): Request html & replace list DOM' );\n\tcommon.html.block( $divBlocking );\n\tvar html = await list.getListContent( p );\n\tcommon.html.unblock( $divBlocking );\n\t$divCarsList.html( html );\n\n\treconstructItemsList();\n\n\tcommon.utils.log( 'list.refreshList(): END', { currentSortingField } );\n}\n\nclass ItemKO extends dto.ItemKO\n{\n\tpublic readonly $container\t: JQuery;\n\tpublic readonly visible\t\t: KnockoutObservable<boolean>;\n\n\tconstructor($container:JQuery, model:dto.Item)\n\t{\n\t\tconst required = [\tcommon.utils.nameof<dto.ItemKO>('code'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('name'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionEN'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionFR'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('descriptionNL'),\n\t\t\t\t\t\t\tcommon.utils.nameof<dto.ItemKO>('active') ];\n\t\tsuper( $container, model, required );\n\t\tconst self = this;\n\t\tthis.$container\t= $container;\n\t\tthis.visible\t= ko.observable( self.getIsVisible() );\n\n\t\t// Bind this object to its container\n\t\tko.applyBindings( self, $container[0] );\n\t}\n\n\tpublic async toggleActive() : Promise<void>\n\t{\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): START' );\n\t\tconst self = this;\n\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): Retreive original model' );\n\t\tcommon.html.block( $divBlocking );\n\t\t{\n\t\t\tconst rc = await itemCtrl.details( self.code() );\n\t\t\tif(! rc.success )\n\t\t\t{\n\t\t\t\tcommon.html.unblock( $divBlocking );\n\t\t\t\tcommon.utils.error( 'Item retreive error', { rc } );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar model = rc.item;\n\t\t}\n\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): Toggle active flag & save' );\n\t\t{\n\t\t\tmodel.active = (! model.active);\n\t\t\tconst rc = await itemCtrl.save({ originalCode:model.code, item:model });\n\t\t\tif(! rc.success )\n\t\t\t\tcommon.utils.error( 'Item save error', { rc } );\n\t\t}\n\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): Refresh' );\n\t\tawait refreshList({});\n\n\t\tcommon.html.unblock( $divBlocking );\n\t\tcommon.utils.log( 'list.ItemKO.toggleActive(): END' );\n\t}\n\n\tpublic getIsVisible() : boolean\n\t{\n\t\tconst self = this;\n\n\t\t// Check \"show active\" checkbox\n\n\t\tconst showInactive = $cbShowInactive.is( ':checked' );\n\t\tif( ! self.active() )\n\t\t\tif( ! showInactive )\n\t\t\t\treturn false;\n\n\t\t// Check \"search\" textbox\n\n\t\tlet searchString = <string>$txtSearch.val();\n\t\tsearchString = (searchString == null ? '' : searchString).toLowerCase().trim();\n\t\tif( searchString == '' )\n\t\t\treturn true;\n\t\tlet searchWords : string[] = [];\n\t\t$.each( searchString.split(' '), function(i,word)\n\t\t\t{\n\t\t\t\tif( common.utils.stringIsNullOrWhitespace(word) )\n\t\t\t\t\treturn;\n\t\t\t\tsearchWords.push( word.trim() );\n\t\t\t} );\n\n\t\tconst searchFields : string[] = [];\n\t\tsearchFields.push( self.name() );\n\t\tswitch( common.pageParameters.currentLanguage )\n\t\t{\n\t\t\tcase Languages.en:\tsearchFields.push( self.descriptionEN() );\tbreak;\n\t\t\tcase Languages.fr:\tsearchFields.push( self.descriptionFR() );\tbreak;\n\t\t\tcase Languages.nl:\tsearchFields.push( self.descriptionNL() );\tbreak;\n\t\t}\n\n\t\tlet matchCount = 0;\n\t\tsearchWords.forEach( (word,i)=>\n\t\t\t{\n\t\t\t\tfor( let i=0; i<searchFields.length; ++i )\n\t\t\t\t{\n\t\t\t\t\tconst field = searchFields[i].toLowerCase();\n\t\t\t\t\tif( field.indexOf(word) >= 0 )\n\t\t\t\t\t{\n\t\t\t\t\t\t++ matchCount;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\tif( matchCount != searchWords.length )  // All words must match\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n}\n","\nimport * as common from \"../common\";\nimport * as dtos from \"../../DTOs/Testimonial\";\nimport * as ctrl from \"../../Services/TestimonialController\";\n\nconst testimonialIdAttribute = 'ttt-testimonial-id';\nvar message_imageUploadError : string;\nconst message_confirmDelete = 'Are you sure you want to delete this testimonial?';\n\nexport var formTestimonial : FormTestimonial;\nvar saveSuccessMessage : string;\n\nexport function init(p:{\turlImgNotFound\t\t\t: string,\n\t\t\t\t\t\t\timageUploadErrorMessage\t: string,\n\t\t\t\t\t\t\tsaveSuccessMessage\t\t: string,\n\t\t\t\t\t\t\t$blockingDiv\t\t\t: JQuery,\n\t\t\t\t\t\t\t$formDialog\t\t\t\t: JQuery,\n\t\t\t\t\t\t\t$picUploadControl\t\t: JQuery }) : void\n{\n\tcommon.utils.log( 'list.init(): START' );\n\n\tmessage_imageUploadError = p.imageUploadErrorMessage;\n\tsaveSuccessMessage = p.saveSuccessMessage;\n\n\tcommon.utils.log( 'list.init(): Create KO for new testimonial form' );\n\tformTestimonial = new FormTestimonial( p.$formDialog, p.$blockingDiv, p.urlImgNotFound );\n\n\tcommon.utils.log( 'list.init(): Init picture upload' );\n\tp.$picUploadControl.click( ()=>\n\t\t{\n\t\t\t// Clear upload control so selecting the same image twice triggers the 'change' event\n\t\t\tp.$picUploadControl.val( null );\n\t\t} );\n\tp.$picUploadControl.change( ()=>\n\t\t{\n\t\t\tconst files = (<HTMLInputElement>p.$picUploadControl[0]).files;\n\t\t\t/*await*/ formTestimonial.uploadPicture( files );\n\t\t} );\n\n\tif( common.pageParameters.isAutenticated )  // Nb: binding actions on testimonial entries is required only for the administrator\n\t{\n\t\tcommon.utils.log( 'list.init(): Bind all testimonial items' );\n\t\t$(`[${testimonialIdAttribute}]`).each( (i,e)=>\n\t\t\t{\n\t\t\t\tconst $e = $(e);\n\t\t\t\tconst id = parseInt( $e.attr(testimonialIdAttribute) );\n\t\t\t\tconst o = new TestimonialItem( id, $e, p.$blockingDiv );\n\t\t\t\tko.applyBindings( o, $e[0] );\n\t\t\t} );\n\t}\n\n\tcommon.utils.log( 'list.init(): END' );\n}\n\nexport class TestimonialItem\n{\n\tprivate readonly\tid\t\t\t\t: number;\n\tprivate readonly\t$blockingDiv\t: JQuery;\n\n\tconstructor(id:number, $container:JQuery, $blockingDiv:JQuery)\n\t{\n\t\tcommon.utils.log( `TestimonialItem(): id:${id}` );\n\t\tthis.id\t\t\t\t= id;\n\t\tthis.$blockingDiv\t= $blockingDiv;\n\t}\n\n\tprotected async toggleActive() : Promise<void>\n\t{\n\t\tconst self = this;\n\t\tcommon.utils.log( `TestimonialItem.toggleActive(): START: id:'${self.id}'` );\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc1 = await ctrl.list({ id:self.id, includeImages:false, includeInactives:true });\n\t\tif(! rc1 )\n\t\t{\n\t\t\tcommon.html.unblock( self.$blockingDiv );\n\t\t\tcommon.utils.error( 'retreive testimonial error', { rc1 } );\n\t\t\tcommon.html.showMessage( rc1.errorMessage );\n\t\t\treturn;\t\n\t\t}\n\t\tif( rc1.testimonials.length != 1 )\n\t\t{\n\t\t\tcommon.html.showMessage( 'Error while retreiving testimonial' );\n\t\t\treturn;\n\t\t}\n\t\tconst dto = rc1.testimonials[0];\n\n\t\tcommon.utils.log( `TestimonialItem.toggleActive(): Create save request` );\n\t\tdto.active = dto.active ? false : true;\n\t\tconst saveRequest : ctrl.SaveRequest = $.extend( dto, { saveImage:false } );\n\n\t\tcommon.utils.log( 'TestimonialItem.toggleActive(): Send the save request' );\n\t\tconst rc2 = await ctrl.save( saveRequest );\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc2.success )\n\t\t{\n\t\t\tcommon.utils.error( 'TestimonialItem.toggleActive(): Error', { rc2 } );\n\t\t\tcommon.html.showMessage( rc2.errorMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.utils.log( 'TestimonialItem.toggleActive(): Reload page' );\n\t\tlocation.reload();\n\n\t\tcommon.utils.log( 'TestimonialItem.toggleActive(): END' );\n\t}\n\n\tprotected async edit() : Promise<void>\n\t{\n\t\tconst self = this;\n\t\tcommon.utils.log( `TestimonialItem.edit(): START: id:'${self.id}'` );\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc1 = await ctrl.list({ id:self.id, includeImages:true, includeInactives:true });\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc1 )\n\t\t{\n\t\t\tcommon.utils.error( 'retreive testimonial error', { rc1 } );\n\t\t\tcommon.html.showMessage( rc1.errorMessage );\n\t\t\treturn;\t\n\t\t}\n\t\tif( rc1.testimonials.length != 1 )\n\t\t{\n\t\t\tcommon.html.showMessage( 'Error while retreiving testimonial' );\n\t\t\treturn;\n\t\t}\n\t\tconst dto = rc1.testimonials[0];\n\n\t\tformTestimonial.show( dto );\n\n\t\tcommon.utils.log( `TestimonialItem.edit(): START: id:'${self.id}'` );\n\t}\n\n\tprotected async delete_() : Promise<void>\n\t{\n\t\tconst self = this;\n\t\tcommon.utils.log( 'TestimonialItem.delete_(): START' );\n\n\t\tcommon.utils.log( 'TestimonialItem.delete_(): Ask confirmation' );\n\t\tconst rc1 = await common.html.confirm( message_confirmDelete );\n\t\tif(! rc1 )\n\t\t{\n\t\t\tcommon.utils.log( 'TestimonialItem.delete_(): NOT CONFIRMED' );\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.utils.log( 'TestimonialItem.delete_(): Launch delete request' );\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc2 = await ctrl.delete_( self.id )\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc2.success )\n\t\t{\n\t\t\tcommon.utils.error( 'TestimonialItem.delete_(): Error', { rc2 } );\n\t\t\tcommon.html.showMessage( rc2.errorMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.utils.log( 'TestimonialItem.delete_(): Reload page' );\n\t\tlocation.reload();\n\n\t\tcommon.utils.log( 'TestimonialItem.delete_(): END' );\n\t}\n}\n\nclass FormTestimonial\n{\n\tprivate readonly\t$container\t\t: JQuery;\n\tprivate readonly\t$blockingDiv\t: JQuery;\n\tprotected readonly\tshowRequiredText: KnockoutObservable<boolean>;\n\n\tprivate\t\t\t\tmodel\t\t\t: dtos.Testimonial;\n\n\tprotected readonly\tdate\t\t\t: KnockoutObservable<string>;\n\tprotected readonly\tfirstLastName\t: KnockoutObservable<string>;\n\tprotected readonly\twhosWho\t\t\t: KnockoutObservable<string>;\n\tprotected readonly\ttext\t\t\t: KnockoutObservable<string>;\n\tprotected readonly\tactive\t\t\t: KnockoutObservable<boolean>;\n\tprotected readonly\timageData\t\t: KnockoutObservable<string>;\n\tprotected readonly\timageSrc\t\t: KnockoutComputed<string>;\n\n\tconstructor($container:JQuery, $blockingDiv:JQuery, urlImgNotFound:string)\n\t{\n\t\tconst self = this;\n\t\tthis.$container\t\t\t= $container;\n\t\tthis.$blockingDiv\t\t= $blockingDiv;\n\t\tthis.showRequiredText\t= ko.observable( false );\n\t\tthis.model\t\t\t\t= null;\n\t\tthis.date\t\t\t\t= ko.observable( '' );\n\t\tthis.firstLastName\t\t= ko.observable( '' );\n\t\tthis.whosWho\t\t\t= ko.observable( '' );\n\t\tthis.text\t\t\t\t= ko.observable( '' );\n\t\tthis.active\t\t\t\t= ko.observable( false );\n\t\tthis.imageData\t\t\t= ko.observable( null );\n\t\tthis.imageSrc\t\t\t= ko.computed( ()=>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tconst data = self.imageData();\n\t\t\t\t\t\t\t\t\t\t\tif( data == null )\n\t\t\t\t\t\t\t\t\t\t\t\treturn urlImgNotFound;\n\t\t\t\t\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\tcommon.utils.log( 'FormTestimonial(): Bind to the Boostrap\\'s close event' );\n\t\tself.$container.on( 'hidden.bs.modal', ()=>self.reset() );\n\n\t\tcommon.utils.log( 'FormTestimonial(): KO bind the form dialog' );\n\t\tko.applyBindings( self, self.$container[0] );\n\t}\n\n\tpublic show(dto:dtos.Testimonial) : void\n\t{\n\t\tcommon.utils.log( 'FormTestimonial.show(): START', { dto } );\n\t\tconst self = this;\n\n\t\tself.reset( dto );\n\t\tself.open();\n\n\t\tcommon.utils.log( 'FormTestimonial.show(): END' );\n\t}\n\n\tpublic async uploadPicture(files:FileList) : Promise<void>\n\t{\n\t\tcommon.utils.log( 'FormTestimonial.uploadPicture(): START', {files} );\n\t\tconst self = this;\n\n\t\tif( files.length == 0 )\n\t\t\treturn;\n\t\tif( (<any>window).FormData === undefined )\n\t\t{\n\t\t\tcommon.utils.error( \"This browser doesn't support HTML5 file uploads!\" );\n\t\t\treturn;\n\t\t}\n\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc = await ctrl.uploadPicture( files[0] );\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'FormTestimonial.uploadPicture(): Error', { rc } );\n\t\t\tcommon.html.showMessage( /*rc.errorMessage*/message_imageUploadError );\n\t\t\treturn;\n\t\t}\n\n\t\tself.imageData( rc.imageData );\n\n\t\tcommon.utils.log( 'FormTestimonial.uploadPicture(): END' );\n\t}\n\n\tprivate reset(dto?:dtos.Testimonial) : void\n\t{\n\t\tcommon.utils.log( 'FormTestimonial.reset(): START' );\n\t\tconst self = this;\n\n\t\tif( dto == null )\n\t\t{\n\t\t\tself.model = null;\n\n\t\t\tself.date( '' );\n\t\t\tself.firstLastName( '' );\n\t\t\tself.whosWho( '' );\n\t\t\tself.text( '' );\n\t\t\tself.active( false );\n\t\t\tself.imageData( null );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tself.model = dto;\n\n\t\t\tself.date( dto.date );\n\t\t\tself.firstLastName( dto.firstLastName );\n\t\t\tself.whosWho( dto.whosWho );\n\t\t\tself.text( dto.text );\n\t\t\tself.active( dto.active );\n\t\t\tself.imageData( dto.imageData );\n\t\t}\n\n\t\tcommon.utils.log( 'FormTestimonial.reset(): END' );\n\t}\n\n\tprivate open() : void\n\t{\n\t\tcommon.utils.log( 'FormTestimonial.open(): START' );\n\t\tthis.$container.modal( 'show' );\n\t\tcommon.utils.log( 'FormTestimonial.open(): END' );\n\t}\n\n\tprotected close() : void\n\t{\n\t\tcommon.utils.log( 'FormTestimonial.close(): START' );\n\t\tthis.$container.modal( 'hide' );\n\t\tcommon.utils.log( 'FormTestimonial.close(): END' );\n\t}\n\n\tprotected async save() : Promise<void>\n\t{\n\t\tcommon.utils.log( 'FormTestimonial.save(): START' );\n\t\tconst self = this;\n\n\t\tif( common.utils.stringIsNullOrWhitespace( self.firstLastName() )\n\t\t || common.utils.stringIsNullOrWhitespace( self.whosWho() )\n\t\t || common.utils.stringIsNullOrWhitespace( self.text() ) )\n\t\t{\n\t\t\tself.showRequiredText( true );\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = {\n\t\t\t\tdate\t\t\t: self.date(),\n\t\t\t\tfirstLastName\t: self.firstLastName(),\n\t\t\t\twhosWho\t\t\t: self.whosWho(),\n\t\t\t\ttext\t\t\t: self.text(),\n\t\t\t\tactive\t\t\t: self.active(),\n\t\t\t\timageData\t\t: self.imageData(),\n\t\t\t\tsaveImage\t\t: true,\n\t\t\t};\n\t\tlet saveRequest : ctrl.SaveRequest;\n\t\tif( self.model == null )\n\t\t\t// add new\n\t\t\tsaveRequest = $.extend( { date:'', active:false }, fields );\n\t\telse\n\t\t\t// edit existing\n\t\t\tsaveRequest = $.extend( self.model, fields );\n\n\t\tcommon.utils.log( 'FormTestimonial.save(): Send the save request' );\n\t\tcommon.html.block( self.$blockingDiv );\n\t\tconst rc = await ctrl.save( saveRequest );\n\t\tcommon.html.unblock( self.$blockingDiv );\n\t\tif(! rc.success )\n\t\t{\n\t\t\tcommon.utils.error( 'FormTestimonial.save(): Error', { rc } );\n\t\t\tcommon.html.showMessage( rc.errorMessage );\n\t\t\treturn;\n\t\t}\n\n\t\tif( common.pageParameters.isAutenticated )\n\t\t{\n\t\t\tcommon.utils.log( 'FormTestimonial.save(): Refresh page' );  // nb: list may have changed\n\t\t\tlocation.reload();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcommon.utils.log( 'FormTestimonial.save(): Close & show success message' );\n\t\t\tself.close();\n\t\t\tcommon.html.showMessage( saveSuccessMessage );\n\t\t}\n\n\t\tcommon.utils.log( 'FormTestimonial.save(): END' );\n\t}\n}\n","\r\nimport * as common from \"./common\";\r\nimport { PageParameters } from \"../PageHelper\";\r\nimport { Routes } from \"../Routes\";\r\n\r\n\r\nexport const debugMessages : boolean = false;  // NB: 'export' so that it can be easily changed from the browser's console\r\nexport var pageParameters : PageParameters;\r\nexport var routes : Routes;\r\n\r\nexport function init(p:{ pageParameters:PageParameters })\r\n{\r\n\tpageParameters = p.pageParameters;\r\n\troutes = pageParameters.routes;\r\n\tutils.log( 'common.init()' );\r\n\r\n\tif( pageParameters.hasErrors )\r\n\t{\r\n\t\tutils.log( 'common.init(): Page has errors! ; outputting the logs' );\r\n\t\tcommon.utils.error( 'Page has errors!', { log:pageParameters.logs } );\r\n\t}\r\n\r\n\tutils.log( 'common.init(): Add custom KnockoutHandler' );\r\n\r\n\tko.bindingHandlers.ttt_autocomplete =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst searchFunction : (term:string)=>Promise<string[]> = valueAccessor();\r\n\t\t\t\t\t\t$(element).autocomplete( {\tminLength\t: 0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsource\t\t: async (request:{term:string}, resolve:(list:string[])=>void)=>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst list = await searchFunction( request.term );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tresolve( list );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t},\r\n\t\t};\r\n\r\n\t// cf. https://knockoutjs.com/examples/animatedTransitions.html\r\n\tko.bindingHandlers.ttt_slideUpDownVisible =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif(! value )\r\n\t\t\t\t\t\t\t$(element).hide();\r\n\t\t\t\t\t},\r\n\t\t\tupdate: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif( value )\r\n\t\t\t\t\t\t\t$(element).slideDown();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t$(element).slideUp();\r\n\t\t\t\t\t}\r\n\t\t};\r\n\tko.bindingHandlers.ttt_slideLeftRightVisible =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif(! value )\r\n\t\t\t\t\t\t\t$(element).hide();\r\n\t\t\t\t\t},\r\n\t\t\tupdate: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst value = ko.unwrap( valueAccessor() );\r\n\t\t\t\t\t\tif( value )\r\n\t\t\t\t\t\t\t$(element).show( 'blind', { direction: 'left' } );\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t$(element).hide( 'blind', { direction: 'left' } );\r\n\t\t\t\t\t}\r\n\t\t};\r\n\r\n\tko.bindingHandlers.ttt_blink =\r\n\t\t{\r\n\t\t\tinit: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// Initially hidden\r\n\t\t\t\t\t\t$(element).hide();\r\n\r\n\t\t\t\t\t\t// Initial value must always be 'false'\r\n\t\t\t\t\t\tconst koValue = valueAccessor();\r\n\t\t\t\t\t\tkoValue( false );\r\n\t\t\t\t\t},\r\n\t\t\tupdate: (element,valueAccessor)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst $element = $(element);\r\n\t\t\t\t\t\tconst koValue = valueAccessor();\r\n\t\t\t\t\t\tif( koValue() == true )\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// Switched to 'true' => animate\r\n\t\t\t\t\t\t\t$element.fadeIn().delay(1000).fadeOut( ()=>\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t// then revert to 'false'\r\n\t\t\t\t\t\t\t\t\tkoValue( false );\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t};\r\n}\r\n\r\nexport namespace utils\r\n{\r\n\texport function log(...optionalParams: any[]) : void\r\n\t{\r\n\t\tif( pageParameters.isDebug )\r\n\t\t\tconsole.log.apply( console, arguments );\r\n\t}\r\n\r\n\texport function error(...optionalParams: any[]) : void\r\n\t{\r\n\t\tconsole.error.apply( console, arguments );\r\n\t}\r\n\r\n\t/** cf. https://schneidenbach.gitbooks.io/typescript-cookbook/nameof-operator.html */\r\n\texport const nameof = <T>(name: keyof T) => name;\r\n\r\n\t/** Function to simulate string-valued enums\r\n\t * Based on: https://basarat.gitbooks.io/typescript/docs/types/literal-types.html\r\n\t * Returns: { e:the enum , a:the array specified as parameter } */\r\n\texport function strEnum<T extends string>(a:Array<T>): { e:{[K in T]: K}, a:T[] }\r\n\t{\r\n\t\tconst e = a.reduce( (res, key)=>\r\n\t\t\t{\r\n\t\t\t\tres[key] = key;\r\n\t\t\t\treturn res;\r\n\t\t\t}, Object.create(null) );\r\n\t\treturn { e, a };\r\n\t}\r\n\r\n\texport function stringIsNullOrEmpty(str:string) : boolean\r\n\t{\r\n\t\tif( str == null )\r\n\t\t\treturn true;\r\n\t\tif( str == '' )\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t}\r\n\texport function stringIsNullOrWhitespace(str:string) : boolean\r\n\t{\r\n\t\tif( str == null )\r\n\t\t\treturn true;\r\n\t\tif( str.trim() == '' )\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\texport function htmlEncode(txt:string|string[]) : string\r\n\t{\r\n\t\t// TODO: Find a better way ?\r\n\t\tif( Array.isArray(txt) )\r\n\t\t\treturn $.map( <string[]>txt, v=>$(document.createElement('span')).text( v ).html() ).join( '<br/>' );\r\n\t\telse\r\n\t\t\treturn $(document.createElement('span')).text( txt ).html();\r\n\t}\r\n\r\n\texport function arrayContains<T>(a:T[], item:any) : boolean\r\n\t{\r\n\t\treturn ( a.indexOf( item ) >= 0 );\r\n\t}\r\n\r\n//ES5 incompatible ...\r\n//\texport function arrayUnique<T>(a:T[]) : T[]\r\n//\t{\r\n//\t\t//return a.filter( (v,i)=>( a.indexOf(v) === i ) );\r\n//\t\treturn [ ... new Set(a) ];\r\n//\t}\r\n\r\n\texport function arrayRemoveItem<T>(a:T[], item:T) : boolean\r\n\t{\r\n\t\tlet i = a.indexOf( item );\r\n\t\tif( i < 0 )\r\n\t\t\treturn false;\r\n\t\ta.splice( i, 1 );\r\n\t\treturn true;\r\n\t}\r\n\r\n\texport function arraySum<T>(a:T[], f:(e:T)=>number) : number\r\n\t{\r\n\t\tlet rc = 0;\r\n\t\ta.forEach( function(e)\r\n\t\t\t{\r\n\t\t\t\trc += f(e);\r\n\t\t\t} );\r\n\t\treturn rc;\r\n\t}\r\n\r\n\texport function arrayMoveItem<T>(p:{ list:T[], item:T, direction?:'up'|'down' }) : T[]\r\n\t{\r\n\t\t// NB: Does not yet work when n>1 ...\r\n\r\n\t\tlet n = 1;\r\n\t\tif( p.direction != null )\r\n\t\t\tn = (p.direction == 'up') ? -n : n;\r\n\t\tconst i = p.list.indexOf( p.item );  // Start position\r\n\t\tif( i < 0 )\r\n\t\t\tthrow { error:'Could not find item in list', item:p.item };\r\n\t\tlet j = i + n;  // End position\r\n\t\tif( j < 0 )\r\n\t\t\tj = 0;\r\n\t\telse if( j >= p.list.length )\r\n\t\t\tj = p.list.length - 1;\r\n\t\tif( i == j )\r\n\t\t\t// NOOP\r\n\t\t\treturn p.list;\r\n\r\n\t\t// Swap items here\r\n\t\tconst tmp = p.list[ i ];\r\n\t\tp.list[ i ] = p.list[ j ];\r\n\t\tp.list[ j ] = tmp;\r\n\r\n\t\treturn p.list;\r\n\t}\r\n\r\n\texport function ensureInteger(p:{\tobservable:KnockoutObservable<Number>,\r\n\t\t\t\t\t\t\t\t\t\tfallbackValue?:number,\r\n\t\t\t\t\t\t\t\t\t\tmustBePositive?:boolean,\r\n\t\t\t\t\t\t\t\t\t\tcanBeZero?:boolean,\r\n\t\t\t\t\t\t\t\t\t\tcanBeNull?:boolean }) : void\r\n\t{\r\n\t\tif( p.canBeZero == null )\r\n\t\t\tp.canBeZero = true;\r\n\t\tif( p.canBeNull == null )\r\n\t\t\tp.canBeNull = false;\r\n\t\tif( p.fallbackValue == null )\r\n\t\t{\r\n\t\t\tif( p.canBeZero )\r\n\t\t\t\tp.fallbackValue = 0;\r\n\t\t\telse\r\n\t\t\t\tp.fallbackValue = 1;\r\n\t\t}\r\n\r\n\t\tlet canBeNull = p.canBeNull;\r\n\t\tp.observable.subscribe( function(value:number)\r\n\t\t\t{\r\n\t\t\t\tif( canBeNull )\r\n\t\t\t\t{\r\n\t\t\t\t\tif( (<any>value == '') || (value == null) )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tp.observable( null );\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar newValue = parseInt( <any>value );\r\n\r\n\t\t\t\tif( isNaN(newValue) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\t\t\t\telse if( (!p.canBeZero) && (value == 0) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\t\t\t\telse if( (p.mustBePositive) && (value < 0) )\r\n\t\t\t\t\tnewValue = p.fallbackValue;\r\n\r\n\t\t\t\tif( value !== newValue )\r\n\t\t\t\t\t// Value must be changed\r\n\t\t\t\t\tp.observable( newValue );\r\n\t\t\t} );\r\n\t}\r\n\r\n\t/** Generates a GUID-like string (something that looks like one, but NOT a real one!!!)\r\n\t * cf. http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript */\r\n\texport function newGuid() : string\r\n\t{\r\n\t\tvar S4 = function() : string\r\n\t\t{\r\n\t\t\treturn (((1+Math.random())*0x10000)|0).toString(16).substring(1);\r\n\t\t};\r\n\t\treturn (S4()+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+S4()+S4());\r\n\t}\r\n\r\n\texport function sleep(ms:number) : Promise<void>\r\n\t{\r\n\t\treturn new Promise( resolve => setTimeout(resolve, ms) );\r\n\t}\r\n} // namespace utils\r\n\r\nexport namespace html\r\n{\r\n\texport function showMessage(msg:string) : void\r\n\t{\r\n\t\t// Bootstrap style:\r\n\t\tconst html = `<div class=\"modal\" tabindex=\"-1\" role=\"dialog\">\r\n\t\t\t\t\t\t<div class=\"modal-dialog\" role=\"document\">\r\n\t\t\t\t\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t\t\t\t\t<div class=\"modal-body\">\r\n\t\t\t\t\t\t\t\t\t<!-- Text content here -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"modal-footer\">\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\tconst $div = $(html);\r\n\t\t$div.find( '.modal-body' ).text( msg );\r\n\t\t$div.modal();\r\n\r\n\t\t// JQuery style:\r\n\t\t// var $div = $('<div/>').text('Hello world');\r\n\t\t// $('body').append( $div );\r\n\t\t// $div.dialog()\r\n\t}\r\n\r\n\texport function confirm(msg:string) : Promise<boolean>\r\n\t{\r\n\t\t// Bootstrap style:\r\n\t\tconst html = `<div class=\"modal\" tabindex=\"-1\" role=\"dialog\">\r\n\t\t\t\t\t\t<div class=\"modal-dialog\" role=\"document\">\r\n\t\t\t\t\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t\t\t\t\t<div class=\"modal-body\">\r\n\t\t\t\t\t\t\t\t\t<!-- Text content here -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"modal-footer\">\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\">Ok</button>\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\tconst $div = $(html);\r\n\t\t$div.find( '.modal-body' ).text( msg );\r\n\t\treturn new Promise<boolean>( (resolve)=>\r\n\t\t\t{\r\n\t\t\t\tlet confirmed = false;\r\n\t\t\t\t$div.find( '.btn-primary' ).click( ()=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconfirmed = true;\r\n\t\t\t\t\t\t$div.modal( 'hide' );\r\n\t\t\t\t\t\tresolve( true );\r\n\t\t\t\t\t} );\r\n\t\t\t\t$div.on( 'hidden.bs.modal', (e)=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif( confirmed )\r\n\t\t\t\t\t\t\t// Clicked on 'Save' => NOOP\r\n\t\t\t\t\t\t\t// nb: should not happen, but in case ...\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t// Manually closed => Cancel\r\n\t\t\t\t\t\tresolve( false );\r\n\t\t\t\t\t} );\r\n\t\t\t\t$div.modal();\r\n\t\t\t} );\r\n\r\n\t\t// JQuery style:\r\n\t\t// TODO ...\r\n\t}\r\n\r\n\t/** Invoke jQuery.blockUI's '.block()' on the specified element but supports multiple invokation on the same element */\r\n\texport function block($e:JQuery) : JQuery\r\n\t{\r\n\t\t// Insert/increment a block counter as jQuery 'data()'\r\n\t\tvar blockCounter = ( $e.data('ttt_blockCounter')|0 ) + 1;\r\n\t\t$e.data( 'ttt_blockCounter', blockCounter );\r\n\r\n\t\tif( blockCounter == 1 )\r\n\t\t\t// This element is not blocked yet\r\n\t\t\t(<any>$e).block();  // TODO: ACA: jQuery.blockUI typings ...\r\n\r\n\t\treturn $e;\r\n\t}\r\n\r\n\t/** Invoke jQuery.blockUI's '.unblock()' on the specified element except if it has been block()ed more than once */\r\n\texport function unblock($e:JQuery) : JQuery\r\n\t{\r\n\t\t// Decrement the block counter in the jQuery 'data()'\r\n\t\tvar blockCounter = ( $e.data('ttt_blockCounter')|0 ) - 1;\r\n\t\t$e.data( 'ttt_blockCounter', blockCounter );\r\n\r\n\t\tif( blockCounter < 0 )\r\n\t\t{\r\n\t\t\t// There is a logic error somewhere...\r\n\t\t\tcommon.utils.error( 'INTERNAL ERROR: Unblock count > block count:', blockCounter );\r\n\r\n\t\t\t// Reset counter\r\n\t\t\tblockCounter = 0;\r\n\t\t\t$e.data( 'ttt_blockCounter', 0 );\r\n\t\t}\r\n\r\n\t\tif( blockCounter == 0 )\r\n\t\t\t// This element is no more blocked by anything else\r\n\t\t\t(<any>$e).unblock();  // TODO: ACA: jQuery.blockUI typings ...\r\n\r\n\t\treturn $e;\r\n\t}\r\n\r\n\texport function ensureVisible($e:JQuery) : void\r\n\t{\r\n\t\t// Scroll\r\n\t\tconst offset = $e.offset().top - ( 20 + $e.height() );\r\n\t\t$('html, body').animate({ scrollTop:offset });  // cf.: https://stackoverflow.com/questions/4884839/how-do-i-get-an-element-to-scroll-into-view-using-jquery?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa\r\n\r\n\t\t// Blink\r\n\t\t$e.effect( \"highlight\", {}, 2000 );  // cf.: https://stackoverflow.com/questions/5205445/jquery-blinking-highlight-effect-on-div?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa\r\n\t}\r\n\r\n\texport function waitForScrolledVisible($elem:JQuery) : Promise<void>\r\n\t{\r\n\t\tconst $window = $(window);\r\n\r\n\t\tfunction isScrolledVisible()\r\n\t\t{\r\n\t\t\tconst docViewTop = $window.scrollTop();\r\n\t\t\tconst docViewBottom = docViewTop + $window.height();\r\n\r\n\t\t\tconst elemTop = $elem.offset().top;\r\n\t\t\tconst elemBottom = elemTop + $elem.height();\r\n\t\t\treturn ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));\r\n\t\t}\r\n\r\n\t\treturn new Promise( (resolve)=>\r\n\t\t\t{\r\n\t\t\t\tlet scrollHandler : ()=>void;\r\n\t\t\t\tscrollHandler = function()\r\n\t\t\t\t{\r\n\t\t\t\t\tif(! isScrolledVisible() )\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// This is a one-shot only => unbind myself\r\n\t\t\t\t\t$window.unbind( 'scroll', scrollHandler );\r\n\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( isScrolledVisible() )\r\n\t\t\t\t\t// Element is visible right now => no need to bind to scroll event\r\n\t\t\t\t\tresolve();\r\n\t\t\t\telse  // Bind to scroll event & wait for $elem to be visible\r\n\t\t\t\t\t$window.bind( 'scroll', scrollHandler );\r\n\t\t\t} );\r\n\t}\r\n} // namespace html\r\n\r\nexport namespace url\r\n{\r\n\tconst onChangedEvent = 'onUrlChanged';\r\n\tvar onChangedCallbacks = $({});\r\n\tvar onChangedCallbacksRegistered = false;\r\n\r\n\texport function redirect(url:string)\r\n\t{\r\n\t\twindow.location.href = url;\r\n\t}\r\n\r\n\t/** Parse a parameters string like 'foo=bar&hello=world' and return the a dictionary like {foo:'bar',hello:'world'} */\r\n\texport function parseParameters(searchString?:string) : {[key:string]:any}\r\n\t{\r\n\t\tif( searchString == null )\r\n\t\t\tsearchString = window.location.search.substring(1);\r\n\t\tif( searchString.length == 0 )\r\n\t\t\treturn {};\r\n\r\n\t\tvar tokens = searchString.split( '&' );\r\n\r\n\t\tvar dict = <{[key:string]:any}>{};\r\n\t\tfor( var i=0; i < tokens.length; ++i )\r\n\t\t{\r\n\t\t\tvar pairs = tokens[i].split( '=' );\r\n\t\t\tvar key = decodeURIComponent( pairs[0] );\r\n\t\t\tvar value = decodeURIComponent( pairs[1] );\r\n\r\n\t\t\t// Try parse JSON\r\n\t\t\ttry { value = JSON.parse(value); }\r\n\t\t\tcatch( ex ){/* Not JSON => Keep the string as-is*/}\r\n\r\n\t\t\tdict[ key ] = value;\r\n\t\t}\r\n\t\treturn dict;\r\n\t}\r\n\r\n\t/** Transform a dictionary like {foo:'bar',hello:'world'} to a parameters string like 'foo=bar&hello=world' */\r\n\texport function stringifyParameters(parms:{[key:string]:any}) : string\r\n\t{\r\n\t\tvar pairs = <string[]>[];\r\n\t\t$.each( parms, function(key:string,value)\r\n\t\t\t{\r\n\t\t\t\tkey = encodeURIComponent( key );\r\n\r\n\t\t\t\tif( (value == null) || (typeof(value) === 'string') || (typeof(value) === 'number') || (typeof(value) === 'boolean') )\r\n\t\t\t\t\t{/*Keep as-is*/}\r\n\t\t\t\telse\r\n\t\t\t\t\t// Convert to JSON\r\n\t\t\t\t\tvalue = JSON.stringify( value );\r\n\t\t\t\tvalue = encodeURIComponent( value );\r\n\r\n\t\t\t\tpairs.push( key+\"=\"+value );\r\n\t\t\t} );\r\n\t\treturn pairs.join( '&' );\r\n\t}\r\n\r\n\t/** Registers a callback to be invoked whenever the browser's URL changes (cf. 'pushHistory()') */\r\n\texport function onChanged(callback:()=>void) : void\r\n\t{\r\n\t\t// NB: The callback gets invoked ALSO when 'pushHistory()' is invoked\r\n\r\n\t\tif( onChangedCallbacksRegistered == false )\r\n\t\t{\r\n\t\t\t$(window).bind( 'popstate', function(evt)\r\n\t\t\t\t{\r\n\t\t\t\t\tonChangedCallbacks.trigger( onChangedEvent );\r\n\t\t\t\t} );\r\n\t\t\tonChangedCallbacksRegistered = true;\r\n\t\t}\r\n\r\n\t\tonChangedCallbacks.bind( onChangedEvent, callback );\r\n\t}\r\n\r\n\texport function createUrl(p:{ pathname?:string, parameters?:{[key:string]:any} }) : string\r\n\t{\r\n\t\tvar newPath = p.pathname;\r\n\t\tif( newPath == null )\r\n\t\t\tnewPath = window.location.pathname;\r\n\r\n\t\tif( p.parameters != null )\r\n\t\t{\r\n\t\t\tconst queryString = stringifyParameters( p.parameters );\r\n\t\t\tif( queryString.length > 0 )\r\n\t\t\t\tnewPath = newPath+'?'+queryString;\r\n\t\t}\r\n\t\treturn newPath;\r\n\t}\r\n\r\n\t/** Change the browser's current URL without triggering an HTTP request (NB: Will trigger any registered 'onChanged()' callbacks) */\r\n\texport function pushHistory(p:{ pathname?:string, parameters?:{[key:string]:any}, newTitle?:string }) : void\r\n\t{\r\n\t\tconst newPath = createUrl( p );\r\n\t\twindow.history.pushState( {}, p.newTitle, newPath );\r\n\r\n\t\t// Invoke any registered callbacks\r\n\t\tonChangedCallbacks.trigger( onChangedEvent );\r\n\t}\r\n\r\n\texport function postRequestForm<T>(url:string, request:{[key:string]:any}) : Promise<T>\r\n\t{\r\n\t\tutils.log( 'postRequestForm', { url, request } );\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'POST',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'application/x-www-form-urlencoded',\r\n\t\t\t\t\t\t\tdata\t\t: request,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'postRequestForm', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'postRequestForm rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function postRequestFormData<T>(url:string, formData:FormData) : Promise<T>\r\n\t{\r\n\t\tutils.log( 'postRequestFormData', { url, formData } );\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax( {\ttype\t\t: \"POST\",\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: false,\r\n\t\t\t\t\t\t\tprocessData\t: false,\r\n\t\t\t\t\t\t\tdata\t\t: formData,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data:T,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'postRequestFormData', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'postRequestFormData rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t} );\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function postRequestJSON<T>(url:string, request:{[key:string]:any}) : Promise<T>\r\n\t{\r\n\t\tutils.log( 'postRequestJSON', { url, request } );\r\n\t\tlet requestStr = JSON.stringify( request );\r\n\t\treturn new Promise<T>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'POST',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'application/json',\r\n\t\t\t\t\t\t\tdata\t\t: requestStr,\r\n\t\t\t\t\t\t\tdataType\t: 'json',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'postRequestJSON', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'postRequestJSON rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function getRequest(url:string, request?:{[key:string]:any}) : Promise<string>\r\n\t{\r\n\t\tif( request != null )\r\n\t\t{\r\n\t\t\tconst parms = stringifyParameters( request );\r\n\t\t\turl = `${url}?${parms}`;\r\n\t\t}\r\n\t\tutils.log( 'getRequest', { url, request } );\r\n\r\n\t\treturn new Promise<string>( (resolve,reject)=>\r\n\t\t\t{\r\n\t\t\t\t$.ajax({\ttype\t\t: 'GET',\r\n\t\t\t\t\t\t\turl\t\t\t: url,\r\n\t\t\t\t\t\t\tcontentType\t: 'text/html',\r\n\t\t\t\t\t\t\tsuccess\t\t: (data,textStatus,jqXHR)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.log( 'getRequest', { response:data } );\r\n\t\t\t\t\t\t\t\t\t\t\t\tresolve( data );\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror\t\t: (jqXHR,textStatus,errorThrown)=>\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tutils.error( 'getRequest rejected', { jqXHR, textStatus, errorThrown } );\r\n\t\t\t\t\t\t\t\t\t\t\t\treject( textStatus );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t} );\r\n\t}\r\n\r\n\texport function downloadFile(url:string) : void\r\n\t{\r\n\t\t$(document.body).append( $(\"<iframe/>\").attr({\tsrc\t\t: url,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle\t: 'visibility:hidden;display:none' })\r\n\t\t\t\t\t\t\t\t);\r\n\t}\r\n\r\n} // namespace url\r\n\r\n// nb: Exports at the end or the order of execution breaks everything (i.e. strEnum must be defined before) ...\r\nexport * from \"../Language\";\r\nexport * from \"../PageHelper\";\r\nexport * from \"../Routes\";\r\n"]}